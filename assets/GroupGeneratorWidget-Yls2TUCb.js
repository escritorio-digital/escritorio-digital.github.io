import{u as Q,r as l,s as Z,j as e,b as ee,X as W,g as $}from"./index-5fVle3rd.js";import{Y as ge}from"./index-5fVle3rd.js";import{r as te,s as se,d as ne}from"./saveDialog-Nl8YbZ8T.js";import{r as re}from"./openDialog-H-OCpcqq.js";import{E as oe}from"./expand-BLlFttRC.js";const ue=()=>{const{t:r}=Q(),[C,b]=l.useState(`Ana
Beatriz
Carlos
Daniela
Esteban
Fernanda
Gael
Hilda
IvÃ¡n
Julia`),[y,N]=l.useState("byCount"),[p,A]=l.useState(3),[i,z]=l.useState([]),[c,w]=l.useState(!1),[B,_]=l.useState(!1),S=l.useRef(null),M=l.useRef(null),F=l.useRef(null),G=l.useRef({titleSize:0,textSize:0,minCardWidth:0,containerHeight:0});l.useEffect(()=>{if(!c)return;const t=S.current,n=M.current,s=F.current;if(!t||!n||!s)return;let o=0;const a=()=>{if(!t||!n||!s)return;const m=getComputedStyle(t),D=parseFloat(m.paddingTop)||0,U=parseFloat(m.paddingBottom)||0,J=parseFloat(m.rowGap||m.gap)||0,h=Math.max(120,t.clientHeight-n.offsetHeight-D-U-J);s.style.height=`${h}px`;const H=s.clientWidth,K=Math.max(1,i.length),X=Math.min(K,Math.max(1,Math.floor(H/320))),x=Math.max(240,Math.floor(H/X)-16),R=16,Y=Math.min(40,Math.max(20,Math.floor(h/5)));let E=R,I=Y,u=R;for(let P=0;P<12;P+=1){const d=Math.floor((E+I)/2);t.style.setProperty("--group-text-size",`${d}px`),t.style.setProperty("--group-title-size",`${Math.round(d*1.2)}px`),t.style.setProperty("--group-card-min",`${x}px`),s.scrollHeight<=s.clientHeight?(u=d,E=d+1):I=d-1}const v=Math.round(u*1.2),f=G.current;(f.textSize!==u||f.titleSize!==v||f.minCardWidth!==x||f.containerHeight!==h)&&(G.current={textSize:u,titleSize:v,minCardWidth:x,containerHeight:h},t.style.setProperty("--group-text-size",`${u}px`),t.style.setProperty("--group-title-size",`${v}px`),t.style.setProperty("--group-card-min",`${x}px`))},g=()=>{cancelAnimationFrame(o),o=requestAnimationFrame(a)};g();const j=new ResizeObserver(g);return j.observe(t),j.observe(s),()=>{cancelAnimationFrame(o),j.disconnect()}},[c,i]);const T=t=>{const n=new FileReader;n.onload=s=>{const o=s.target?.result;b(o)},n.readAsText(t)},O=async()=>{const t=await re({accept:".txt"});if(!t)return;if(t.source==="local"){const[a]=t.files;a&&T(a);return}const[n]=t.entryIds;if(!n)return;const s=await $(n);if(!s?.blob)return;const o=new File([s.blob],s.name,{type:s.mime||s.blob.type});T(o)};l.useEffect(()=>Z("group-generator",async({entryId:n})=>{const s=await $(n);if(!s?.blob)return;const o=await s.blob.text();b(o)}),[]);const L=()=>{const t=C.split(`
`).map(o=>o.trim()).filter(o=>o);if(t.length===0||p<=0){z([]);return}const n=[...t].sort(()=>Math.random()-.5),s=[];if(y==="byCount"){const o=Math.max(1,Math.min(p,t.length));for(let a=0;a<o;a++)s.push([]);n.forEach((a,g)=>{s[g%o].push(a)})}else{const o=Math.max(1,p);for(let a=0;a<n.length;a+=o)s.push(n.slice(a,a+o))}z(s)},k=()=>i.map((t,n)=>{const s=r("widgets.group_generator.group_title",{number:n+1}),o=t.map(a=>`- ${a}`);return[s,...o].join(`
`)}).join(`

`),V=async()=>{if(i.length===0)return;const t=k();try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(t);else{const n=document.createElement("textarea");n.value=t,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}_(!0),window.setTimeout(()=>_(!1),1500)}catch{_(!1)}},q=async()=>{if(i.length===0)return;const t=k(),n=new Blob([t],{type:"text/plain;charset=utf-8"}),s=await te("grupos.txt");if(s?.destination==="file-manager"){await se({blob:n,filename:s.filename,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:s.parentId});return}s?.destination==="download"&&ne(n,s.filename)};return e.jsxs("div",{className:"group-generator-widget",children:[e.jsxs("div",{className:"input-panel",children:[e.jsx("label",{className:"panel-label",children:r("widgets.group_generator.student_list_label")}),e.jsx("textarea",{value:C,onChange:t=>b(t.target.value),placeholder:r("widgets.group_generator.placeholder")}),e.jsxs("button",{onClick:O,className:"upload-button",children:[e.jsx(ee,{size:16})," ",r("widgets.group_generator.load_from_file")]})]}),e.jsxs("div",{className:"controls-panel",children:[e.jsxs("div",{className:"mode-selection",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"mode",checked:y==="byCount",onChange:()=>N("byCount")}),r("widgets.group_generator.number_of_groups")]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"mode",checked:y==="bySize",onChange:()=>N("bySize")}),r("widgets.group_generator.students_per_group")]})]}),e.jsx("input",{type:"number",value:p,onChange:t=>A(Math.max(1,parseInt(t.target.value)||1)),className:"group-value-input",min:"1"}),e.jsx("button",{onClick:L,className:"generate-button",children:r("widgets.group_generator.generate_groups")})]}),e.jsxs("div",{className:"output-panel",children:[e.jsxs("div",{className:"output-header",children:[e.jsx("label",{className:"panel-label",children:r("widgets.group_generator.generated_groups_label")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"expand-button",onClick:V,disabled:i.length===0,title:r("widgets.group_generator.copy_groups"),children:e.jsx("span",{children:r(B?"widgets.group_generator.copied":"widgets.group_generator.copy_groups")})}),e.jsx("button",{className:"expand-button",onClick:q,disabled:i.length===0,title:r("widgets.group_generator.download_groups"),children:e.jsx("span",{children:r("widgets.group_generator.download_groups")})}),e.jsxs("button",{className:"expand-button",onClick:()=>w(!c),disabled:i.length===0,children:[c?e.jsx(W,{size:16}):e.jsx(oe,{size:16}),e.jsx("span",{children:r(c?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large")})]})]})]}),e.jsx("div",{className:"groups-container",children:i.length>0?i.map((t,n)=>e.jsxs("div",{className:"group-card",children:[e.jsx("h4",{className:"group-title",children:r("widgets.group_generator.group_title",{number:n+1})}),e.jsx("ul",{children:t.map(s=>e.jsx("li",{children:s},s))})]},n)):e.jsx("p",{className:"no-groups-message",children:r("widgets.group_generator.no_groups_message")})})]}),c&&e.jsx("div",{className:"groups-overlay",onClick:()=>w(!1),children:e.jsxs("div",{className:"groups-overlay-content",ref:S,onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"groups-overlay-header",ref:M,children:[e.jsx("h3",{children:r("widgets.group_generator.generated_groups_label")}),e.jsxs("button",{className:"expand-button",onClick:()=>w(!1),children:[e.jsx(W,{size:16}),e.jsx("span",{children:r("widgets.group_generator.close_large_view")})]})]}),e.jsx("div",{className:"groups-container groups-container-large",ref:F,children:i.length>0?i.map((t,n)=>e.jsxs("div",{className:"group-card group-card-large",children:[e.jsx("h4",{className:"group-title",children:r("widgets.group_generator.group_title",{number:n+1})}),e.jsx("ul",{children:t.map(s=>e.jsx("li",{children:s},s))})]},n)):e.jsx("p",{className:"no-groups-message",children:r("widgets.group_generator.no_groups_message")})})]})})]})};export{ue as GroupGeneratorWidget,ge as widgetConfig};
