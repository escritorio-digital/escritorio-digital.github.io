import{u as F,r as b,j as u}from"./index-rdPxbIB-.js";import{aA as ae}from"./index-rdPxbIB-.js";const I={"+":{prec:1,assoc:"left",arity:2},"-":{prec:1,assoc:"left",arity:2},"*":{prec:2,assoc:"left",arity:2},"/":{prec:2,assoc:"left",arity:2},"^":{prec:3,assoc:"right",arity:2},neg:{prec:4,assoc:"right",arity:1},"!":{prec:5,assoc:"left",arity:1},"%":{prec:5,assoc:"left",arity:1}},z=[{label:"C",value:"clear",kind:"control"},{label:"⌫",value:"backspace",kind:"control"},{label:"%",value:"%",kind:"operator"},{label:"÷",value:"/",kind:"operator"},{label:"7",value:"7",kind:"digit"},{label:"8",value:"8",kind:"digit"},{label:"9",value:"9",kind:"digit"},{label:"×",value:"*",kind:"operator"},{label:"4",value:"4",kind:"digit"},{label:"5",value:"5",kind:"digit"},{label:"6",value:"6",kind:"digit"},{label:"−",value:"-",kind:"operator"},{label:"1",value:"1",kind:"digit"},{label:"2",value:"2",kind:"digit"},{label:"3",value:"3",kind:"digit"},{label:"+",value:"+",kind:"operator"},{label:"0",value:"0",kind:"digit",span:2},{label:".",value:".",kind:"digit"},{label:"=",value:"=",kind:"equals"}],K=[{label:"C",value:"clear",kind:"control"},{label:"⌫",value:"backspace",kind:"control"},{label:"(",value:"(",kind:"operator"},{label:")",value:")",kind:"operator"},{label:"√",value:"sqrt",kind:"function"},{label:"^",value:"^",kind:"operator"},{label:"%",value:"%",kind:"operator"},{label:"÷",value:"/",kind:"operator"},{label:"7",value:"7",kind:"digit"},{label:"8",value:"8",kind:"digit"},{label:"9",value:"9",kind:"digit"},{label:"×",value:"*",kind:"operator"},{label:"4",value:"4",kind:"digit"},{label:"5",value:"5",kind:"digit"},{label:"6",value:"6",kind:"digit"},{label:"−",value:"-",kind:"operator"},{label:"1",value:"1",kind:"digit"},{label:"2",value:"2",kind:"digit"},{label:"3",value:"3",kind:"digit"},{label:"+",value:"+",kind:"operator"},{label:"Ans",value:"Ans",kind:"constant"},{label:"0",value:"0",kind:"digit"},{label:".",value:".",kind:"digit"},{label:"=",value:"=",kind:"equals"}],B=[{label:"RAD",value:"angle",kind:"toggle"},{label:"sin",value:"sin",kind:"function"},{label:"cos",value:"cos",kind:"function"},{label:"tan",value:"tan",kind:"function"},{label:"π",value:"pi",kind:"constant"},{label:"C",value:"clear",kind:"control"},{label:"⌫",value:"backspace",kind:"control"},{label:"log",value:"log",kind:"function"},{label:"ln",value:"ln",kind:"function"},{label:"√",value:"sqrt",kind:"function"},{label:"7",value:"7",kind:"digit"},{label:"8",value:"8",kind:"digit"},{label:"9",value:"9",kind:"digit"},{label:"÷",value:"/",kind:"operator"},{label:"^",value:"^",kind:"operator"},{label:"4",value:"4",kind:"digit"},{label:"5",value:"5",kind:"digit"},{label:"6",value:"6",kind:"digit"},{label:"×",value:"*",kind:"operator"},{label:"%",value:"%",kind:"operator"},{label:"1",value:"1",kind:"digit"},{label:"2",value:"2",kind:"digit"},{label:"3",value:"3",kind:"digit"},{label:"−",value:"-",kind:"operator"},{label:"x!",value:"!",kind:"operator"},{label:"0",value:"0",kind:"digit"},{label:".",value:".",kind:"digit"},{label:"Ans",value:"Ans",kind:"constant"},{label:"+",value:"+",kind:"operator"},{label:"=",value:"=",kind:"equals"}],_=r=>r.replace(/sqrt\(/g,"√(").replace(/pi/g,"π").replace(/Ans/g,"Ans").replace(/\*/g,"×").replace(/\//g,"÷").replace(/-/g,"−"),Z=r=>r.replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-"),Y=r=>{const c=[];let i=0;const n=Z(r);for(;i<n.length;){const t=n[i];if(t===" "){i+=1;continue}if(/[0-9.]/.test(t)){const l=n.slice(i).match(/^((\d+(\.\d*)?)|(\.\d+))([eE][+-]?\d+)?/);if(!l)throw new Error("Invalid number");c.push({type:"number",value:l[0]}),i+=l[0].length;continue}if(/[a-zA-Z]/.test(t)){const l=n.slice(i).match(/^[a-zA-Z]+/);if(!l)throw new Error("Invalid identifier");const o=l[0].toLowerCase();if(["sin","cos","tan","log","ln","sqrt"].includes(o))c.push({type:"function",value:o});else if(o==="pi")c.push({type:"constant",value:"pi"});else if(o==="ans")c.push({type:"variable",value:"ans"});else throw new Error("Unknown identifier");i+=l[0].length;continue}if(t==="π"){c.push({type:"constant",value:"pi"}),i+=1;continue}if(t==="("||t===")"){c.push({type:"paren",value:t}),i+=1;continue}if(["+","-","*","/","^"].includes(t)){c.push({type:"operator",value:t}),i+=1;continue}if(t==="!"||t==="%"){c.push({type:"postfix",value:t}),i+=1;continue}throw new Error("Invalid character")}return c},H=r=>{const c=[],i=[];let n=null;for(r.forEach(t=>{if(t.type==="operator"&&t.value==="-"&&(!n||n.type==="operator"||n.type==="paren"&&n.value==="("||n.type==="function")&&(t={type:"operator",value:"neg"}),t.type==="number"||t.type==="constant"||t.type==="variable")c.push(t);else if(t.type==="function")i.push(t);else if(t.type==="postfix")c.push(t);else if(t.type==="operator"){const l=I[t.value];if(!l)throw new Error("Unknown operator");for(;i.length>0;){const o=i[i.length-1];if(o.type!=="operator")break;const f=I[o.value];if(!f)break;const s=f.prec>l.prec,A=f.prec===l.prec&&l.assoc==="left";if(s||A)c.push(i.pop());else break}i.push(t)}else if(t.type==="paren")if(t.value==="(")i.push(t);else{for(;i.length>0&&i[i.length-1].value!=="(";)c.push(i.pop());if(i.length===0)throw new Error("Mismatched parentheses");i.pop(),i.length>0&&i[i.length-1].type==="function"&&c.push(i.pop())}n=t});i.length>0;){const t=i.pop();if(t.type==="paren")throw new Error("Mismatched parentheses");c.push(t)}return c},X=r=>{if(!Number.isFinite(r)||r<0||Math.floor(r)!==r)return NaN;if(r>170)return 1/0;let c=1;for(let i=2;i<=r;i+=1)c*=i;return c},G=(r,c,i)=>{const n=[];if(r.forEach(t=>{if(t.type==="number"){n.push(Number(t.value));return}if(t.type==="constant"){n.push(Math.PI);return}if(t.type==="variable"){n.push(i);return}if(t.type==="function"){const l=n.pop();if(l===void 0)throw new Error("Missing argument");const o=c==="deg"&&["sin","cos","tan"].includes(t.value)?l*Math.PI/180:l;t.value==="sin"&&n.push(Math.sin(o)),t.value==="cos"&&n.push(Math.cos(o)),t.value==="tan"&&n.push(Math.tan(o)),t.value==="log"&&n.push(Math.log10(l)),t.value==="ln"&&n.push(Math.log(l)),t.value==="sqrt"&&n.push(Math.sqrt(l));return}if(t.type==="postfix"){const l=n.pop();if(l===void 0)throw new Error("Missing argument");t.value==="!"&&n.push(X(l)),t.value==="%"&&n.push(l/100);return}if(t.type==="operator"){const l=I[t.value];if(!l)throw new Error("Unknown operator");if(l.arity===1){const s=n.pop();if(s===void 0)throw new Error("Missing argument");n.push(-s);return}const o=n.pop(),f=n.pop();if(f===void 0||o===void 0)throw new Error("Missing argument");t.value==="+"&&n.push(f+o),t.value==="-"&&n.push(f-o),t.value==="*"&&n.push(f*o),t.value==="/"&&n.push(f/o),t.value==="^"&&n.push(f**o)}}),n.length!==1)throw new Error("Invalid expression");return n[0]},J=r=>{if(!Number.isFinite(r))return"Error";const c=Math.abs(r);return c!==0&&(c>=1e12||c<1e-9)?r.toExponential(8):Number.parseFloat(r.toFixed(10)).toString()},E=r=>["+","-","*","/","^"].includes(r),Q=r=>{const c=[["Ans",3],["sqrt(",5],["sin(",4],["cos(",4],["tan(",4],["log(",4],["ln(",3],["pi",2]];for(const[i,n]of c)if(r.endsWith(i))return r.slice(0,-n);return r.slice(0,-1)},ee=({instanceId:r,windowStyle:c})=>{const{t:i,ready:n}=F(),[t,l]=b.useState("scientific"),[o,f]=b.useState("deg"),[s,A]=b.useState(""),[D,N]=b.useState(""),[w,d]=b.useState("0"),[$,S]=b.useState(0),[q,v]=b.useState(!1),C=b.useRef(null),m=c==="floating";b.useLayoutEffect(()=>{const e=C.current;if(!e)return;const a=360,p=520,x=()=>{const h=e.getBoundingClientRect(),O=Math.min(h.width/a,h.height/p),P=Math.max(.85,Math.min(1.35,O));e.style.setProperty("--calc-scale",P.toFixed(3))};x();const y=new ResizeObserver(x);return y.observe(e),()=>y.disconnect()},[]);const W=b.useMemo(()=>t==="basic"?z:t==="standard"?K:B,[t]),g=e=>{A(e),N(e?_(e):"")},R=e=>{A(e)},M=e=>{if(!s)return e;const a=s.slice(-1);return/[0-9)]/.test(a)||s.endsWith("pi")||s.endsWith("Ans")||a==="!"?`*${e}`:e},j=e=>{if(e==="."&&w.includes("."))return;const p=e==="."&&(s===""||E(s.slice(-1))||s.endsWith("("))?"0.":e;if(q){g(p),d(p),v(!1);return}const y=/\)$/.test(s)||s.endsWith("pi")||s.endsWith("Ans")||s.endsWith("!")?"*":"";w==="0"&&e!=="."?d(e):E(s.slice(-1))||s.endsWith("(")?d(p):d(h=>e==="."&&h===""?"0.":h+e),g(s+y+p)},k=e=>{if(e==="clear"){g(""),d("0"),N(""),v(!1);return}if(e==="backspace"){if(!s)return;const a=Q(s);if(g(a),a.endsWith("pi")){d("π");return}if(a.endsWith("Ans")){d("Ans");return}const p=a.match(/(\d+(?:\.\d+)?)(?!.*\d)/);d(p?p[1]:"0");return}if(e==="="){const a=s||w;try{const p=Y(a),x=H(p),y=G(x,o,$),h=J(y);d(h),N(`${_(a)} =`),R(h==="Error"?"":h),S(h==="Error"?$:y),v(!0)}catch{d("Error"),N(`${_(a)} =`),v(!0)}return}if(e==="angle"){f(a=>a==="rad"?"deg":"rad");return}if(e==="sqrt"||["sin","cos","tan","log","ln"].includes(e)){const a=e==="sqrt"?"sqrt(":`${e}(`,p=M(a);g(s+p),d(a),v(!1);return}if(e==="pi"){const a=M("pi");g(s+a),d("π"),v(!1);return}if(e==="Ans"){const a=M("Ans");g(s+a),d("Ans"),v(!1);return}if(e==="!"||e==="%"){g(s+e),v(!1);return}if(E(e)||e==="("||e===")"){if(q){g(w+e),v(!1);return}if(!s&&e!=="-")return;if(e==="("){const a=M("(");g(s+a);return}if(E(s.slice(-1))&&E(e)){g(s.slice(0,-1)+e);return}g(s+e);return}},L=e=>{if(e.kind==="digit"){j(e.value);return}if(e.kind==="equals"){k("=");return}if(e.kind==="toggle"){k("angle");return}k(e.value)},T=()=>{r&&window.dispatchEvent(new CustomEvent("widget-toggle-floating",{detail:{instanceId:r,enable:!m}}))},U=e=>{if(e.ctrlKey||e.metaKey||e.altKey)return;const{key:a}=e;if(/^\d$/.test(a)){e.preventDefault(),j(a);return}if(a==="."||a===","){e.preventDefault(),j(".");return}if(a==="+"||a==="-"||a==="*"||a==="/"){e.preventDefault(),k(a);return}if(a==="x"||a==="X"){e.preventDefault(),k("*");return}if(a==="Enter"||a==="="){e.preventDefault(),k("=");return}if(a==="Backspace"){e.preventDefault(),k("backspace");return}a==="Delete"&&(e.preventDefault(),k("clear"))};return n?u.jsx("div",{className:`scientific-calculator${m?" is-floating":""}`,ref:C,tabIndex:0,onKeyDown:U,onPointerDown:()=>C.current?.focus(),children:u.jsxs("div",{className:"calc-surface",children:[u.jsxs("div",{className:"calc-top",children:[u.jsxs("div",{className:"calc-tabs",children:[u.jsx("button",{className:`calc-tab ${t==="basic"?"is-active":""}`,onClick:()=>l("basic"),type:"button",children:i("widgets.scientific_calculator.basic")}),u.jsx("button",{className:`calc-tab ${t==="standard"?"is-active":""}`,onClick:()=>l("standard"),type:"button",children:i("widgets.scientific_calculator.standard")}),u.jsx("button",{className:`calc-tab ${t==="scientific"?"is-active":""}`,onClick:()=>l("scientific"),type:"button",children:i("widgets.scientific_calculator.scientific")})]}),u.jsxs("div",{className:"calc-angle",children:[t==="scientific"&&u.jsx("span",{className:"calc-angle-pill",children:o.toUpperCase()}),u.jsx("button",{type:"button",className:`calc-floating-toggle${m?" is-active":""}`,onClick:T,"aria-label":i(m?"widgets.scientific_calculator.floating_off":"widgets.scientific_calculator.floating_on"),title:i(m?"widgets.scientific_calculator.floating_off":"widgets.scientific_calculator.floating_on"),children:i(m?"widgets.scientific_calculator.floating_off":"widgets.scientific_calculator.floating_on")})]})]}),u.jsxs("div",{className:"calc-display",children:[u.jsx("div",{className:"calc-expression",children:D||" "}),u.jsx("div",{className:"calc-result",children:w})]}),u.jsx("div",{className:`calc-grid calc-grid--${t}`,children:W.map((e,a)=>u.jsx("button",{type:"button",onClick:()=>L(e),className:`calc-key calc-key--${e.kind}`,style:e.span?{gridColumn:`span ${e.span} / span ${e.span}`}:void 0,children:e.kind==="toggle"?o.toUpperCase():e.label},`${e.label}-${a}`))})]})}):u.jsx("div",{className:"calc-loading",children:i("loading")})};export{ee as ScientificCalculatorWidget,ae as widgetConfig};
