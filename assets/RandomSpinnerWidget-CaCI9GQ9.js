import{u as Z,r as o,j as n,au as J,k as Q,am as V,aG as ee,Z as te,T as ne}from"./react-vendor-WCYW3yxo.js";import{u as se}from"./index-DEF43kZb.js";import{E as pe}from"./index-DEF43kZb.js";import"./vendor-DCW5Txpp.js";import"./dnd-kit-ZKKYBs6g.js";const C=()=>`hsl(${Math.random()*360}, 70%, 80%)`,ce=()=>{const{t:c}=Z(),[i,p]=se("spinner-options",[]);o.useEffect(()=>{if(window.localStorage.getItem("spinner-options")===null){const e=c("widgets.random_spinner.default_options",{returnObjects:!0});Array.isArray(e)&&p(e.map(s=>({...s,color:C()})))}},[c,p]);const[_,I]=o.useState(""),[S,M]=o.useState(!1),[z,x]=o.useState(null),[L,b]=o.useState(null),[w,h]=o.useState(""),[g,q]=o.useState(!1),[a,B]=o.useState(300),[R,K]=o.useState(!1),[E,N]=o.useState(null),O=o.useRef(null),P=o.useRef(null),A=o.useRef(null),T=o.useRef(i);o.useEffect(()=>{T.current=i},[i]),o.useEffect(()=>{const t=P.current;if(!t)return;const e=new ResizeObserver(()=>{if(t){const s=Math.min(t.offsetWidth,t.offsetHeight);B(s)}});return e.observe(t),()=>e.disconnect()},[]),o.useEffect(()=>{const t=O.current;if(!t)return;const e=t.getContext("2d");if(!e)return;t.width=a,t.height=a;const s=i.length;if(s===0){e.clearRect(0,0,a,a);return}const u=2*Math.PI/s,f=a/2,l=a/2,r=a/2-10;e.clearRect(0,0,a,a),e.font=`bold ${Math.max(10,a*.05)}px sans-serif`,i.forEach((d,j)=>{const m=j*u;e.beginPath(),e.fillStyle=d.color,e.moveTo(f,l),e.arc(f,l,r,m,m+u),e.closePath(),e.fill(),e.save(),e.fillStyle="#333",e.translate(f,l),e.rotate(m+u/2),e.textAlign="right";const v=d.text.length>15?d.text.substring(0,12)+"...":d.text;e.fillText(v,r-10,0),e.restore()})},[i,a]);const F=()=>{_.trim()&&i.length<20&&(p([...i,{text:_.trim(),color:C()}]),I(""))},W=t=>{const e=t.target.files?.[0];if(!e)return;const s=new FileReader;s.onload=u=>{const l=(u.target?.result??"").split(/\r?\n/).map(r=>r.trim()).filter(Boolean).slice(0,20);p(l.map(r=>({text:r,color:C()}))),x(null),b(null),h("")},s.readAsText(e),t.target.value=""},D=t=>{p(i.filter((e,s)=>s!==t))},G=t=>{b(t),h(i[t].text)},$=t=>{if(w.trim()){const e=[...i];e[t].text=w.trim(),p(e)}b(null),h("")},H=()=>{if(S)return;let t=T.current;if(R&&E){const l=t.findIndex(r=>r.text===E);if(l!==-1){const r=t.filter((d,j)=>j!==l);p(r),t=r}N(null)}if(t.length<2)return;M(!0),x(null);const e=Math.random()*20+20,s=(Math.random()*3+4)*1e3;let u=0;const f=l=>{u||(u=l);const r=l-u,d=Math.min(r/s,1),m=e*(k=>1-Math.pow(1-k,4))(d),v=O.current;if(v&&(v.style.transform=`rotate(${m}rad)`),d<1)requestAnimationFrame(f);else{const k=m%(2*Math.PI),U=2*Math.PI/t.length,X=((-Math.PI/2-k)%(2*Math.PI)+2*Math.PI)%(2*Math.PI),Y=Math.floor(X/U)%t.length,y=t[Y]?.text??null;x(y),R&&y&&N(y),M(!1)}};requestAnimationFrame(f)};return n.jsxs("div",{className:`random-spinner-widget ${g?"fullscreen":""}`,children:[n.jsxs("div",{ref:P,className:"spinner-area",children:[n.jsx("canvas",{ref:O,className:"spinner-canvas"}),n.jsx("div",{className:"spinner-pointer"}),n.jsx("button",{onClick:H,disabled:S||i.length<2,className:"spin-button",children:n.jsx(J,{size:32})}),z&&!S&&n.jsxs("div",{className:"spinner-result",onClick:()=>x(null),children:[n.jsx("span",{children:z}),n.jsx("small",{children:c("widgets.random_spinner.result_overlay_text")})]}),n.jsx("button",{onClick:()=>q(!g),className:"fullscreen-button",title:c(g?"widgets.random_spinner.restore_view_button_title":"widgets.random_spinner.fullscreen_button_title"),children:g?n.jsx(Q,{size:16}):n.jsx(V,{size:16})})]}),n.jsxs("div",{className:"options-manager",children:[n.jsx("div",{className:"options-header",children:n.jsx("h3",{children:c("widgets.random_spinner.options_header")})}),n.jsxs("label",{className:"remove-selected",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:t=>{const e=t.target.checked;K(e),e||N(null)}}),c("widgets.random_spinner.remove_after_select")]}),n.jsxs("div",{className:"add-option",children:[n.jsx("input",{type:"text",value:_,onChange:t=>I(t.target.value),placeholder:c("widgets.random_spinner.add_option_placeholder"),maxLength:20,onKeyPress:t=>t.key==="Enter"&&F()}),n.jsx("button",{onClick:F,children:n.jsx(ee,{size:18})})]}),n.jsxs("button",{onClick:()=>A.current?.click(),className:"upload-options-button",children:[n.jsx(te,{size:16})," ",c("widgets.random_spinner.load_from_file")]}),n.jsx("input",{type:"file",ref:A,onChange:W,accept:".txt",className:"hidden"}),n.jsx("ul",{className:"options-list",children:i.map((t,e)=>n.jsxs("li",{onDoubleClick:()=>G(e),children:[n.jsx("span",{className:"option-color",style:{backgroundColor:t.color}}),L===e?n.jsx("input",{type:"text",value:w,onChange:s=>h(s.target.value),onBlur:()=>$(e),onKeyPress:s=>s.key==="Enter"&&$(e),autoFocus:!0,className:"edit-input"}):n.jsx("span",{className:"option-text",children:t.text}),n.jsx("button",{onClick:()=>D(e),children:n.jsx(ne,{size:14})})]},e))})]})]})};export{ce as RandomSpinnerWidget,pe as widgetConfig};
