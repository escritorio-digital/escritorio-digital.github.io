import{u as ee,r as i,s as te,j as t,F as re,Y as P,g as W}from"./index-BenRa9M0.js";import{Z as be}from"./index-BenRa9M0.js";import{r as se,s as ne,d as oe}from"./saveDialog-Cj7A06am.js";import{r as ae}from"./openDialog-H-OCpcqq.js";import{E as ie}from"./expand-BXcofkol.js";const le=n=>n==="byCount"||n==="bySize",ue=n=>Array.isArray(n)&&n.every(o=>Array.isArray(o)&&o.every(d=>typeof d=="string")),ce=n=>{try{const o=JSON.parse(n);return!o||typeof o!="object"||o.version!==1||typeof o.studentList!="string"||!le(o.mode)||typeof o.groupValue!="number"||!Number.isFinite(o.groupValue)||!ue(o.generatedGroups)?null:{version:1,studentList:o.studentList,generatedGroups:o.generatedGroups,mode:o.mode,groupValue:o.groupValue}}catch{return null}},he=()=>{const{t:n}=ee(),[o,d]=i.useState(`Ana
Beatriz
Carlos
Daniela
Esteban
Fernanda
Gael
Hilda
IvÃ¡n
Julia`),[h,v]=i.useState("byCount"),[p,M]=i.useState(3),[l,x]=i.useState([]),[c,C]=i.useState(!1),[$,N]=i.useState(!1),G=i.useRef(null),F=i.useRef(null),k=i.useRef(null),T=i.useRef({titleSize:0,textSize:0,minCardWidth:0,containerHeight:0}),H=i.useCallback(e=>{d(e.studentList),x(e.generatedGroups),v(e.mode),M(Math.max(1,Math.floor(e.groupValue)))},[]),A=i.useCallback(e=>{const r=ce(e);if(r){H(r);return}d(e),x([])},[H]),f=i.useCallback(async e=>{const r=await e.text();A(r)},[A]);i.useEffect(()=>{if(!c)return;const e=G.current,r=F.current,s=k.current;if(!e||!r||!s)return;let a=0;const u=()=>{if(!e||!r||!s)return;const y=getComputedStyle(e),K=parseFloat(y.paddingTop)||0,U=parseFloat(y.paddingBottom)||0,Y=parseFloat(y.rowGap||y.gap)||0,w=Math.max(120,e.clientHeight-r.offsetHeight-K-U-Y);s.style.height=`${w}px`;const R=s.clientWidth,Z=Math.max(1,l.length),Q=Math.min(Z,Math.max(1,Math.floor(R/320))),j=Math.max(240,Math.floor(R/Q)-16),I=16,X=Math.min(40,Math.max(20,Math.floor(w/5)));let V=I,L=X,g=I;for(let O=0;O<12;O+=1){const m=Math.floor((V+L)/2);e.style.setProperty("--group-text-size",`${m}px`),e.style.setProperty("--group-title-size",`${Math.round(m*1.2)}px`),e.style.setProperty("--group-card-min",`${j}px`),s.scrollHeight<=s.clientHeight?(g=m,V=m+1):L=m-1}const z=Math.round(g*1.2),_=T.current;(_.textSize!==g||_.titleSize!==z||_.minCardWidth!==j||_.containerHeight!==w)&&(T.current={textSize:g,titleSize:z,minCardWidth:j,containerHeight:w},e.style.setProperty("--group-text-size",`${g}px`),e.style.setProperty("--group-title-size",`${z}px`),e.style.setProperty("--group-card-min",`${j}px`))},b=()=>{cancelAnimationFrame(a),a=requestAnimationFrame(u)};b();const S=new ResizeObserver(b);return S.observe(e),S.observe(s),()=>{cancelAnimationFrame(a),S.disconnect()}},[c,l]);const B=async()=>{const e=await ae({accept:".txt"});if(!e)return;if(e.source==="local"){const[a]=e.files;a&&await f(a);return}const[r]=e.entryIds;if(!r)return;const s=await W(r);s?.blob&&await f(s.blob)};i.useEffect(()=>te("group-generator",async({entryId:r})=>{const s=await W(r);s?.blob&&await f(s.blob)}),[f]);const q=()=>{const e=o.split(`
`).map(a=>a.trim()).filter(a=>a);if(e.length===0||p<=0){x([]);return}const r=[...e].sort(()=>Math.random()-.5),s=[];if(h==="byCount"){const a=Math.max(1,Math.min(p,e.length));for(let u=0;u<a;u++)s.push([]);r.forEach((u,b)=>{s[b%a].push(u)})}else{const a=Math.max(1,p);for(let u=0;u<r.length;u+=a)s.push(r.slice(u,u+a))}x(s)},E=()=>l.map((e,r)=>{const s=n("widgets.group_generator.group_title",{number:r+1}),a=e.map(u=>`- ${u}`);return[s,...a].join(`
`)}).join(`

`),J=async()=>{if(l.length===0)return;const e=E();try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.left="-9999px",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}N(!0),window.setTimeout(()=>N(!1),1500)}catch{N(!1)}},D=async()=>{if(l.length===0)return;const e=await se("grupos.txt");if(e?.destination==="file-manager"){const r={version:1,studentList:o,generatedGroups:l,mode:h,groupValue:p},s=new Blob([JSON.stringify(r,null,2)],{type:"application/json;charset=utf-8"});await ne({blob:s,filename:e.filename,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:e.parentId});return}if(e?.destination==="download"){const r=E(),s=new Blob([r],{type:"text/plain;charset=utf-8"});oe(s,e.filename)}};return t.jsxs("div",{className:"group-generator-widget",children:[t.jsxs("div",{className:"input-panel",children:[t.jsx("label",{className:"panel-label",children:n("widgets.group_generator.student_list_label")}),t.jsx("textarea",{value:o,onChange:e=>d(e.target.value),placeholder:n("widgets.group_generator.placeholder")}),t.jsxs("button",{onClick:B,className:"upload-button",children:[t.jsx(re,{size:16})," ",n("widgets.group_generator.load_from_file")]})]}),t.jsxs("div",{className:"controls-panel",children:[t.jsxs("div",{className:"mode-selection",children:[t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:h==="byCount",onChange:()=>v("byCount")}),n("widgets.group_generator.number_of_groups")]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:h==="bySize",onChange:()=>v("bySize")}),n("widgets.group_generator.students_per_group")]})]}),t.jsx("input",{type:"number",value:p,onChange:e=>M(Math.max(1,parseInt(e.target.value)||1)),className:"group-value-input",min:"1"}),t.jsx("button",{onClick:q,className:"generate-button",children:n("widgets.group_generator.generate_groups")})]}),t.jsxs("div",{className:"output-panel",children:[t.jsxs("div",{className:"output-header",children:[t.jsx("label",{className:"panel-label",children:n("widgets.group_generator.generated_groups_label")}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"expand-button",onClick:J,disabled:l.length===0,title:n("widgets.group_generator.copy_groups"),children:t.jsx("span",{children:n($?"widgets.group_generator.copied":"widgets.group_generator.copy_groups")})}),t.jsx("button",{className:"expand-button",onClick:D,disabled:l.length===0,title:n("widgets.group_generator.download_groups"),children:t.jsx("span",{children:n("widgets.group_generator.download_groups")})}),t.jsxs("button",{className:"expand-button",onClick:()=>C(!c),disabled:l.length===0,children:[c?t.jsx(P,{size:16}):t.jsx(ie,{size:16}),t.jsx("span",{children:n(c?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large")})]})]})]}),t.jsx("div",{className:"groups-container",children:l.length>0?l.map((e,r)=>t.jsxs("div",{className:"group-card",children:[t.jsx("h4",{className:"group-title",children:n("widgets.group_generator.group_title",{number:r+1})}),t.jsx("ul",{children:e.map(s=>t.jsx("li",{children:s},s))})]},r)):t.jsx("p",{className:"no-groups-message",children:n("widgets.group_generator.no_groups_message")})})]}),c&&t.jsx("div",{className:"groups-overlay",onClick:()=>C(!1),children:t.jsxs("div",{className:"groups-overlay-content",ref:G,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"groups-overlay-header",ref:F,children:[t.jsx("h3",{children:n("widgets.group_generator.generated_groups_label")}),t.jsxs("button",{className:"expand-button",onClick:()=>C(!1),children:[t.jsx(P,{size:16}),t.jsx("span",{children:n("widgets.group_generator.close_large_view")})]})]}),t.jsx("div",{className:"groups-container groups-container-large",ref:k,children:l.length>0?l.map((e,r)=>t.jsxs("div",{className:"group-card group-card-large",children:[t.jsx("h4",{className:"group-title",children:n("widgets.group_generator.group_title",{number:r+1})}),t.jsx("ul",{children:e.map(s=>t.jsx("li",{children:s},s))})]},r)):t.jsx("p",{className:"no-groups-message",children:n("widgets.group_generator.no_groups_message")})})]})})]})};export{he as GroupGeneratorWidget,be as widgetConfig};
