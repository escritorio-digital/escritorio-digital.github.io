import{R as F,r as $,d as Ve,j as H,b as We}from"./react-vendor-WCYW3yxo.js";import{E as Ue,d as Ke,f as qe,e as xt,N as X,S as z,T as I,P as C,g as L,k as Je,D as Ge,h as Xe,i as Ye,j as Yt,F as B,l as Qe,m as mt,n as Ze,o as tr,p as er,q as rr,s as nr,t as sr,u as or,v as ir,w as Qt,x as ar,y as lr,z as cr,A as ur,B as dr,C as pr,G as fr,H as hr,I as mr,J as gr,K as vr,L as yr,M as _t,O as br,Q as rt,U as kr,V as Mr,W as wr,X as Sr,Y as Er,Z as Zt,_ as xr,$ as Dt,a0 as Tr,a1 as te,a2 as Cr,a3 as Ar,a4 as Lr,a5 as Pr,a6 as Ir,a7 as Rr,a8 as st,a9 as Tt}from"./vendor-DCW5Txpp.js";var $r=Object.defineProperty,ee=(t,e)=>{for(var r in e)$r(t,r,{get:e[r],enumerable:!0})};function lt(t){const{state:e,transaction:r}=t;let{selection:n}=r,{doc:s}=r,{storedMarks:o}=r;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return n},get doc(){return s},get tr(){return n=r.selection,s=r.doc,o=r.storedMarks,r}}}var ct=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:n}=e,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(t).map(([i,a])=>[i,(...c)=>{const u=a(...c)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:n,state:s}=this,{view:o}=n,i=[],a=!!t,l=t||s.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(l),i.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(r).map(([d,p])=>[d,(...m)=>{const g=this.buildProps(l,e),v=p(...m)(g);return i.push(v),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:r}=this,n=!1,s=t||r.tr,o=this.buildProps(s,n);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,n)}}buildProps(t,e=!0){const{rawCommands:r,editor:n,state:s}=this,{view:o}=n,i={tr:t,editor:n,view:o,state:lt({state:s,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([a,l])=>[a,(...c)=>l(...c)(i)]))}};return i}},Or=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(n=>n.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(n=>n!==e):delete this.callbacks[t]),this}once(t,e){const r=(...n)=>{this.off(t,r),e.apply(this,n)};return this.on(t,r)}removeAllListeners(){this.callbacks={}}};function re(t,e){const r=new Xe(t);return e.forEach(n=>{n.steps.forEach(s=>{r.step(s)})}),r}var ne=t=>{const e=t.childNodes;for(let r=e.length-1;r>=0;r-=1){const n=e[r];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&ne(n)}return t};function Q(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(e,"text/html").body;return ne(r)}function J(t,e,r){if(t instanceof Qe||t instanceof B)return t;r={slice:!0,parseOptions:{},...r};const n=typeof t=="object"&&t!==null,s=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return B.fromArray(t.map(a=>e.nodeFromJSON(a)));const i=e.nodeFromJSON(t);return r.errorOnInvalidContent&&i.check(),i}catch(o){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),J("",e,r)}if(s){if(r.errorOnInvalidContent){let i=!1,a="";const l=new Yt({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(i=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(r.slice?mt.fromSchema(l).parseSlice(Q(t),r.parseOptions):mt.fromSchema(l).parse(Q(t),r.parseOptions),r.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=mt.fromSchema(e);return r.slice?o.parseSlice(Q(t),r.parseOptions).content:o.parse(Q(t),r.parseOptions)}return J("",e,r)}function bt(t,e,r={},n={}){return J(t,e,{slice:!1,parseOptions:r,errorOnInvalidContent:n.errorOnInvalidContent})}function Nr(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function Br(t,e,r){const n=[];return t.nodesBetween(e.from,e.to,(s,o)=>{r(s)&&n.push({node:s,pos:o})}),n}function _r(t,e){for(let r=t.depth;r>0;r-=1){const n=t.node(r);if(e(n))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:n}}}function ut(t){return e=>_r(e.$from,t)}function y(t,e,r){return t.config[e]===void 0&&t.parent?y(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind({...r,parent:t.parent?y(t.parent,e,r):null}):t.config[e]}function Ct(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},n=y(e,"addExtensions",r);return n?[e,...Ct(n())]:e}).flat(10)}function At(t,e){const r=Ge.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(r),s.innerHTML}function se(t){return typeof t=="function"}function M(t,e=void 0,...r){return se(t)?e?t.bind(e)(...r):t(...r):t}function Dr(t={}){return Object.keys(t).length===0&&t.constructor===Object}function G(t){const e=t.filter(s=>s.type==="extension"),r=t.filter(s=>s.type==="node"),n=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:n}}function oe(t){const e=[],{nodeExtensions:r,markExtensions:n}=G(t),s=[...r,...n],o={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage,extensions:s},l=y(i,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([p,f])=>{e.push({type:d,name:p,attribute:{...o,...f}})})})})}),s.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},l=y(i,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const p={...o,...d};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:i.name,name:u,attribute:p})})}),e}function S(...t){return t.filter(e=>!!e).reduce((e,r)=>{const n={...e};return Object.entries(r).forEach(([s,o])=>{if(!n[s]){n[s]=o;return}if(s==="class"){const a=o?String(o).split(" "):[],l=n[s]?n[s].split(" "):[],c=a.filter(u=>!l.includes(u));n[s]=[...l,...c].join(" ")}else if(s==="style"){const a=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[s]?n[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,p]=u.split(":").map(f=>f.trim());c.set(d,p)}),a.forEach(u=>{const[d,p]=u.split(":").map(f=>f.trim());c.set(d,p)}),n[s]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[s]=o}),n},{})}function ot(t,e){return e.filter(r=>r.type===t.type.name).filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,n)=>S(r,n),{})}function Hr(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function Ht(t,e){return"style"in t?t:{...t,getAttrs:r=>{const n=t.getAttrs?t.getAttrs(r):t.attrs;if(n===!1)return!1;const s=e.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(r):Hr(r.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...n,...s}}}}function jt(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&Dr(r)?!1:r!=null))}function jr(t,e){var r;const n=oe(t),{nodeExtensions:s,markExtensions:o}=G(t),i=(r=s.find(c=>y(c,"topNode")))==null?void 0:r.name,a=Object.fromEntries(s.map(c=>{const u=n.filter(h=>h.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((h,b)=>{const k=y(b,"extendNodeSchema",d);return{...h,...k?k(c):{}}},{}),f=jt({...p,content:M(y(c,"content",d)),marks:M(y(c,"marks",d)),group:M(y(c,"group",d)),inline:M(y(c,"inline",d)),atom:M(y(c,"atom",d)),selectable:M(y(c,"selectable",d)),draggable:M(y(c,"draggable",d)),code:M(y(c,"code",d)),whitespace:M(y(c,"whitespace",d)),linebreakReplacement:M(y(c,"linebreakReplacement",d)),defining:M(y(c,"defining",d)),isolating:M(y(c,"isolating",d)),attrs:Object.fromEntries(u.map(h=>{var b,k;return[h.name,{default:(b=h?.attribute)==null?void 0:b.default,validate:(k=h?.attribute)==null?void 0:k.validate}]}))}),m=M(y(c,"parseHTML",d));m&&(f.parseDOM=m.map(h=>Ht(h,u)));const g=y(c,"renderHTML",d);g&&(f.toDOM=h=>g({node:h,HTMLAttributes:ot(h,u)}));const v=y(c,"renderText",d);return v&&(f.toText=v),[c.name,f]})),l=Object.fromEntries(o.map(c=>{const u=n.filter(v=>v.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((v,h)=>{const b=y(h,"extendMarkSchema",d);return{...v,...b?b(c):{}}},{}),f=jt({...p,inclusive:M(y(c,"inclusive",d)),excludes:M(y(c,"excludes",d)),group:M(y(c,"group",d)),spanning:M(y(c,"spanning",d)),code:M(y(c,"code",d)),attrs:Object.fromEntries(u.map(v=>{var h,b;return[v.name,{default:(h=v?.attribute)==null?void 0:h.default,validate:(b=v?.attribute)==null?void 0:b.validate}]}))}),m=M(y(c,"parseHTML",d));m&&(f.parseDOM=m.map(v=>Ht(v,u)));const g=y(c,"renderHTML",d);return g&&(f.toDOM=v=>g({mark:v,HTMLAttributes:ot(v,u)})),[c.name,f]}));return new Yt({topNode:i,nodes:a,marks:l})}function zr(t){const e=t.filter((r,n)=>t.indexOf(r)!==n);return Array.from(new Set(e))}function Lt(t){return t.sort((r,n)=>{const s=y(r,"priority")||100,o=y(n,"priority")||100;return s>o?-1:s<o?1:0})}function ie(t){const e=Lt(Ct(t)),r=zr(e.map(n=>n.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function ae(t,e,r){const{from:n,to:s}=e,{blockSeparator:o=`

`,textSerializers:i={}}=r||{};let a="";return t.nodesBetween(n,s,(l,c,u,d)=>{var p;l.isBlock&&c>n&&(a+=o);const f=i?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(p=l?.text)==null?void 0:p.slice(Math.max(n,c)-c,s-c))}),a}function Fr(t,e){const r={from:0,to:t.content.size};return ae(t,r,e)}function le(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}function N(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}function ce(t,e){const r=N(e,t.schema),{from:n,to:s,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,s,l=>{i.push(...l.marks)});const a=i.find(l=>l.type.name===r.name);return a?{...a.attrs}:{}}function E(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function Vr(t,e){const r=E(e,t.schema),{from:n,to:s}=t.selection,o=[];t.doc.nodesBetween(n,s,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===r.name);return i?{...i.attrs}:{}}function dt(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function ue(t,e){const r=dt(typeof e=="string"?e:e.name,t.schema);return r==="node"?Vr(t,e):r==="mark"?ce(t,e):{}}function Wr(t,e=JSON.stringify){const r={};return t.filter(n=>{const s=e(n);return Object.prototype.hasOwnProperty.call(r,s)?!1:r[s]=!0})}function Ur(t){const e=Wr(t);return e.length===1?e:e.filter((r,n)=>!e.filter((o,i)=>i!==n).some(o=>r.oldRange.from>=o.oldRange.from&&r.oldRange.to<=o.oldRange.to&&r.newRange.from>=o.newRange.from&&r.newRange.to<=o.newRange.to))}function de(t){const{mapping:e,steps:r}=t,n=[];return e.maps.forEach((s,o)=>{const i=[];if(s.ranges.length)s.forEach((a,l)=>{i.push({from:a,to:l})});else{const{from:a,to:l}=r[o];if(a===void 0||l===void 0)return;i.push({from:a,to:l})}i.forEach(({from:a,to:l})=>{const c=e.slice(o).map(a,-1),u=e.slice(o).map(l),d=e.invert().map(c,-1),p=e.invert().map(u);n.push({oldRange:{from:d,to:p},newRange:{from:c,to:u}})})}),Ur(n)}function Pt(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function it(t,e,r={strict:!0}){const n=Object.keys(e);return n.length?n.every(s=>r.strict?e[s]===t[s]:Pt(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function pe(t,e,r={}){return t.find(n=>n.type===e&&it(Object.fromEntries(Object.keys(r).map(s=>[s,n.attrs[s]])),r))}function zt(t,e,r={}){return!!pe(t,e,r)}function It(t,e,r){var n;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(r=r||((n=s.node.marks[0])==null?void 0:n.attrs),!pe([...s.node.marks],e,r)))return;let i=s.index,a=t.start()+s.offset,l=i+1,c=a+s.node.nodeSize;for(;i>0&&zt([...t.parent.child(i-1).marks],e,r);)i-=1,a-=t.parent.child(i).nodeSize;for(;l<t.parent.childCount&&zt([...t.parent.child(l).marks],e,r);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Rt(t,e,r){const n=[];return t===e?r.resolve(t).marks().forEach(s=>{const o=r.resolve(t),i=It(o,s.type);i&&n.push({mark:s,...i})}):r.nodesBetween(t,e,(s,o)=>{!s||s?.nodeSize===void 0||n.push(...s.marks.map(i=>({from:o,to:o+s.nodeSize,mark:i})))}),n}var Kr=(t,e,r,n=20)=>{const s=t.doc.resolve(r);let o=n,i=null;for(;o>0&&i===null;){const a=s.node(o);a?.type.name===e?i=a:o-=1}return[i,o]};function gt(t,e){return e.nodes[t]||e.marks[t]||null}function nt(t,e,r){return Object.fromEntries(Object.entries(r).filter(([n])=>{const s=t.find(o=>o.type===e&&o.name===n);return s?s.attribute.keepOnSplit:!1}))}var qr=(t,e=500)=>{let r="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(s,o,i,a)=>{var l,c;const u=((c=(l=s.type.spec).toText)==null?void 0:c.call(l,{node:s,pos:o,parent:i,index:a}))||s.textContent||"%leaf%";r+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,n-o))}),r};function kt(t,e,r={}){const{empty:n,ranges:s}=t.selection,o=e?N(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>it(d.attrs,r,{strict:!1}));let i=0;const a=[];if(s.forEach(({$from:d,$to:p})=>{const f=d.pos,m=p.pos;t.doc.nodesBetween(f,m,(g,v)=>{if(!g.isText&&!g.marks.length)return;const h=Math.max(f,v),b=Math.min(m,v+g.nodeSize),k=b-h;i+=k,a.push(...g.marks.map(T=>({mark:T,from:h,to:b})))})}),i===0)return!1;const l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>it(d.mark.attrs,r,{strict:!1})).reduce((d,p)=>d+p.to-p.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,p)=>d+p.to-p.from,0);return(l>0?l+c:l)>=i}function _(t,e,r={}){const{from:n,to:s,empty:o}=t.selection,i=e?E(e,t.schema):null,a=[];t.doc.nodesBetween(n,s,(d,p)=>{if(d.isText)return;const f=Math.max(n,p),m=Math.min(s,p+d.nodeSize);a.push({node:d,from:f,to:m})});const l=s-n,c=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>it(d.node.attrs,r,{strict:!1}));return o?!!c.length:c.reduce((d,p)=>d+p.to-p.from,0)>=l}function Jr(t,e,r={}){if(!e)return _(t,null,r)||kt(t,null,r);const n=dt(e,t.schema);return n==="node"?_(t,e,r):n==="mark"?kt(t,e,r):!1}var Gr=(t,e)=>{const{$from:r,$to:n,$anchor:s}=t.selection;if(e){const o=ut(a=>a.type.name===e)(t.selection);if(!o)return!1;const i=t.doc.resolve(o.pos+1);return s.pos+1===i.end()}return!(n.parentOffset<n.parent.nodeSize-2||r.pos!==n.pos)},Xr=t=>{const{$from:e,$to:r}=t.selection;return!(e.parentOffset>0||e.pos!==r.pos)};function Ft(t,e){return Array.isArray(e)?e.some(r=>(typeof r=="string"?r:r.name)===t.name):e}function Vt(t,e){const{nodeExtensions:r}=G(e),n=r.find(i=>i.name===t);if(!n)return!1;const s={name:n.name,options:n.options,storage:n.storage},o=M(y(n,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function pt(t,{checkChildren:e=!0,ignoreWhitespace:r=!1}={}){var n;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!=null?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(o=>{s!==!1&&(pt(o,{ignoreWhitespace:r,checkChildren:e})||(s=!1))}),s}return!1}function fe(t){return t instanceof X}function he(t){return t instanceof I}function j(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function me(t,e=null){if(!e)return null;const r=z.atStart(t),n=z.atEnd(t);if(e==="start"||e===!0)return r;if(e==="end")return n;const s=r.from,o=n.to;return e==="all"?I.create(t,j(0,s,o),j(t.content.size,s,o)):I.create(t,j(e,s,o),j(e,s,o))}function Yr(t,e,r){const n=t.steps.length-1;if(n<e)return;const s=t.steps[n];if(!(s instanceof Sr||s instanceof Er))return;const o=t.mapping.maps[n];let i=0;o.forEach((a,l,c,u)=>{i===0&&(i=u)}),t.setSelection(z.near(t.doc.resolve(i),r))}var ft=class{constructor(t){this.find=t.find,this.handler=t.handler}},Qr=(t,e)=>{if(Pt(e))return e.exec(t);const r=e(t);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=t,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function Z(t){var e;const{editor:r,from:n,to:s,text:o,rules:i,plugin:a}=t,{view:l}=r;if(l.composing)return!1;const c=l.state.doc.resolve(n);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let u=!1;const d=qr(c)+o;return i.forEach(p=>{if(u)return;const f=Qr(d,p.find);if(!f)return;const m=l.state.tr,g=lt({state:l.state,transaction:m}),v={from:n-(f[0].length-o.length),to:s},{commands:h,chain:b,can:k}=new ct({editor:r,state:g});p.handler({state:g,range:v,match:f,commands:h,chain:b,can:k})===null||!m.steps.length||(m.setMeta(a,{transform:m,from:n,to:s,text:o}),l.dispatch(m),u=!0)}),u}function Zr(t){const{editor:e,rules:r}=t,n=new C({state:{init(){return null},apply(s,o,i){const a=s.getMeta(n);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=At(B.from(u),i.schema);const{from:d}=l,p=d+u.length;Z({editor:e,from:d,to:p,text:u,rules:r,plugin:n})}),s.selectionSet||s.docChanged?null:o}},props:{handleTextInput(s,o,i,a){return Z({editor:e,from:o,to:i,text:a,rules:r,plugin:n})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&Z({editor:e,from:o.pos,to:o.pos,text:"",rules:r,plugin:n})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:i}=s.state.selection;return i?Z({editor:e,from:i.pos,to:i.pos,text:`
`,rules:r,plugin:n}):!1}},isInputRules:!0});return n}function tn(t){return Object.prototype.toString.call(t).slice(8,-1)}function tt(t){return tn(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function ge(t,e){const r={...t};return tt(t)&&tt(e)&&Object.keys(e).forEach(n=>{tt(e[n])&&tt(t[n])?r[n]=ge(t[n],e[n]):r[n]=e[n]}),r}var $t=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...M(y(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...M(y(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>ge(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},W=class ve extends $t{constructor(){super(...arguments),this.type="mark"}static create(e={}){const r=typeof e=="function"?e():e;return new ve(r)}static handleExit({editor:e,mark:r}){const{tr:n}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const i=s.marks();if(!!!i.find(c=>c?.type.name===r.name))return!1;const l=i.find(c=>c?.type.name===r.name);return l&&n.removeStoredMark(l),n.insertText(" ",s.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function en(t){return typeof t=="number"}var rn=class{constructor(t){this.find=t.find,this.handler=t.handler}},nn=(t,e,r)=>{if(Pt(e))return[...t.matchAll(e)];const n=e(t,r);return n?n.map(s=>{const o=[s.text];return o.index=s.index,o.input=t,o.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(s.replaceWith)),o}):[]};function sn(t){const{editor:e,state:r,from:n,to:s,rule:o,pasteEvent:i,dropEvent:a}=t,{commands:l,chain:c,can:u}=new ct({editor:e,state:r}),d=[];return r.doc.nodesBetween(n,s,(f,m)=>{if(!f.isTextblock||f.type.spec.code)return;const g=Math.max(n,m),v=Math.min(s,m+f.content.size),h=f.textBetween(g-m,v-m,void 0,"￼");nn(h,o.find,i).forEach(k=>{if(k.index===void 0)return;const T=g+k.index+1,w=T+k[0].length,A={from:r.tr.mapping.map(T),to:r.tr.mapping.map(w)},P=o.handler({state:r,range:A,match:k,commands:l,chain:c,can:u,pasteEvent:i,dropEvent:a});d.push(P)})}),d.every(f=>f!==null)}var et=null,on=t=>{var e;const r=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=r.clipboardData)==null||e.setData("text/html",t),r};function an(t){const{editor:e,rules:r}=t;let n=null,s=!1,o=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:p,rule:f,pasteEvt:m})=>{const g=u.tr,v=lt({state:u,transaction:g});if(!(!sn({editor:e,state:v,from:Math.max(d-1,0),to:p.b-1,rule:f,pasteEvent:m,dropEvent:a})||!g.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return r.map(u=>new C({view(d){const p=m=>{var g;n=(g=d.dom.parentElement)!=null&&g.contains(m.target)?d.dom.parentElement:null,n&&(et=e)},f=()=>{et&&(et=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,p)=>{if(o=n===d.dom.parentElement,a=p,!o){const f=et;f?.isEditable&&setTimeout(()=>{const m=f.state.selection;m&&f.commands.deleteRange({from:m.from,to:m.to})},10)}return!1},paste:(d,p)=>{var f;const m=(f=p.clipboardData)==null?void 0:f.getData("text/html");return i=p,s=!!m?.includes("data-pm-slice"),!1}}},appendTransaction:(d,p,f)=>{const m=d[0],g=m.getMeta("uiEvent")==="paste"&&!s,v=m.getMeta("uiEvent")==="drop"&&!o,h=m.getMeta("applyPasteRules"),b=!!h;if(!g&&!v&&!b)return;if(b){let{text:w}=h;typeof w=="string"?w=w:w=At(B.from(w),f.schema);const{from:A}=h,P=A+w.length,O=on(w);return l({rule:u,state:f,from:A,to:{b:P},pasteEvt:O})}const k=p.doc.content.findDiffStart(f.doc.content),T=p.doc.content.findDiffEnd(f.doc.content);if(!(!en(k)||!T||k===T.b))return l({rule:u,state:f,from:k,to:T,pasteEvt:i})}}))}var ht=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=ie(t),this.schema=jr(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:gt(e.name,this.schema)},n=y(e,"addCommands",r);return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this,e=Lt([...this.extensions].reverse()),r=[],n=[],s=e.map(o=>{const i={name:o.name,options:o.options,storage:this.editor.extensionStorage[o.name],editor:t,type:gt(o.name,this.schema)},a=[],l=y(o,"addKeyboardShortcuts",i);let c={};if(o.type==="mark"&&y(o,"exitable",i)&&(c.ArrowRight=()=>W.handleExit({editor:t,mark:o})),l){const m=Object.fromEntries(Object.entries(l()).map(([g,v])=>[g,()=>v({editor:t})]));c={...c,...m}}const u=Je(c);a.push(u);const d=y(o,"addInputRules",i);Ft(o,t.options.enableInputRules)&&d&&r.push(...d());const p=y(o,"addPasteRules",i);Ft(o,t.options.enablePasteRules)&&p&&n.push(...p());const f=y(o,"addProseMirrorPlugins",i);if(f){const m=f();a.push(...m)}return a}).flat();return[Zr({editor:t,rules:r}),...an({editor:t,rules:n}),...s]}get attributes(){return oe(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=G(this.extensions);return Object.fromEntries(e.filter(r=>!!y(r,"addNodeView")).map(r=>{const n=this.attributes.filter(a=>a.type===r.name),s={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:E(r.name,this.schema)},o=y(r,"addNodeView",s);if(!o)return[];const i=(a,l,c,u,d)=>{const p=ot(a,n);return o()({node:a,view:l,getPos:c,decorations:u,innerDecorations:d,editor:t,extension:r,HTMLAttributes:p})};return[r.name,i]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=G(this.extensions);return Object.fromEntries(e.filter(r=>!!y(r,"addMarkView")).map(r=>{const n=this.attributes.filter(a=>a.type===r.name),s={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:N(r.name,this.schema)},o=y(r,"addMarkView",s);if(!o)return[];const i=(a,l,c)=>{const u=ot(a,n);return o()({mark:a,view:l,inline:c,editor:t,extension:r,HTMLAttributes:u,updateAttributes:d=>{Ss(a,t,d)}})};return[r.name,i]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var r;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:gt(e.name,this.schema)};e.type==="mark"&&((r=M(y(e,"keepOnSplit",n)))==null||r)&&this.splittableMarks.push(e.name);const s=y(e,"onBeforeCreate",n),o=y(e,"onCreate",n),i=y(e,"onUpdate",n),a=y(e,"onSelectionUpdate",n),l=y(e,"onTransaction",n),c=y(e,"onFocus",n),u=y(e,"onBlur",n),d=y(e,"onDestroy",n);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),i&&this.editor.on("update",i),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};ht.resolve=ie;ht.sort=Lt;ht.flatten=Ct;var ln={};ee(ln,{ClipboardTextSerializer:()=>be,Commands:()=>we,Delete:()=>Se,Drop:()=>Ee,Editable:()=>xe,FocusEvents:()=>Ce,Keymap:()=>Ae,Paste:()=>Le,Tabindex:()=>Pe,focusEventsPluginKey:()=>Te});var x=class ye extends $t{constructor(){super(...arguments),this.type="extension"}static create(e={}){const r=typeof e=="function"?e():e;return new ye(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}},be=x.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new C({key:new L("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:n,selection:s}=e,{ranges:o}=s,i=Math.min(...o.map(u=>u.$from.pos)),a=Math.max(...o.map(u=>u.$to.pos)),l=le(r);return ae(n,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),ke={};ee(ke,{blur:()=>cn,clearContent:()=>un,clearNodes:()=>dn,command:()=>pn,createParagraphNear:()=>fn,cut:()=>hn,deleteCurrentNode:()=>mn,deleteNode:()=>gn,deleteRange:()=>vn,deleteSelection:()=>yn,enter:()=>bn,exitCode:()=>kn,extendMarkRange:()=>Mn,first:()=>wn,focus:()=>En,forEach:()=>xn,insertContent:()=>Tn,insertContentAt:()=>An,joinBackward:()=>In,joinDown:()=>Pn,joinForward:()=>Rn,joinItemBackward:()=>$n,joinItemForward:()=>On,joinTextblockBackward:()=>Nn,joinTextblockForward:()=>Bn,joinUp:()=>Ln,keyboardShortcut:()=>Dn,lift:()=>Hn,liftEmptyBlock:()=>jn,liftListItem:()=>zn,newlineInCode:()=>Fn,resetAttributes:()=>Vn,scrollIntoView:()=>Wn,selectAll:()=>Un,selectNodeBackward:()=>Kn,selectNodeForward:()=>qn,selectParentNode:()=>Jn,selectTextblockEnd:()=>Gn,selectTextblockStart:()=>Xn,setContent:()=>Yn,setMark:()=>Zn,setMeta:()=>ts,setNode:()=>es,setNodeSelection:()=>rs,setTextSelection:()=>ns,sinkListItem:()=>ss,splitBlock:()=>os,splitListItem:()=>is,toggleList:()=>as,toggleMark:()=>ls,toggleNode:()=>cs,toggleWrap:()=>us,undoInputRule:()=>ds,unsetAllMarks:()=>ps,unsetMark:()=>fs,updateAttributes:()=>hs,wrapIn:()=>ms,wrapInList:()=>gs});var cn=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(e.dom.blur(),(r=window?.getSelection())==null||r.removeAllRanges())}),!0),un=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),dn=()=>({state:t,tr:e,dispatch:r})=>{const{selection:n}=e,{ranges:s}=n;return r&&s.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),p=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(p);if(!f)return;const m=Ze(f);if(a.type.isTextblock){const{defaultType:g}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,g)}(m||m===0)&&e.lift(f,m)})}),!0},pn=t=>e=>t(e),fn=()=>({state:t,dispatch:e})=>tr(t,e),hn=(t,e)=>({editor:r,tr:n})=>{const{state:s}=r,o=s.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const i=n.mapping.map(e);return n.insert(i,o.content),n.setSelection(new I(n.doc.resolve(Math.max(i-1,0)))),!0},mn=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,n=r.$anchor.node();if(n.content.size>0)return!1;const s=t.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===n.type){if(e){const a=s.before(o),l=s.after(o);t.delete(a,l).scrollIntoView()}return!0}return!1},gn=t=>({tr:e,state:r,dispatch:n})=>{const s=E(t,r.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===s){if(n){const l=o.before(i),c=o.after(i);e.delete(l,c).scrollIntoView()}return!0}return!1},vn=t=>({tr:e,dispatch:r})=>{const{from:n,to:s}=t;return r&&e.delete(n,s),!0},yn=()=>({state:t,dispatch:e})=>er(t,e),bn=()=>({commands:t})=>t.keyboardShortcut("Enter"),kn=()=>({state:t,dispatch:e})=>rr(t,e),Mn=(t,e={})=>({tr:r,state:n,dispatch:s})=>{const o=N(t,n.schema),{doc:i,selection:a}=r,{$from:l,from:c,to:u}=a;if(s){const d=It(l,o,e);if(d&&d.from<=c&&d.to>=u){const p=I.create(i,d.from,d.to);r.setSelection(p)}}return!0},wn=t=>e=>{const r=typeof t=="function"?t(e):t;for(let n=0;n<r.length;n+=1)if(r[n](e))return!0;return!1};function Sn(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ot(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var En=(t=null,e={})=>({editor:r,view:n,tr:s,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{(Ot()||Sn())&&n.dom.focus(),requestAnimationFrame(()=>{r.isDestroyed||(n.focus(),e?.scrollIntoView&&r.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!he(r.state.selection))return i(),!0;const a=me(s.doc,t)||r.state.selection,l=r.state.selection.eq(a);return o&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),i()),!0},xn=(t,e)=>r=>t.every((n,s)=>e(n,{...r,index:s})),Tn=(t,e)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},t,e),Cn=t=>!("type"in t),An=(t,e,r)=>({tr:n,dispatch:s,editor:o})=>{var i;if(s){r={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let a;const{selection:l}=o.state,c=h=>{o.emit("contentError",{editor:o,error:h,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{J(e,o.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(h){c(h)}try{a=J(e,o.schema,{parseOptions:u,errorOnInvalidContent:(i=r.errorOnInvalidContent)!=null?i:o.options.enableContentCheck})}catch(h){return c(h),!1}let{from:d,to:p}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,m=!0;if((Cn(a)?a:[a]).forEach(h=>{h.check(),f=f?h.isText&&h.marks.length===0:!1,m=m?h.isBlock:!1}),d===p&&m){const{parent:h}=n.doc.resolve(d);h.isTextblock&&!h.type.spec.code&&!h.childCount&&(d-=1,p+=1)}let v;if(f){if(Array.isArray(e))v=e.map(h=>h.text||"").join("");else if(e instanceof B){let h="";e.forEach(b=>{b.text&&(h+=b.text)}),v=h}else typeof e=="object"&&e&&e.text?v=e.text:v=e;n.insertText(v,d,p)}else{v=a;const h=l.$from.parentOffset===0,b=l.$from.node().isText||l.$from.node().isTextblock,k=l.$from.node().content.size>0;h&&b&&k&&(d=Math.max(0,d-1)),n.replaceWith(d,p,v)}r.updateSelection&&Yr(n,n.steps.length-1,-1),r.applyInputRules&&n.setMeta("applyInputRules",{from:d,text:v}),r.applyPasteRules&&n.setMeta("applyPasteRules",{from:d,text:v})}return!0},Ln=()=>({state:t,dispatch:e})=>nr(t,e),Pn=()=>({state:t,dispatch:e})=>sr(t,e),In=()=>({state:t,dispatch:e})=>or(t,e),Rn=()=>({state:t,dispatch:e})=>ir(t,e),$n=()=>({state:t,dispatch:e,tr:r})=>{try{const n=Qt(t.doc,t.selection.$from.pos,-1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},On=()=>({state:t,dispatch:e,tr:r})=>{try{const n=Qt(t.doc,t.selection.$from.pos,1);return n==null?!1:(r.join(n,2),e&&e(r),!0)}catch{return!1}},Nn=()=>({state:t,dispatch:e})=>ar(t,e),Bn=()=>({state:t,dispatch:e})=>lr(t,e);function Me(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function _n(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let n,s,o,i;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))Ot()||Me()?i=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(r=`Alt-${r}`),s&&(r=`Ctrl-${r}`),i&&(r=`Meta-${r}`),o&&(r=`Shift-${r}`),r}var Dn=t=>({editor:e,view:r,tr:n,dispatch:s})=>{const o=_n(t).split(/-(?!$)/),i=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{r.someProp("handleKeyDown",c=>c(r,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&s&&n.maybeStep(u)}),!0},Hn=(t,e={})=>({state:r,dispatch:n})=>{const s=E(t,r.schema);return _(r,s,e)?cr(r,n):!1},jn=()=>({state:t,dispatch:e})=>ur(t,e),zn=t=>({state:e,dispatch:r})=>{const n=E(t,e.schema);return dr(n)(e,r)},Fn=()=>({state:t,dispatch:e})=>pr(t,e);function Wt(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,s)=>(r.includes(s)||(n[s]=t[s]),n),{})}var Vn=(t,e)=>({tr:r,state:n,dispatch:s})=>{let o=null,i=null;const a=dt(typeof t=="string"?t:t.name,n.schema);return a?(a==="node"&&(o=E(t,n.schema)),a==="mark"&&(i=N(t,n.schema)),s&&r.selection.ranges.forEach(l=>{n.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{o&&o===c.type&&r.setNodeMarkup(u,void 0,Wt(c.attrs,e)),i&&c.marks.length&&c.marks.forEach(d=>{i===d.type&&r.addMark(u,u+c.nodeSize,i.create(Wt(d.attrs,e)))})})}),!0):!1},Wn=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Un=()=>({tr:t,dispatch:e})=>{if(e){const r=new fr(t.doc);t.setSelection(r)}return!0},Kn=()=>({state:t,dispatch:e})=>hr(t,e),qn=()=>({state:t,dispatch:e})=>mr(t,e),Jn=()=>({state:t,dispatch:e})=>gr(t,e),Gn=()=>({state:t,dispatch:e})=>vr(t,e),Xn=()=>({state:t,dispatch:e})=>yr(t,e),Yn=(t,{errorOnInvalidContent:e,emitUpdate:r=!0,parseOptions:n={}}={})=>({editor:s,tr:o,dispatch:i,commands:a})=>{const{doc:l}=o;if(n.preserveWhitespace!=="full"){const c=bt(t,s.schema,n,{errorOnInvalidContent:e??s.options.enableContentCheck});return i&&o.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!r),!0}return i&&o.setMeta("preventUpdate",!r),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:n,errorOnInvalidContent:e??s.options.enableContentCheck})};function Qn(t,e,r){var n;const{selection:s}=e;let o=null;if(he(s)&&(o=s.$cursor),o){const a=(n=t.storedMarks)!=null?n:o.marks();return!!r.isInSet(a)||!a.some(l=>l.type.excludes(r))}const{ranges:i}=s;return i.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,p)=>{if(c)return!1;if(u.isInline){const f=!p||p.type.allowsMarkType(r),m=!!r.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(r));c=f&&m}return!c}),c})}var Zn=(t,e={})=>({tr:r,state:n,dispatch:s})=>{const{selection:o}=r,{empty:i,ranges:a}=o,l=N(t,n.schema);if(s)if(i){const c=ce(n,l);r.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(p,f)=>{const m=Math.max(f,u),g=Math.min(f+p.nodeSize,d);p.marks.find(h=>h.type===l)?p.marks.forEach(h=>{l===h.type&&r.addMark(m,g,l.create({...h.attrs,...e}))}):r.addMark(m,g,l.create(e))})});return Qn(n,r,l)},ts=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0),es=(t,e={})=>({state:r,dispatch:n,chain:s})=>{const o=E(t,r.schema);let i;return r.selection.$anchor.sameParent(r.selection.$head)&&(i=r.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:a})=>_t(o,{...i,...e})(r)?!0:a.clearNodes()).command(({state:a})=>_t(o,{...i,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},rs=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,s=j(t,0,n.content.size),o=X.create(n,s);e.setSelection(o)}return!0},ns=t=>({tr:e,dispatch:r})=>{if(r){const{doc:n}=e,{from:s,to:o}=typeof t=="number"?{from:t,to:t}:t,i=I.atStart(n).from,a=I.atEnd(n).to,l=j(s,i,a),c=j(o,i,a),u=I.create(n,l,c);e.setSelection(u)}return!0},ss=t=>({state:e,dispatch:r})=>{const n=E(t,e.schema);return br(n)(e,r)};function Ut(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const n=r.filter(s=>e?.includes(s.type.name));t.tr.ensureMarks(n)}}var os=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:n,editor:s})=>{const{selection:o,doc:i}=e,{$from:a,$to:l}=o,c=s.extensionManager.attributes,u=nt(c,a.node().type.name,a.node().attrs);if(o instanceof X&&o.node.isBlock)return!a.parentOffset||!rt(i,a.pos)?!1:(n&&(t&&Ut(r,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,p=a.depth===0?void 0:Nr(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&p?[{type:p,attrs:u}]:void 0,m=rt(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!m&&rt(e.doc,e.mapping.map(a.pos),1,p?[{type:p}]:void 0)&&(m=!0,f=p?[{type:p,attrs:u}]:void 0),n){if(m&&(o instanceof I&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),p&&!d&&!a.parentOffset&&a.parent.type!==p)){const g=e.mapping.map(a.before()),v=e.doc.resolve(g);a.node(-1).canReplaceWith(v.index(),v.index()+1,p)&&e.setNodeMarkup(e.mapping.map(a.before()),p)}t&&Ut(r,s.extensionManager.splittableMarks),e.scrollIntoView()}return m},is=(t,e={})=>({tr:r,state:n,dispatch:s,editor:o})=>{var i;const a=E(t,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const p=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let h=B.empty;const b=l.index(-1)?1:l.index(-2)?2:3;for(let O=l.depth-b;O>=l.depth-3;O-=1)h=B.from(l.node(O).copy(h));const k=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,T={...nt(p,l.node().type.name,l.node().attrs),...e},w=((i=a.contentMatch.defaultType)==null?void 0:i.createAndFill(T))||void 0;h=h.append(B.from(a.createAndFill(null,w)||void 0));const A=l.before(l.depth-(b-1));r.replace(A,l.after(-k),new kr(h,4-b,0));let P=-1;r.doc.nodesBetween(A,r.doc.content.size,(O,Fe)=>{if(P>-1)return!1;O.isTextblock&&O.content.size===0&&(P=Fe+1)}),P>-1&&r.setSelection(I.near(r.doc.resolve(P))),r.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,m={...nt(p,d.type.name,d.attrs),...e},g={...nt(p,l.node().type.name,l.node().attrs),...e};r.delete(l.pos,c.pos);const v=f?[{type:a,attrs:m},{type:f,attrs:g}]:[{type:a,attrs:m}];if(!rt(r.doc,l.pos,2))return!1;if(s){const{selection:h,storedMarks:b}=n,{splittableMarks:k}=o.extensionManager,T=b||h.$to.parentOffset&&h.$from.marks();if(r.split(l.pos,2,v).scrollIntoView(),!T||!s)return!0;const w=T.filter(A=>k.includes(A.type.name));r.ensureMarks(w)}return!0},vt=(t,e)=>{const r=ut(i=>i.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(n===void 0)return!0;const s=t.doc.nodeAt(n);return r.node.type===s?.type&&xt(t.doc,r.pos)&&t.join(r.pos),!0},yt=(t,e)=>{const r=ut(i=>i.type===e)(t.selection);if(!r)return!0;const n=t.doc.resolve(r.start).after(r.depth);if(n===void 0)return!0;const s=t.doc.nodeAt(n);return r.node.type===s?.type&&xt(t.doc,n)&&t.join(n),!0},as=(t,e,r,n={})=>({editor:s,tr:o,state:i,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:p}=s.extensionManager,f=E(t,i.schema),m=E(e,i.schema),{selection:g,storedMarks:v}=i,{$from:h,$to:b}=g,k=h.blockRange(b),T=v||g.$to.parentOffset&&g.$from.marks();if(!k)return!1;const w=ut(A=>Vt(A.type.name,d))(g);if(k.depth>=1&&w&&k.depth-w.depth<=1){if(w.node.type===f)return c.liftListItem(m);if(Vt(w.node.type.name,d)&&f.validContent(w.node.content)&&a)return l().command(()=>(o.setNodeMarkup(w.pos,f),!0)).command(()=>vt(o,f)).command(()=>yt(o,f)).run()}return!r||!T||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>vt(o,f)).command(()=>yt(o,f)).run():l().command(()=>{const A=u().wrapInList(f,n),P=T.filter(O=>p.includes(O.type.name));return o.ensureMarks(P),A?!0:c.clearNodes()}).wrapInList(f,n).command(()=>vt(o,f)).command(()=>yt(o,f)).run()},ls=(t,e={},r={})=>({state:n,commands:s})=>{const{extendEmptyMarkRange:o=!1}=r,i=N(t,n.schema);return kt(n,i,e)?s.unsetMark(i,{extendEmptyMarkRange:o}):s.setMark(i,e)},cs=(t,e,r={})=>({state:n,commands:s})=>{const o=E(t,n.schema),i=E(e,n.schema),a=_(n,o,r);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?s.setNode(i,l):s.setNode(o,{...l,...r})},us=(t,e={})=>({state:r,commands:n})=>{const s=E(t,r.schema);return _(r,s,e)?n.lift(s):n.wrapIn(s,e)},ds=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let n=0;n<r.length;n+=1){const s=r[n];let o;if(s.spec.isInputRules&&(o=s.getState(t))){if(e){const i=t.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)i.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,l))}else i.delete(o.from,o.to)}return!0}}return!1},ps=()=>({tr:t,dispatch:e})=>{const{selection:r}=t,{empty:n,ranges:s}=r;return n||e&&s.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},fs=(t,e={})=>({tr:r,state:n,dispatch:s})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:a}=r,l=N(t,n.schema),{$from:c,empty:u,ranges:d}=a;if(!s)return!0;if(u&&i){let{from:p,to:f}=a;const m=(o=c.marks().find(v=>v.type===l))==null?void 0:o.attrs,g=It(c,l,m);g&&(p=g.from,f=g.to),r.removeMark(p,f,l)}else d.forEach(p=>{r.removeMark(p.$from.pos,p.$to.pos,l)});return r.removeStoredMark(l),!0},hs=(t,e={})=>({tr:r,state:n,dispatch:s})=>{let o=null,i=null;const a=dt(typeof t=="string"?t:t.name,n.schema);return a?(a==="node"&&(o=E(t,n.schema)),a==="mark"&&(i=N(t,n.schema)),s&&r.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,p,f,m;r.selection.empty?n.doc.nodesBetween(c,u,(g,v)=>{o&&o===g.type&&(f=Math.max(v,c),m=Math.min(v+g.nodeSize,u),d=v,p=g)}):n.doc.nodesBetween(c,u,(g,v)=>{v<c&&o&&o===g.type&&(f=Math.max(v,c),m=Math.min(v+g.nodeSize,u),d=v,p=g),v>=c&&v<=u&&(o&&o===g.type&&r.setNodeMarkup(v,void 0,{...g.attrs,...e}),i&&g.marks.length&&g.marks.forEach(h=>{if(i===h.type){const b=Math.max(v,c),k=Math.min(v+g.nodeSize,u);r.addMark(b,k,i.create({...h.attrs,...e}))}}))}),p&&(d!==void 0&&r.setNodeMarkup(d,void 0,{...p.attrs,...e}),i&&p.marks.length&&p.marks.forEach(g=>{i===g.type&&r.addMark(f,m,i.create({...g.attrs,...e}))}))}),!0):!1},ms=(t,e={})=>({state:r,dispatch:n})=>{const s=E(t,r.schema);return Mr(s,e)(r,n)},gs=(t,e={})=>({state:r,dispatch:n})=>{const s=E(t,r.schema);return wr(s,e)(r,n)},we=x.create({name:"commands",addCommands(){return{...ke}}}),Se=x.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var r,n,s;const o=()=>{var i,a,l,c;if((c=(l=(a=(i=this.editor.options.coreExtensionOptions)==null?void 0:i.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=re(t.before,[t,...e]);de(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(m,g)=>{const v=g+m.nodeSize-2,h=f.oldRange.from<=g&&v<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:m,from:g,to:v,newFrom:u.mapping.map(g),newTo:u.mapping.map(v),deletedRange:f.oldRange,newRange:f.newRange,partial:!h,editor:this.editor,transaction:t,combinedTransform:u})})});const p=u.mapping;u.steps.forEach((f,m)=>{var g,v;if(f instanceof Ye){const h=p.slice(m).map(f.from,-1),b=p.slice(m).map(f.to),k=p.invert().map(h,-1),T=p.invert().map(b),w=(g=u.doc.nodeAt(h-1))==null?void 0:g.marks.some(P=>P.eq(f.mark)),A=(v=u.doc.nodeAt(b))==null?void 0:v.marks.some(P=>P.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:k,to:T},newRange:{from:h,to:b},partial:!!(A||w),editor:this.editor,transaction:t,combinedTransform:u})}})};(s=(n=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:n.async)==null||s?setTimeout(o,0):o()}}),Ee=x.create({name:"drop",addProseMirrorPlugins(){return[new C({key:new L("tiptapDrop"),props:{handleDrop:(t,e,r,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:r,moved:n})}}})]}}),xe=x.create({name:"editable",addProseMirrorPlugins(){return[new C({key:new L("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Te=new L("focusEvents"),Ce=x.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new C({key:Te,props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,r)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),Ae=x.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:p,parent:f}=d,m=d.parent.isTextblock&&p>0?a.doc.resolve(p-1):d,g=m.parent.type.spec.isolating,v=d.pos-d.parentOffset,h=g&&m.parent.childCount===1?v===d.pos:z.atStart(c).from===p;return!u||!f.type.isTextblock||f.textContent.length||!h||h&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...n},o={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ot()||Me()?o:s},addProseMirrorPlugins(){return[new C({key:new L("clearDocument"),appendTransaction:(t,e,r)=>{if(t.some(g=>g.getMeta("composition")))return;const n=t.some(g=>g.docChanged)&&!e.doc.eq(r.doc),s=t.some(g=>g.getMeta("preventClearDocument"));if(!n||s)return;const{empty:o,from:i,to:a}=e.selection,l=z.atStart(e.doc).from,c=z.atEnd(e.doc).to;if(o||!(i===l&&a===c)||!pt(r.doc))return;const p=r.tr,f=lt({state:r,transaction:p}),{commands:m}=new ct({editor:this.editor,state:f});if(m.clearNodes(),!!p.steps.length)return p}})]}}),Le=x.create({name:"paste",addProseMirrorPlugins(){return[new C({key:new L("tiptapPaste"),props:{handlePaste:(t,e,r)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:r})}}})]}}),Pe=x.create({name:"tabindex",addProseMirrorPlugins(){return[new C({key:new L("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),vs=class U{constructor(e,r,n=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=r,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let r=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}r=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:r,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),r=this.resolvedPos.doc.resolve(e);return new U(r,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new U(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new U(e,this.editor)}get children(){const e=[];return this.node.content.forEach((r,n)=>{const s=r.isBlock&&!r.isTextblock,o=r.isAtom&&!r.isText,i=this.pos+n+(o?0:1);if(i<0||i>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(i);if(!s&&a.depth<=this.depth)return;const l=new U(a,this.editor,s,s?r:null);s&&(l.actualDepth=this.depth+1),e.push(new U(a,this.editor,s,s?r:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,r={}){let n=null,s=this.parent;for(;s&&!n;){if(s.node.type.name===e)if(Object.keys(r).length>0){const o=s.node.attrs,i=Object.keys(r);for(let a=0;a<i.length;a+=1){const l=i[a];if(o[l]!==r[l])break}}else n=s;s=s.parent}return n}querySelector(e,r={}){return this.querySelectorAll(e,r,!0)[0]||null}querySelectorAll(e,r={},n=!1){let s=[];if(!this.children||this.children.length===0)return s;const o=Object.keys(r);return this.children.forEach(i=>{n&&s.length>0||(i.node.type.name===e&&o.every(l=>r[l]===i.node.attrs[l])&&s.push(i),!(n&&s.length>0)&&(s=s.concat(i.querySelectorAll(e,r,n))))}),s}setAttribute(e){const{tr:r}=this.editor.state;r.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(r)}},ys=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function bs(t,e,r){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}var ks=class extends Or{constructor(t={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:s,moved:o})=>this.options.onDrop(n,s,o)),this.on("paste",({event:n,slice:s})=>this.options.onPaste(n,s)),this.on("delete",this.options.onDelete);const e=this.createDoc(),r=me(e,this.options.autofocus);this.editorState=Ue.create({doc:e,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){var t;if(this.editorView){const e=this.editorView.dom;e?.editor&&delete e.editor,this.editorView.destroy()}this.editorView=null,this.isInitialized=!1,(t=this.css)==null||t.remove(),this.css=null}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=bs(ys,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.editorState=this.state.apply(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const r=se(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let r=e;if([].concat(t).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(i=>!i.key.startsWith(o))}),e.length===r.length)return;const n=this.state.reconfigure({plugins:r});return this.view.updateState(n),n}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[xe,be.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),we,Ce,Ae,Pe,Ee,Le,Se].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new ht(n,this)}createCommandManager(){this.commandManager=new ct({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=bt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),t=bt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){var e;this.editorView=new Ke(t,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews(),this.prependClass(),this.injectCSS();const n=this.view.dom;n.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}const{state:e,transactions:r}=this.state.applyTransaction(t),n=!this.state.selection.eq(e.selection),s=r.includes(t),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!s)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:r.slice(1)}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const i=r.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=i?.getMeta("focus"),l=i?.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:i}),l&&this.emit("blur",{editor:this,event:l.event,transaction:i}),!(t.getMeta("preventUpdate")||!r.some(c=>c.docChanged)||o.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:r.slice(1)})}getAttributes(t){return ue(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,n=typeof t=="string"?e:t;return Jr(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return At(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return Fr(this.state.doc,{blockSeparator:e,textSerializers:{...le(this.schema),...r}})}get isEmpty(){return pt(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelector(t,e))||null}$nodes(t,e){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new vs(e,this)}get $doc(){return this.$pos(0)}};function K(t){return new ft({find:t.find,handler:({state:e,range:r,match:n})=>{const s=M(t.getAttributes,void 0,n);if(s===!1||s===null)return null;const{tr:o}=e,i=n[n.length-1],a=n[0];if(i){const l=a.search(/\S/),c=r.from+a.indexOf(i),u=c+i.length;if(Rt(r.from,r.to,e.doc).filter(f=>f.mark.type.excluded.find(g=>g===t.type&&g!==f.mark.type)).filter(f=>f.to>c).length)return null;u<r.to&&o.delete(u,r.to),c>r.from&&o.delete(r.from+l,c);const p=r.from+l+i.length;o.addMark(r.from+l,p,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function Ms(t){return new ft({find:t.find,handler:({state:e,range:r,match:n})=>{const s=M(t.getAttributes,void 0,n)||{},{tr:o}=e,i=r.from;let a=r.to;const l=t.type.create(s);if(n[1]){const c=n[0].lastIndexOf(n[1]);let u=i+c;u>a?u=a:a=u+n[1].length;const d=n[0][n[0].length-1];o.insertText(d,i+n[0].length-1),o.replaceWith(u,a,l)}else if(n[0]){const c=t.type.isInline?i:i-1;o.insert(c,t.type.create(s)).delete(o.mapping.map(i),o.mapping.map(a))}o.scrollIntoView()}})}function Mt(t){return new ft({find:t.find,handler:({state:e,range:r,match:n})=>{const s=e.doc.resolve(r.from),o=M(t.getAttributes,void 0,n)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,o)}})}function q(t){return new ft({find:t.find,handler:({state:e,range:r,match:n,chain:s})=>{const o=M(t.getAttributes,void 0,n)||{},i=e.tr.delete(r.from,r.to),l=i.doc.resolve(r.from).blockRange(),c=l&&qe(l,t.type,o);if(!c)return null;if(i.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:p}=e,{splittableMarks:f}=t.editor.extensionManager,m=p||d.$to.parentOffset&&d.$from.marks();if(m){const g=m.filter(v=>f.includes(v.type.name));i.ensureMarks(g)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(d,o).run()}const u=i.doc.resolve(r.from-1).nodeBefore;u&&u.type===t.type&&xt(i.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(n,u))&&i.join(r.from-1)}})}function ws(t,e){const{selection:r}=t,{$from:n}=r;if(r instanceof X){const o=n.index();return n.parent.canReplaceWith(o,o+1,e)}let s=n.depth;for(;s>=0;){const o=n.index(s);if(n.node(s).contentMatchAt(o).matchType(e))return!0;s-=1}return!1}function Ss(t,e,r={}){const{state:n}=e,{doc:s,tr:o}=n,i=t;s.descendants((a,l)=>{const c=o.mapping.map(l),u=o.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(f=>{if(f!==i)return!1;d=f}),!d)return;let p=!1;if(Object.keys(r).forEach(f=>{r[f]!==d.attrs[f]&&(p=!0)}),p){const f=t.type.create({...t.attrs,...r});o.removeMark(c,u,t.type),o.addMark(c,u,f)}}),o.docChanged&&e.view.dispatch(o)}var R=class Ie extends $t{constructor(){super(...arguments),this.type="node"}static create(e={}){const r=typeof e=="function"?e():e;return new Ie(r)}configure(e){return super.configure(e)}extend(e){const r=typeof e=="function"?e():e;return super.extend(r)}};function V(t){return new rn({find:t.find,handler:({state:e,range:r,match:n,pasteEvent:s})=>{const o=M(t.getAttributes,void 0,n,s);if(o===!1||o===null)return null;const{tr:i}=e,a=n[n.length-1],l=n[0];let c=r.to;if(a){const u=l.search(/\S/),d=r.from+l.indexOf(a),p=d+a.length;if(Rt(r.from,r.to,e.doc).filter(m=>m.mark.type.excluded.find(v=>v===t.type&&v!==m.mark.type)).filter(m=>m.to>d).length)return null;p<r.to&&i.delete(p,r.to),d>r.from&&i.delete(r.from+u,d),c=r.from+u+a.length,i.addMark(r.from+u,c,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}var Es=(...t)=>e=>{t.forEach(r=>{typeof r=="function"?r(e):r&&(r.current=e)})},xs=({contentComponent:t})=>{const e=Zt.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return H.jsx(H.Fragment,{children:Object.values(e)})};function Ts(){const t=new Set;let e={};return{subscribe(r){return t.add(r),()=>{t.delete(r)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(r,n){e={...e,[r]:We.createPortal(n.reactElement,n.element,r)},t.forEach(s=>s())},removeRenderer(r){const n={...e};delete n[r],e=n,t.forEach(s=>s())}}}var Cs=class extends F.Component{constructor(t){var e;super(t),this.editorContentRef=F.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const t=this.props.editor;if(t&&!t.isDestroyed&&t.options.element){if(t.contentComponent)return;const e=this.editorContentRef.current;e.append(...t.options.element.childNodes),t.setOptions({element:e}),t.contentComponent=Ts(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=t.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),t.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!((t=e.options.element)!=null&&t.firstChild)))return;const r=document.createElement("div");r.append(...e.options.element.childNodes),e.setOptions({element:r})}render(){const{editor:t,innerRef:e,...r}=this.props;return H.jsxs(H.Fragment,{children:[H.jsx("div",{ref:Es(e,this.editorContentRef),...r}),t?.contentComponent&&H.jsx(xs,{contentComponent:t.contentComponent})]})}},As=$.forwardRef((t,e)=>{const r=F.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return F.createElement(Cs,{key:r,innerRef:e,...t})}),_o=F.memo(As),Ls=typeof window<"u"?$.useLayoutEffect:$.useEffect,Ps=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(n=>n())},r=this.editor;return r.on("transaction",e),()=>{r.off("transaction",e)}}}};function Is(t){var e;const[r]=$.useState(()=>new Ps(t.editor)),n=xr.useSyncExternalStoreWithSelector(r.subscribe,r.getSnapshot,r.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:Ve);return Ls(()=>r.watch(t.editor),[t.editor,r]),$.useDebugValue(n),n}var Rs=!1,wt=typeof window>"u",$s=wt||!!(typeof window<"u"&&window.next),Os=class Re{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(r=>r())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?wt||$s?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...n)=>{var s,o;return(o=(s=this.options.current).onBeforeCreate)==null?void 0:o.call(s,...n)},onBlur:(...n)=>{var s,o;return(o=(s=this.options.current).onBlur)==null?void 0:o.call(s,...n)},onCreate:(...n)=>{var s,o;return(o=(s=this.options.current).onCreate)==null?void 0:o.call(s,...n)},onDestroy:(...n)=>{var s,o;return(o=(s=this.options.current).onDestroy)==null?void 0:o.call(s,...n)},onFocus:(...n)=>{var s,o;return(o=(s=this.options.current).onFocus)==null?void 0:o.call(s,...n)},onSelectionUpdate:(...n)=>{var s,o;return(o=(s=this.options.current).onSelectionUpdate)==null?void 0:o.call(s,...n)},onTransaction:(...n)=>{var s,o;return(o=(s=this.options.current).onTransaction)==null?void 0:o.call(s,...n)},onUpdate:(...n)=>{var s,o;return(o=(s=this.options.current).onUpdate)==null?void 0:o.call(s,...n)},onContentError:(...n)=>{var s,o;return(o=(s=this.options.current).onContentError)==null?void 0:o.call(s,...n)},onDrop:(...n)=>{var s,o;return(o=(s=this.options.current).onDrop)==null?void 0:o.call(s,...n)},onPaste:(...n)=>{var s,o;return(o=(s=this.options.current).onPaste)==null?void 0:o.call(s,...n)},onDelete:(...n)=>{var s,o;return(o=(s=this.options.current).onDelete)==null?void 0:o.call(s,...n)}};return new ks(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,r){return Object.keys(e).every(n=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)?!0:n==="extensions"&&e.extensions&&r.extensions?e.extensions.length!==r.extensions.length?!1:e.extensions.every((s,o)=>{var i;return s===((i=r.extensions)==null?void 0:i[o])}):e[n]===r[n])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?Re.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((n,s)=>n===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,r=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){r&&r.setOptions(this.options.current);return}r&&!r.isDestroyed&&(r.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Do(t={},e=[]){const r=$.useRef(t);r.current=t;const[n]=$.useState(()=>new Os(r)),s=Zt.useSyncExternalStore(n.subscribe,n.getEditor,n.getServerSnapshot);return $.useDebugValue(s),$.useEffect(n.onRender(e)),Is({editor:s,selector:({transactionNumber:o})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&o===0?0:o+1}),s}var Ns=$.createContext({editor:null});Ns.Consumer;var Bs=$.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),_s=()=>$.useContext(Bs);F.forwardRef((t,e)=>{const{onDragStart:r}=_s(),n=t.as||"div";return H.jsx(n,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:r,style:{whiteSpace:"normal",...t.style}})});F.createContext({markViewContentRef:()=>{}});var at=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:r,...n}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,n,r]},Ds=/^\s*>\s$/,Hs=R.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return at("blockquote",{...S(this.options.HTMLAttributes,t),children:at("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[q({find:Ds,type:this.type})]}}),js=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,zs=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Fs=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Vs=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Ws=W.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return at("strong",{...S(this.options.HTMLAttributes,t),children:at("slot",{})})},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[K({find:js,type:this.type}),K({find:Fs,type:this.type})]},addPasteRules(){return[V({find:zs,type:this.type}),V({find:Vs,type:this.type})]}}),Us=/(^|[^`])`([^`]+)`(?!`)/,Ks=/(^|[^`])`([^`]+)`(?!`)/g,qs=W.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[K({find:Us,type:this.type})]},addPasteRules(){return[V({find:Ks,type:this.type})]}}),Js=/^```([a-z]+)?[\s\n]$/,Gs=/^~~~([a-z]+)?[\s\n]$/,Xs=R.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options,o=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(i=>i.startsWith(r)).map(i=>i.replace(r,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",S(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:r}=e,{$from:n,empty:s}=r;if(!s||n.parent.type!==this.type)return!1;const o=n.parentOffset===n.parent.nodeSize-2,i=n.parent.textContent.endsWith(`

`);return!o||!i?!1:t.chain().command(({tr:a})=>(a.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:r,doc:n}=e,{$from:s,empty:o}=r;if(!o||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:n.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(z.near(n.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[Mt({find:Js,type:this.type,getAttributes:t=>({language:t[1]})}),Mt({find:Gs,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new C({key:new L("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),s=n?JSON.parse(n):void 0,o=s?.mode;if(!r||!o)return!1;const{tr:i,schema:a}=t.state,l=a.text(r.replace(/\r\n?/g,`
`));return i.replaceSelectionWith(this.type.create({language:o},l)),i.selection.$from.parent.type!==this.type&&i.setSelection(I.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.setMeta("paste",!0),t.dispatch(i),!0}}})]}}),Ys=R.create({name:"doc",topNode:!0,content:"block+"}),Qs=R.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",S(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:o}=r;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=n.extensionManager,l=o||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&i){const d=l.filter(p=>a.includes(p.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Zs=R.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,S(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Mt({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),to=R.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",S(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!ws(e,e.schema.nodes[this.name]))return!1;const{selection:r}=e,{$to:n}=r,s=t();return fe(r)?s.insertContentAt(n.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:i})=>{var a;if(i){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(I.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(X.create(o.doc,l.pos)):o.setSelection(I.create(o.doc,l.pos));else{const u=(a=l.parent.type.contentMatch.defaultType)==null?void 0:a.create();u&&(o.insert(c,u),o.setSelection(I.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Ms({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),eo=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,ro=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,no=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,so=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,oo=W.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[K({find:eo,type:this.type}),K({find:no,type:this.type})]},addPasteRules(){return[V({find:ro,type:this.type}),V({find:so,type:this.type})]}}),Nt="[\0-   ᠎ -\u2029 　]",io=new RegExp(Nt),ao=new RegExp(`${Nt}$`),lo=new RegExp(Nt,"g");function co(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function uo(t){return new C({key:new L("autolink"),appendTransaction:(e,r,n)=>{const s=e.some(c=>c.docChanged)&&!r.doc.eq(n.doc),o=e.some(c=>c.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=n,a=re(r.doc,[...e]);if(de(a).forEach(({newRange:c})=>{const u=Br(n.doc,c,f=>f.isTextblock);let d,p;if(u.length>1)d=u[0],p=n.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=n.doc.textBetween(c.from,c.to," "," ");if(!ao.test(f))return;d=u[0],p=n.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&p){const f=p.split(io).filter(Boolean);if(f.length<=0)return!1;const m=f[f.length-1],g=d.pos+p.lastIndexOf(m);if(!m)return!1;const v=Tr(m).map(h=>h.toObject(t.defaultProtocol));if(!co(v))return!1;v.filter(h=>h.isLink).map(h=>({...h,from:g+h.start+1,to:g+h.end+1})).filter(h=>n.schema.marks.code?!n.doc.rangeHasMark(h.from,h.to,n.schema.marks.code):!0).filter(h=>t.validate(h.value)).filter(h=>t.shouldAutoLink(h.value)).forEach(h=>{Rt(h.from,h.to,n.doc).some(b=>b.mark.type===t.type)||i.addMark(h.from,h.to,t.type.create({href:h.href}))})}}),!!i.steps.length)return i}})}function po(t){return new C({key:new L("handleClickLink"),props:{handleClick:(e,r,n)=>{var s,o;if(n.button!==0||!e.editable)return!1;let i=null;if(n.target instanceof HTMLAnchorElement)i=n.target;else{let u=n.target;const d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;i=d.find(p=>p.nodeName==="A")}if(!i)return!1;const a=ue(e.state,t.type.name),l=(s=i?.href)!=null?s:a.href,c=(o=i?.target)!=null?o:a.target;return t.enableClickSelection&&t.editor.commands.extendMarkRange(t.type.name),i&&l?(window.open(l,c),!0):!1}}})}function fo(t){return new C({key:new L("handlePasteLink"),props:{handlePaste:(e,r,n)=>{const{state:s}=e,{selection:o}=s,{empty:i}=o;if(i)return!1;let a="";n.content.forEach(c=>{a+=c.textContent});const l=te(a,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:t.editor.commands.setMark(t.type,{href:l.href})}}})}function D(t,e){const r=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const s=typeof n=="string"?n:n.scheme;s&&r.push(s)}),!t||t.replace(lo,"").match(new RegExp(`^(?:(?:${r.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var ho=W.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){Dt(t);return}Dt(t.scheme,t.optionalSlashes)})},onDestroy(){Cr()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!D(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:r=>!!D(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!D(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",S(this.options.HTMLAttributes,t),0]:["a",S(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:r}=t;return this.options.isAllowedUri(r,{defaultValidate:n=>!!D(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:r}=t||{};return r&&!this.options.isAllowedUri(r,{defaultValidate:n=>!!D(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[V({find:t=>{const e=[];if(t){const{protocols:r,defaultProtocol:n}=this.options,s=te(t).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!D(i,r),protocols:r,defaultProtocol:n}));s.length&&s.forEach(o=>e.push({text:o.value,data:{href:o.href},index:o.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:r}=this.options;return this.options.autolink&&t.push(uo({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:s=>!!D(s,e),protocols:e,defaultProtocol:r}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(po({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(fo({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),mo=Object.defineProperty,go=(t,e)=>{for(var r in e)mo(t,r,{get:e[r],enumerable:!0})},vo="listItem",Kt="textStyle",qt=/^\s*([-+*])\s$/,$e=R.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",S(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(vo,this.editor.getAttributes(Kt)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=q({find:qt,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=q({find:qt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Kt),editor:this.editor})),[t]}}),Oe=R.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",S(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),yo={};go(yo,{findListItemPos:()=>Y,getNextListDepth:()=>Bt,handleBackspace:()=>St,handleDelete:()=>Et,hasListBefore:()=>Ne,hasListItemAfter:()=>bo,hasListItemBefore:()=>Be,listItemHasSubList:()=>_e,nextListIsDeeper:()=>De,nextListIsHigher:()=>He});var Y=(t,e)=>{const{$from:r}=e.selection,n=E(t,e.schema);let s=null,o=r.depth,i=r.pos,a=null;for(;o>0&&a===null;)s=r.node(o),s.type===n?a=o:(o-=1,i-=1);return a===null?null:{$pos:e.doc.resolve(i),depth:a}},Bt=(t,e)=>{const r=Y(t,e);if(!r)return!1;const[,n]=Kr(e,t,r.$pos.pos+4);return n},Ne=(t,e,r)=>{const{$anchor:n}=t.selection,s=Math.max(0,n.pos-2),o=t.doc.resolve(s).node();return!(!o||!r.includes(o.type.name))},Be=(t,e)=>{var r;const{$anchor:n}=e.selection,s=e.doc.resolve(n.pos-2);return!(s.index()===0||((r=s.nodeBefore)==null?void 0:r.type.name)!==t)},_e=(t,e,r)=>{if(!r)return!1;const n=E(t,e.schema);let s=!1;return r.descendants(o=>{o.type===n&&(s=!0)}),s},St=(t,e,r)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!_(t.state,e)&&Ne(t.state,e,r)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((p,f)=>{p.type.name===e&&c.push({node:p,pos:f})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!_(t.state,e)||!Xr(t.state))return!1;const n=Y(e,t.state);if(!n)return!1;const o=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),i=_e(e,t.state,o);return Be(e,t.state)&&!i?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},De=(t,e)=>{const r=Bt(t,e),n=Y(t,e);return!n||!r?!1:r>n.depth},He=(t,e)=>{const r=Bt(t,e),n=Y(t,e);return!n||!r?!1:r<n.depth},Et=(t,e)=>{if(!_(t.state,e)||!Gr(t.state,e))return!1;const{selection:r}=t.state,{$from:n,$to:s}=r;return!r.empty&&n.sameParent(s)?!1:De(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():He(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},bo=(t,e)=>{var r;const{$anchor:n}=e.selection,s=e.doc.resolve(n.pos-n.parentOffset-2);return!(s.index()===s.parent.childCount-1||((r=s.nodeAfter)==null?void 0:r.type.name)!==t)},je=x.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Et(t,r)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r})=>{t.state.schema.nodes[r]!==void 0&&Et(t,r)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&St(t,r,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:r,wrapperNames:n})=>{t.state.schema.nodes[r]!==void 0&&St(t,r,n)&&(e=!0)}),e}}}}),ko="listItem",Jt="textStyle",Gt=/^(\d+)\.\s$/,ze=R.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...r}=t;return e===1?["ol",S(this.options.HTMLAttributes,r),0]:["ol",S(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ko,this.editor.getAttributes(Jt)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=q({find:Gt,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=q({find:Gt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Jt)}),joinPredicate:(e,r)=>r.childCount+r.attrs.start===+e[1],editor:this.editor})),[t]}}),Mo=/^\s*(\[([( |x])?\])\s$/,wo=R.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",S(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:n})=>{const s=document.createElement("li"),o=document.createElement("label"),i=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,p;a.ariaLabel=((p=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:p.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(t),o.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;n.isEditable&&typeof r=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:p})=>{const f=r();if(typeof f!="number")return!1;const m=p.doc.nodeAt(f);return p.setNodeMarkup(f,void 0,{...m?.attrs,checked:d}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,o.append(a,i),s.append(o,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[q({find:Mo,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),So=R.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",S(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});x.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push($e.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(Oe.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(je.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(ze.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(wo.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(So.configure(this.options.taskList)),t}});var Eo=R.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),xo=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,To=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Co=W.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[K({find:xo,type:this.type})]},addPasteRules(){return[V({find:To,type:this.type})]}}),Ao=R.create({name:"text",group:"inline"}),Lo=W.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});x.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,r=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(r)}},addProseMirrorPlugins(){let t=!1;return[new C({key:new L("characterCount"),appendTransaction:(e,r,n)=>{if(t)return;const s=this.options.limit;if(s==null||s===0){t=!0;return}const o=this.storage.characters({node:n.doc});if(o>s){const i=o-s,a=0,l=i;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const c=n.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,r)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const s=this.storage.characters({node:r.doc}),o=this.storage.characters({node:e.doc});if(o<=n||s>n&&o>n&&o<=s)return!0;if(s>n&&o>n&&o>s||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=o-n,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>n)}})]}});var Po=x.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Ar(this.options)]}});x.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new C({key:new L("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:r,isFocused:n}=this.editor,{anchor:s}=e,o=[];if(!r||!n)return st.create(t,[]);let i=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(s>=c&&s<=c+l.nodeSize-1))return!1;i+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(s>=c&&s<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&i-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";o.push(Tt.node(c,c+l.nodeSize,{class:this.options.className}))}),st.create(t,o)}}})]}});var Io=x.create({name:"gapCursor",addProseMirrorPlugins(){return[Lr()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=M(y(t,"allowGapCursor",r)))!=null?e:null}}});x.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new C({key:new L("placeholder"),props:{decorations:({doc:t,selection:e})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,s=[];if(!r)return null;const o=this.editor.isEmpty;return t.descendants((i,a)=>{const l=n>=a&&n<=a+i.nodeSize,c=!i.isLeaf&&pt(i);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];o&&u.push(this.options.emptyEditorClass);const d=Tt.node(a,a+i.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:i,pos:a,hasAnchor:l}):this.options.placeholder});s.push(d)}return this.options.includeChildren}),st.create(t,s)}}})]}});x.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new C({key:new L("selection"),props:{decorations(r){return r.selection.empty||t.isFocused||!t.isEditable||fe(r.selection)||t.view.dragging?null:st.create(r.doc,[Tt.inline(r.selection.from,r.selection.to,{class:e.className})])}}})]}});function Xt({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var Ro=x.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const t=new L(this.name),e=Object.entries(this.editor.schema.nodes).map(([,r])=>r).filter(r=>(this.options.notAfter||[]).concat(this.options.node).includes(r.name));return[new C({key:t,appendTransaction:(r,n,s)=>{const{doc:o,tr:i,schema:a}=s,l=t.getState(s),c=o.content.size,u=a.nodes[this.options.node];if(l)return i.insert(c,u.create())},state:{init:(r,n)=>{const s=n.tr.doc.lastChild;return!Xt({node:s,types:e})},apply:(r,n)=>{if(!r.docChanged)return n;const s=r.doc.lastChild;return!Xt({node:s,types:e})}}})]}}),$o=x.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Rr(t,e),redo:()=>({state:t,dispatch:e})=>Ir(t,e)}},addProseMirrorPlugins(){return[Pr(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Oo=x.create({name:"starterKit",addExtensions(){var t,e,r,n;const s=[];return this.options.bold!==!1&&s.push(Ws.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(Hs.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push($e.configure(this.options.bulletList)),this.options.code!==!1&&s.push(qs.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(Xs.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(Ys.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(Po.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(Io.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(Qs.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(Zs.configure(this.options.heading)),this.options.undoRedo!==!1&&s.push($o.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&s.push(to.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push(oo.configure(this.options.italic)),this.options.listItem!==!1&&s.push(Oe.configure(this.options.listItem)),this.options.listKeymap!==!1&&s.push(je.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&s.push(ho.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&s.push(ze.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(Eo.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(Co.configure(this.options.strike)),this.options.text!==!1&&s.push(Ao.configure(this.options.text)),this.options.underline!==!1&&s.push(Lo.configure((r=this.options)==null?void 0:r.underline)),this.options.trailingNode!==!1&&s.push(Ro.configure((n=this.options)==null?void 0:n.trailingNode)),s}}),Ho=Oo;export{_o as E,Zs as H,Ho as i,Do as u};
