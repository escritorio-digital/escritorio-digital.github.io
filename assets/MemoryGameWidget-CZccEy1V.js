import{u as x,r as p,j as e,ah as f,R as _,h as v}from"./index-gUP0q4Oy.js";import{an as k}from"./index-gUP0q4Oy.js";import{r as C}from"./openDialog-H-OCpcqq.js";const F=()=>{const{t:l}=x(),[o,m]=p.useState([]),[d,c]=p.useState([]),[h,g]=p.useState(0),u=s=>{const i=[];Array.from(s).forEach(n=>{n.type.startsWith("image/")&&i.push(new Promise(t=>{const a=new FileReader;a.onload=r=>t(r.target?.result),a.readAsDataURL(n)}))}),Promise.all(i).then(n=>{const t=[];n.forEach((a,r)=>{t.push({id:r*2,pairId:r,content:a,isFlipped:!1,isMatched:!1}),t.push({id:r*2+1,pairId:r,content:a,isFlipped:!1,isMatched:!1})});for(let a=t.length-1;a>0;a-=1){const r=Math.floor(Math.random()*(a+1));[t[a],t[r]]=[t[r],t[a]]}m(t),g(0),c([])})},y=async()=>{const s=await C({accept:"image/*",multiple:!0});if(!s)return;if(s.source==="local"){s.files.length>1?u(s.files):alert(l("widgets.memory_game.min_images_alert"));return}const i=[];for(const n of s.entryIds){const t=await v(n);t?.blob&&(t.mime&&!t.mime.startsWith("image/")||i.push(new File([t.blob],t.name,{type:t.mime||t.blob.type})))}i.length>1?u(i):alert(l("widgets.memory_game.min_images_alert"))},j=s=>{if(o[s].isFlipped||d.length===2)return;const i=[...d,s];c(i);const n=[...o];n[s].isFlipped=!0,m(n)};p.useEffect(()=>{if(d.length===2){g(h+1);const[s,i]=d,n=o[s],t=o[i];if(n.pairId===t.pairId){const a=o.map(r=>r.pairId===n.pairId?{...r,isMatched:!0}:r);m(a),c([])}else setTimeout(()=>{const a=[...o];a[s].isFlipped=!1,a[i].isFlipped=!1,m(a),c([])},1e3)}},[d]);const w=o.length>0&&o.every(s=>s.isMatched);return o.length===0?e.jsx("div",{className:"memory-game-widget memory-empty",children:e.jsxs("div",{className:"memory-placeholder",children:[e.jsx("div",{className:"memory-placeholder-icon",children:e.jsx(f,{size:56})}),e.jsx("h3",{children:l("widgets.memory_game.upload_prompt")}),e.jsx("p",{children:l("widgets.memory_game.upload_rule")}),e.jsxs("button",{className:"memory-upload-button",onClick:y,children:[e.jsx(f,{size:18}),l("widgets.memory_game.upload_button")]})]})}):e.jsxs("div",{className:"memory-game-widget",children:[e.jsx("div",{className:"game-board",style:{gridTemplateColumns:`repeat(${Math.ceil(Math.sqrt(o.length))}, 1fr)`},children:o.map((s,i)=>e.jsx("div",{className:`card ${s.isFlipped||s.isMatched?"flipped":""}`,onClick:()=>j(i),children:e.jsxs("div",{className:"card-inner",children:[e.jsx("div",{className:"card-front",children:"?"}),e.jsx("div",{className:"card-back",children:e.jsx("img",{src:s.content,alt:`par ${s.pairId}`})})]})},i))}),e.jsxs("div",{className:"game-footer",children:[e.jsx("span",{children:l("widgets.memory_game.moves",{count:h})}),e.jsxs("button",{onClick:()=>m([]),children:[e.jsx(_,{size:16})," ",l("widgets.memory_game.start_over")]})]}),w&&e.jsxs("div",{className:"game-won-overlay",children:[e.jsx("h2",{children:l("widgets.memory_game.win_title")}),e.jsx("p",{children:l("widgets.memory_game.win_message",{moves:h})}),e.jsx("button",{onClick:()=>m([]),children:l("widgets.memory_game.play_again")})]})]})};export{F as MemoryGameWidget,k as widgetConfig};
