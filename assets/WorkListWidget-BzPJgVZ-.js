import{c as D,u as L,r,a as O,s as q,j as i,F as z,D as J,ao as M,g as E}from"./index-Ctz9AYvo.js";import{aA as Y}from"./index-Ctz9AYvo.js";import{P as N}from"./papaparse.min-CXh5h_A2.js";import{r as P,s as W,d as $}from"./saveDialog-ZVr_KL31.js";import{r as B}from"./openDialog-H-OCpcqq.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],R=D("square-pen",K),X=({instanceId:b})=>{const{t:o,ready:v}=L(),S=r.useRef(b??`work-list-${Date.now()}-${Math.random().toString(16).slice(2)}`),d=b??S.current,[a,c]=O("work-list-tasks",[]),[p,y]=r.useState(""),[u,g]=r.useState(null),[f,k]=r.useState(""),[x,w]=r.useState(""),I=e=>{e.key==="Enter"&&p.trim()!==""&&(c([...a,{id:Date.now(),text:p.trim(),completed:!1}]),y(""))},C=e=>{c(a.map(t=>t.id===e?{...t,completed:!t.completed}:t))},_=e=>{c(a.filter(t=>t.id!==e))},j=e=>{g(e.id),k(e.text)},T=e=>{e.key==="Enter"&&u!==null&&(f.trim()===""?_(u):c(a.map(t=>t.id===u?{...t,text:f.trim()}:t)),g(null),k(""))},h=async()=>{const e=N.unparse(a.map(l=>({id:l.id,text:l.text,completed:l.completed}))),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=await P("lista_de_trabajo.csv");if(!s)return;s?.destination==="file-manager"?await W({blob:t,filename:s.filename,sourceWidgetId:"work-list",sourceWidgetTitleKey:"widgets.work_list.title",parentId:s.parentId}):s?.destination==="download"&&$(t,s.filename);const n=JSON.stringify(a);w(n),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:d,widgetId:"work-list"}}))},m=r.useCallback(e=>{N.parse(e,{header:!0,skipEmptyLines:!0,complete:t=>{const s=t.data.map(n=>({id:Number(n.id)||Date.now()+Math.random(),text:String(n.text||""),completed:String(n.completed).toLowerCase()==="true"})).filter(n=>n.text);window.confirm(o("widgets.work_list.replace_list_confirm"))?(c(s),w(JSON.stringify(s))):c(n=>{const l=[...n,...s];return w(JSON.stringify(l)),l})},error:t=>{console.error("Error al parsear el CSV:",t),alert(o("widgets.work_list.csv_error"))}})},[c,o]),F=async()=>{const e=await B({accept:".csv"});if(!e)return;if(e.source==="local"){const[l]=e.files;l&&m(l);return}const[t]=e.entryIds;if(!t)return;const s=await E(t);if(!s?.blob)return;const n=new File([s.blob],s.name,{type:s.mime||s.blob.type});m(n)};return r.useEffect(()=>q("work-list",async({entryId:t})=>{const s=await E(t);if(!s?.blob)return;const n=new File([s.blob],s.name,{type:s.mime||s.blob.type});m(n)}),[m]),r.useEffect(()=>{if(!x){w(JSON.stringify(a));return}const t=JSON.stringify(a)!==x;window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:d,widgetId:"work-list",isDirty:t}}))},[x,d,a]),r.useEffect(()=>{const e=t=>{const s=t;s.detail?.instanceId===d&&(s.detail?.widgetId&&s.detail.widgetId!=="work-list"||h())};return window.addEventListener("widget-save-request",e),()=>window.removeEventListener("widget-save-request",e)},[h,d]),r.useEffect(()=>()=>{window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:d,widgetId:"work-list",isDirty:!1}}))},[d]),console.log("WorkList translations:",{ready:v,placeholder:o("widgets.work_list.add_task_placeholder"),title:o("widgets.work_list.title")}),v?i.jsxs("div",{className:"work-list-widget",children:[i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("input",{type:"text",className:"work-list-input",placeholder:o("widgets.work_list.add_task_placeholder"),value:p,onChange:e=>y(e.target.value),onKeyPress:I}),i.jsx("button",{onClick:F,className:"work-list-icon-button",title:o("widgets.work_list.load_csv"),children:i.jsx(z,{size:20})}),i.jsx("button",{onClick:h,className:"work-list-icon-button",title:o("widgets.work_list.download_csv"),children:i.jsx(J,{size:20})})]}),i.jsx("ul",{className:"work-list-items",children:a.map(e=>i.jsxs("li",{className:`work-list-item ${e.completed?"opacity-50":""}`,children:[i.jsx("input",{type:"checkbox",className:"work-list-checkbox",checked:e.completed,onChange:()=>C(e.id)}),u===e.id?i.jsx("input",{type:"text",value:f,onChange:t=>k(t.target.value),onKeyPress:T,onBlur:()=>g(null),className:"work-list-edit-input",autoFocus:!0}):i.jsx("span",{className:`flex-grow cursor-pointer ${e.completed?"line-through":""}`,onDoubleClick:()=>j(e),children:e.text}),i.jsx("button",{onClick:()=>j(e),className:"work-list-action",children:i.jsx(R,{size:16})}),i.jsx("button",{onClick:()=>_(e.id),className:"work-list-action delete",children:i.jsx(M,{size:16})})]},e.id))}),i.jsx("p",{className:"work-list-hint",children:o("widgets.work_list.double_click_edit")})]}):i.jsx("div",{className:"flex items-center justify-center h-full",children:o("loading")})};export{X as WorkListWidget,Y as widgetConfig};
