import{c as ae,u as ie,r as x,s as oe,j as f,p as ce,F as le,V as ue,g as M}from"./index-BenRa9M0.js";import{a2 as Et}from"./index-BenRa9M0.js";import{d as fe}from"./marked.esm-IrHqQMcX.js";import{k as _}from"./katex.min-2TduxwG8.js";import{r as de,s as me,d as he}from"./saveDialog-Cj7A06am.js";import{r as ge}from"./openDialog-H-OCpcqq.js";import{S as we}from"./save-BgaoC4sK.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],ye=ae("clipboard",pe);function xe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const r=document.implementation.createHTMLDocument(),n=r.createElement("base"),a=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(a),t&&(n.href=t),a.href=e,a.href}const be=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function S(e){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r]);return t}let E=null;function q(e={}){return E||(e.includeStyleProperties?(E=e.includeStyleProperties,E):(E=S(window.getComputedStyle(document.documentElement)),E))}function k(e,t){const n=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return n?parseFloat(n.replace("px","")):0}function Se(e){const t=k(e,"border-left-width"),r=k(e,"border-right-width");return e.clientWidth+t+r}function Ee(e){const t=k(e,"border-top-width"),r=k(e,"border-bottom-width");return e.clientHeight+t+r}function z(e,t={}){const r=t.width||Se(e),n=t.height||Ee(e);return{width:r,height:n}}function Ce(){let e,t;try{t=process}catch{}const r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const g=16384;function ke(e){(e.width>g||e.height>g)&&(e.width>g&&e.height>g?e.width>e.height?(e.height*=g/e.width,e.width=g):(e.width*=g/e.height,e.height=g):e.width>g?(e.height*=g/e.width,e.width=g):(e.width*=g/e.height,e.height=g))}function R(e){return new Promise((t,r)=>{const n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=r,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function Re(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Te(e,t,r){const n="http://www.w3.org/2000/svg",a=document.createElementNS(n,"svg"),s=document.createElementNS(n,"foreignObject");return a.setAttribute("width",`${t}`),a.setAttribute("height",`${r}`),a.setAttribute("viewBox",`0 0 ${t} ${r}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),a.appendChild(s),s.appendChild(e),Re(a)}const m=(e,t)=>{if(e instanceof t)return!0;const r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||m(r,t)};function $e(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function _e(e,t){return q(t).map(r=>{const n=e.getPropertyValue(r),a=e.getPropertyPriority(r);return`${r}: ${n}${a?" !important":""};`}).join(" ")}function ve(e,t,r,n){const a=`.${e}:${t}`,s=r.cssText?$e(r):_e(r,n);return document.createTextNode(`${a}{${s}}`)}function j(e,t,r,n){const a=window.getComputedStyle(e,r),s=a.getPropertyValue("content");if(s===""||s==="none")return;const i=be();try{t.className=`${t.className} ${i}`}catch{return}const o=document.createElement("style");o.appendChild(ve(i,r,a,n)),t.appendChild(o)}function Fe(e,t,r){j(e,t,":before",r),j(e,t,":after",r)}const A="application/font-woff",H="image/jpeg",Le={woff:A,woff2:A,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:H,jpeg:H,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Pe(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function L(e){const t=Pe(e).toLowerCase();return Le[t]||""}function Ie(e){return e.split(/,/)[1]}function F(e){return e.search(/^(data:)/)!==-1}function Me(e,t){return`data:${t};base64,${e}`}async function B(e,t,r){const n=await fetch(e,t);if(n.status===404)throw new Error(`Resource "${n.url}" not found`);const a=await n.blob();return new Promise((s,i)=>{const o=new FileReader;o.onerror=i,o.onloadend=()=>{try{s(r({res:n,result:o.result}))}catch(l){i(l)}},o.readAsDataURL(a)})}const v={};function je(e,t,r){let n=e.replace(/\?.*/,"");return r&&(n=e),/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),t?`[${t}]${n}`:n}async function P(e,t,r){const n=je(e,t,r.includeQueryParams);if(v[n]!=null)return v[n];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let a;try{const s=await B(e,r.fetchRequestInit,({res:i,result:o})=>(t||(t=i.headers.get("Content-Type")||""),Ie(o)));a=Me(s,t)}catch(s){a=r.imagePlaceholder||"";let i=`Failed to fetch resource: ${e}`;s&&(i=typeof s=="string"?s:s.message),i&&console.warn(i)}return v[n]=a,a}async function Ae(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):R(t)}async function He(e,t){if(e.currentSrc){const s=document.createElement("canvas"),i=s.getContext("2d");s.width=e.clientWidth,s.height=e.clientHeight,i?.drawImage(e,0,0,s.width,s.height);const o=s.toDataURL();return R(o)}const r=e.poster,n=L(r),a=await P(r,n,t);return R(a)}async function De(e,t){var r;try{if(!((r=e?.contentDocument)===null||r===void 0)&&r.body)return await T(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function Oe(e,t){return m(e,HTMLCanvasElement)?Ae(e):m(e,HTMLVideoElement)?He(e,t):m(e,HTMLIFrameElement)?De(e,t):e.cloneNode(G(e))}const Ue=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",G=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function Ve(e,t,r){var n,a;if(G(t))return t;let s=[];return Ue(e)&&e.assignedNodes?s=S(e.assignedNodes()):m(e,HTMLIFrameElement)&&(!((n=e.contentDocument)===null||n===void 0)&&n.body)?s=S(e.contentDocument.body.childNodes):s=S(((a=e.shadowRoot)!==null&&a!==void 0?a:e).childNodes),s.length===0||m(e,HTMLVideoElement)||await s.reduce((i,o)=>i.then(()=>T(o,r)).then(l=>{l&&t.appendChild(l)}),Promise.resolve()),t}function We(e,t,r){const n=t.style;if(!n)return;const a=window.getComputedStyle(e);a.cssText?(n.cssText=a.cssText,n.transformOrigin=a.transformOrigin):q(r).forEach(s=>{let i=a.getPropertyValue(s);s==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),m(e,HTMLIFrameElement)&&s==="display"&&i==="inline"&&(i="block"),s==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(s,i,a.getPropertyPriority(s))})}function qe(e,t){m(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),m(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function ze(e,t){if(m(e,HTMLSelectElement)){const r=t,n=Array.from(r.children).find(a=>e.value===a.getAttribute("value"));n&&n.setAttribute("selected","")}}function Be(e,t,r){return m(t,Element)&&(We(e,t,r),Fe(e,t,r),qe(e,t),ze(e,t)),t}async function Ge(e,t){const r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;const n={};for(let s=0;s<r.length;s++){const o=r[s].getAttribute("xlink:href");if(o){const l=e.querySelector(o),h=document.querySelector(o);!l&&h&&!n[o]&&(n[o]=await T(h,t,!0))}}const a=Object.values(n);if(a.length){const s="http://www.w3.org/1999/xhtml",i=document.createElementNS(s,"svg");i.setAttribute("xmlns",s),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const o=document.createElementNS(s,"defs");i.appendChild(o);for(let l=0;l<a.length;l++)o.appendChild(a[l]);e.appendChild(i)}return e}async function T(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(n=>Oe(n,t)).then(n=>Ve(e,n,t)).then(n=>Be(e,n,t)).then(n=>Ge(n,t))}const X=/url\((['"]?)([^'"]+?)\1\)/g,Xe=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Ke=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Je(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Qe(e){const t=[];return e.replace(X,(r,n,a)=>(t.push(a),r)),t.filter(r=>!F(r))}async function Ye(e,t,r,n,a){try{const s=r?xe(t,r):t,i=L(t);let o;return a||(o=await P(s,i,n)),e.replace(Je(t),`$1${o}$3`)}catch{}return e}function Ze(e,{preferredFontFormat:t}){return t?e.replace(Ke,r=>{for(;;){const[n,,a]=Xe.exec(r)||[];if(!a)return"";if(a===t)return`src: ${n};`}}):e}function K(e){return e.search(X)!==-1}async function J(e,t,r){if(!K(e))return e;const n=Ze(e,r);return Qe(n).reduce((s,i)=>s.then(o=>Ye(o,i,t,r)),Promise.resolve(n))}async function C(e,t,r){var n;const a=(n=t.style)===null||n===void 0?void 0:n.getPropertyValue(e);if(a){const s=await J(a,null,r);return t.style.setProperty(e,s,t.style.getPropertyPriority(e)),!0}return!1}async function Ne(e,t){await C("background",e,t)||await C("background-image",e,t),await C("mask",e,t)||await C("-webkit-mask",e,t)||await C("mask-image",e,t)||await C("-webkit-mask-image",e,t)}async function et(e,t){const r=m(e,HTMLImageElement);if(!(r&&!F(e.src))&&!(m(e,SVGImageElement)&&!F(e.href.baseVal)))return;const n=r?e.src:e.href.baseVal,a=await P(n,L(n),t);await new Promise((s,i)=>{e.onload=s,e.onerror=t.onImageErrorHandler?(...l)=>{try{s(t.onImageErrorHandler(...l))}catch(h){i(h)}}:i;const o=e;o.decode&&(o.decode=s),o.loading==="lazy"&&(o.loading="eager"),r?(e.srcset="",e.src=a):e.href.baseVal=a})}async function tt(e,t){const n=S(e.childNodes).map(a=>Q(a,t));await Promise.all(n).then(()=>e)}async function Q(e,t){m(e,Element)&&(await Ne(e,t),await et(e,t),await tt(e,t))}function nt(e,t){const{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);const n=t.style;return n!=null&&Object.keys(n).forEach(a=>{r[a]=n[a]}),e}const D={};async function O(e){let t=D[e];if(t!=null)return t;const n=await(await fetch(e)).text();return t={url:e,cssText:n},D[e]=t,t}async function U(e,t){let r=e.cssText;const n=/url\(["']?([^"')]+)["']?\)/g,s=(r.match(/url\([^)]+\)/g)||[]).map(async i=>{let o=i.replace(n,"$1");return o.startsWith("https://")||(o=new URL(o,e.url).href),B(o,t.fetchRequestInit,({result:l})=>(r=r.replace(i,`url(${l})`),[i,l]))});return Promise.all(s).then(()=>r)}function V(e){if(e==null)return[];const t=[],r=/(\/\*[\s\S]*?\*\/)/gi;let n=e.replace(r,"");const a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=a.exec(n);if(l===null)break;t.push(l[0])}n=n.replace(a,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",o=new RegExp(i,"gi");for(;;){let l=s.exec(n);if(l===null){if(l=o.exec(n),l===null)break;s.lastIndex=o.lastIndex}else o.lastIndex=s.lastIndex;t.push(l[0])}return t}async function rt(e,t){const r=[],n=[];return e.forEach(a=>{if("cssRules"in a)try{S(a.cssRules||[]).forEach((s,i)=>{if(s.type===CSSRule.IMPORT_RULE){let o=i+1;const l=s.href,h=O(l).then(w=>U(w,t)).then(w=>V(w).forEach(b=>{try{a.insertRule(b,b.startsWith("@import")?o+=1:a.cssRules.length)}catch($){console.error("Error inserting rule from remote css",{rule:b,error:$})}})).catch(w=>{console.error("Error loading remote css",w.toString())});n.push(h)}})}catch(s){const i=e.find(o=>o.href==null)||document.styleSheets[0];a.href!=null&&n.push(O(a.href).then(o=>U(o,t)).then(o=>V(o).forEach(l=>{i.insertRule(l,i.cssRules.length)})).catch(o=>{console.error("Error loading remote stylesheet",o)})),console.error("Error inlining remote css file",s)}}),Promise.all(n).then(()=>(e.forEach(a=>{if("cssRules"in a)try{S(a.cssRules||[]).forEach(s=>{r.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${a.href}`,s)}}),r))}function st(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>K(t.style.getPropertyValue("src")))}async function at(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const r=S(e.ownerDocument.styleSheets),n=await rt(r,t);return st(n)}function Y(e){return e.trim().replace(/["']/g,"")}function it(e){const t=new Set;function r(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(s=>{t.add(Y(s))}),Array.from(n.children).forEach(s=>{s instanceof HTMLElement&&r(s)})}return r(e),t}async function ot(e,t){const r=await at(e,t),n=it(e);return(await Promise.all(r.filter(s=>n.has(Y(s.style.fontFamily))).map(s=>{const i=s.parentStyleSheet?s.parentStyleSheet.href:null;return J(s.cssText,i,t)}))).join(`
`)}async function ct(e,t){const r=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await ot(e,t);if(r){const n=document.createElement("style"),a=document.createTextNode(r);n.appendChild(a),e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)}}async function lt(e,t={}){const{width:r,height:n}=z(e,t),a=await T(e,t,!0);return await ct(a,t),await Q(a,t),nt(a,t),await Te(a,r,n)}async function ut(e,t={}){const{width:r,height:n}=z(e,t),a=await lt(e,t),s=await R(a),i=document.createElement("canvas"),o=i.getContext("2d"),l=t.pixelRatio||Ce(),h=t.canvasWidth||r,w=t.canvasHeight||n;return i.width=h*l,i.height=w*l,t.skipAutoScale||ke(i),i.style.width=`${h}`,i.style.height=`${w}`,t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,i.width,i.height)),o.drawImage(s,0,0,i.width,i.height),i}async function ft(e,t={}){return(await ut(e,t)).toDataURL()}async function dt(){let e="";for(const t of Array.from(document.styleSheets))try{if(t.cssRules)for(const r of Array.from(t.cssRules))e+=r.cssText}catch{}return e}function W(e,t,r){if(e.innerHTML="",t==="markdown"){const n=fe.parse(r);e.innerHTML=n,e.innerHTML=e.innerHTML.replace(/\$\$([^$]+)\$\$/g,(a,s)=>_.renderToString(s.trim(),{throwOnError:!1,displayMode:!0})),e.innerHTML=e.innerHTML.replace(/\$([^$]+)\$/g,(a,s)=>_.renderToString(s.trim(),{throwOnError:!1,displayMode:!1}))}else _.render(r,e,{throwOnError:!0,displayMode:!0})}const xt=()=>{const{t:e,i18n:t,ready:r}=ie(),[n,a]=x.useState(`# Teorema de Pitágoras

En un triángulo rectángulo, el cuadrado de la hipotenusa es igual a la suma de los cuadrados de los catetos.

$$c = \\sqrt{a^2 + b^2}$$`);x.useEffect(()=>{const c=e("widgets.latex_markdown.sample_content");c!=="widgets.latex_markdown.sample_content"&&a(c)},[e,t.language]);const[s,i]=x.useState("markdown"),[o,l]=x.useState(""),h=x.useRef(null),w=x.useRef(null);x.useEffect(()=>{const c=w.current;if(c)return document.body.appendChild(c),()=>{c.parentNode&&c.parentNode.removeChild(c)}},[]);const b=c=>{l(c),setTimeout(()=>l(""),1800)},$=()=>{navigator.clipboard.writeText(n).then(()=>b(e("widgets.latex_markdown.source_copied"))).catch(()=>b(e("widgets.latex_markdown.copy_failed")))},Z=async()=>{const c=h.current;if(!c)return;const d=await dt();try{const u=await ft(c,{backgroundColor:"#ffffff",fontEmbedCSS:d}),y=await(await fetch(u)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":y})]),b(e("widgets.latex_markdown.image_copied"))}catch{b(e("widgets.latex_markdown.copy_image_failed"))}},N=async()=>{const c=s==="latex"?"tex":"md",d=s==="latex"?"text/x-latex":"text/markdown",u=new Blob([n],{type:`${d};charset=utf-8`}),y=`documento.${c}`,p=await de(y);if(p?.destination==="file-manager"){await me({blob:u,filename:p.filename,sourceWidgetId:"latex-markdown",sourceWidgetTitleKey:"widgets.latex_markdown.title",parentId:p.parentId});return}p?.destination==="download"&&he(u,p.filename)},I=async c=>{const d=await c.text(),u=c.name.toLowerCase();i(u.endsWith(".tex")?"latex":"markdown"),a(d)},ee=async()=>{const c=await ge({accept:".md,.tex,.txt"});if(!c)return;if(c.source==="local"){const[p]=c.files;p&&await I(p);return}const[d]=c.entryIds;if(!d)return;const u=await M(d);if(!u?.blob)return;const y=new File([u.blob],u.name,{type:u.mime||u.blob.type});await I(y)},te=async()=>{const c=w.current;if(!c)return;W(c,s,n);try{await document.fonts?.ready}catch{}await new Promise(u=>requestAnimationFrame(()=>u()));const d=()=>{c.innerHTML="",window.removeEventListener("afterprint",d)};window.addEventListener("afterprint",d),window.print()};return x.useEffect(()=>{const c=h.current;if(c)try{W(c,s,n)}catch(d){if(s==="latex"&&d instanceof Error){const u=e("widgets.latex_markdown.latex_mode_title"),y=e("widgets.latex_markdown.latex_mode_description"),p=e("widgets.latex_markdown.how_to_proceed"),ne=e("widgets.latex_markdown.isolated_formula"),re=e("widgets.latex_markdown.text_with_formulas"),se=e("widgets.latex_markdown.markdown");c.innerHTML=`
          <div class="friendly-error-pane">
            <h3>${u}</h3>
            <p>${y}</p>
            <h4>${p}</h4>
            <ul>
              <li>${ne} <code>c = \\\\sqrt{a^2 + b^2}</code>.</li>
              <li>${re} <strong>${se}</strong>.</li>
            </ul>
          </div>
        `}else if(d instanceof Error){const u=e("widgets.latex_markdown.latex_syntax_error");c.innerHTML=`<div class="error-message">${u} ${d.message}</div>`}else{const u=e("widgets.latex_markdown.generic_error");c.innerHTML=`<div class="error-message">${u}</div>`}}},[n,s]),x.useEffect(()=>oe("latex-markdown",async({entryId:d})=>{const u=await M(d);if(!u?.blob)return;const y=await u.blob.text(),p=u.name.toLowerCase();i(p.endsWith(".tex")?"latex":"markdown"),a(y)}),[]),r?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"latex-markdown-widget",children:[f.jsxs("div",{className:"editor-pane",children:[f.jsxs("div",{className:"mode-selector",children:[f.jsx("button",{onClick:()=>i("markdown"),className:s==="markdown"?"active":"",children:"Markdown"}),f.jsx("button",{onClick:()=>i("latex"),className:s==="latex"?"active":"",children:"LaTeX"})]}),f.jsx("textarea",{value:n,onChange:c=>a(c.target.value),spellCheck:"false",className:"editor-textarea"})]}),f.jsxs("div",{className:"preview-container",children:[f.jsxs("div",{className:"preview-toolbar",children:[o&&f.jsx("span",{className:"feedback-message",children:o}),f.jsx("button",{title:e("widgets.latex_markdown.copy_source"),onClick:$,children:f.jsx(ye,{size:18})}),f.jsx("button",{title:e("widgets.latex_markdown.copy_image"),onClick:Z,children:f.jsx(ce,{size:18})}),f.jsx("button",{title:e("widgets.latex_markdown.open_file"),onClick:ee,children:f.jsx(le,{size:18})}),f.jsx("button",{title:e("widgets.latex_markdown.save_file"),onClick:N,children:f.jsx(we,{size:18})}),f.jsx("button",{title:e("widgets.latex_markdown.export_pdf"),onClick:te,children:f.jsx(ue,{size:18})})]}),f.jsx("div",{className:"preview-pane prose",ref:h})]})]}),f.jsx("div",{id:"print-root",ref:w,className:"prose"})]}):f.jsx("div",{className:"flex items-center justify-center h-full",children:e("loading")})};export{xt as LatexMarkdownWidget,Et as widgetConfig};
