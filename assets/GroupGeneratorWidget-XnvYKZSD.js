import{u as pe,r as i,f as me,j as t,W as he,F as we,ab as ee,ac as fe,h as L}from"./index-CmQIKd-y.js";import{ad as ke}from"./index-CmQIKd-y.js";import{S as xe,a as ye,s as te,r as ve,d as be}from"./saveDialog-BxXDziQd.js";import{r as _e}from"./openDialog-H-OCpcqq.js";import{C as je}from"./copy-Cnof6Ucu.js";const Ce=u=>u==="byCount"||u==="bySize",Se=u=>Array.isArray(u)&&u.every(s=>Array.isArray(s)&&s.every(I=>typeof I=="string")),Ie=u=>{try{const s=JSON.parse(u);return!s||typeof s!="object"||s.version!==1||typeof s.studentList!="string"||!Ce(s.mode)||typeof s.groupValue!="number"||!Number.isFinite(s.groupValue)||!Se(s.generatedGroups)?null:{version:1,studentList:s.studentList,generatedGroups:s.generatedGroups,mode:s.mode,groupValue:s.groupValue}}catch{return null}},Ge=({instanceId:u})=>{const{t:s}=pe(),I=i.useRef(u??`group-generator-${Date.now()}-${Math.random().toString(16).slice(2)}`),l=u??I.current,[m,N]=i.useState(`Ana
Beatriz
Carlos
Daniela
Esteban
Fernanda
Gael
Hilda
IvÃ¡n
Julia`),[g,E]=i.useState("byCount"),[c,R]=i.useState(3),[o,y]=i.useState([]),[h,z]=i.useState(!1),[v,w]=i.useState(""),[M,G]=i.useState(null),[ne,F]=i.useState(null),[H,re]=i.useState(null),J=i.useRef(null),P=i.useRef(null),$=i.useRef(null),D=i.useRef({titleSize:0,textSize:0,minCardWidth:0,containerHeight:0}),V=i.useCallback(e=>{N(e.studentList),y(e.generatedGroups),E(e.mode),R(Math.max(1,Math.floor(e.groupValue))),w(JSON.stringify(e))},[]),B=i.useCallback(e=>{const r=Ie(e);if(r){V(r);return}N(e),y([]),w(JSON.stringify({version:1,studentList:e,generatedGroups:[],mode:g,groupValue:c}))},[V,c,g]),b=i.useCallback(async(e,r,n,a)=>{const d=await e.text();B(d);const p=r?.trim();p&&window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:p}})),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),p&&(G(p),F(n??null),re(a??null))},[B,l]);i.useEffect(()=>{if(!h)return;const e=J.current,r=P.current,n=$.current;if(!e||!r||!n)return;let a=0;const d=()=>{if(!e||!r||!n)return;const _=getComputedStyle(e),oe=parseFloat(_.paddingTop)||0,le=parseFloat(_.paddingBottom)||0,de=parseFloat(_.rowGap||_.gap)||0,j=Math.max(120,e.clientHeight-r.offsetHeight-oe-le-de);n.style.height=`${j}px`;const U=n.clientWidth,ue=Math.max(1,o.length),ce=Math.min(ue,Math.max(1,Math.floor(U/320))),C=Math.max(240,Math.floor(U/ce)-16),Q=16,ge=Math.min(40,Math.max(20,Math.floor(j/5)));let X=Q,Y=ge,f=Q;for(let Z=0;Z<12;Z+=1){const x=Math.floor((X+Y)/2);e.style.setProperty("--group-text-size",`${x}px`),e.style.setProperty("--group-title-size",`${Math.round(x*1.2)}px`),e.style.setProperty("--group-card-min",`${C}px`),n.scrollHeight<=n.clientHeight?(f=x,X=x+1):Y=x-1}const A=Math.round(f*1.2),S=D.current;(S.textSize!==f||S.titleSize!==A||S.minCardWidth!==C||S.containerHeight!==j)&&(D.current={textSize:f,titleSize:A,minCardWidth:C,containerHeight:j},e.style.setProperty("--group-text-size",`${f}px`),e.style.setProperty("--group-title-size",`${A}px`),e.style.setProperty("--group-card-min",`${C}px`))},p=()=>{cancelAnimationFrame(a),a=requestAnimationFrame(d)};p();const W=new ResizeObserver(p);return W.observe(e),W.observe(n),()=>{cancelAnimationFrame(a),W.disconnect()}},[h,o]);const se=async()=>{const e=await _e({accept:".txt",sourceWidgetId:"group-generator"});if(!e)return;if(e.source==="local"){const[a]=e.files;a&&await b(a,a.name,null,null);return}const[r]=e.entryIds;if(!r)return;const n=await L(r);n?.blob&&await b(n.blob,n.name,n.parentId,n.id)};i.useEffect(()=>me("group-generator",async({entryId:r})=>{const n=await L(r);n?.blob&&await b(n.blob,n.name,n.parentId,n.id)}),[b]);const ae=()=>{const e=m.split(`
`).map(a=>a.trim()).filter(a=>a);if(e.length===0||c<=0){y([]);return}const r=[...e].sort(()=>Math.random()-.5),n=[];if(g==="byCount"){const a=Math.max(1,Math.min(c,e.length));for(let d=0;d<a;d++)n.push([]);r.forEach((d,p)=>{n[p%a].push(d)})}else{const a=Math.max(1,c);for(let d=0;d<r.length;d+=a)n.push(r.slice(d,d+a))}y(n)},q=()=>o.map((e,r)=>{const n=s("widgets.group_generator.group_title",{number:r+1}),a=e.map(d=>`- ${d}`);return[n,...a].join(`
`)}).join(`

`),ie=async()=>{if(o.length===0)return;const e=q();try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.left="-9999px",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}}catch{}},K=async()=>{if(o.length===0)return;const e=await ve(M||"grupos.txt",{sourceWidgetId:"group-generator"});if(e){if(e?.destination==="file-manager"){const r={version:1,studentList:m,generatedGroups:o,mode:g,groupValue:c},n=new Blob([JSON.stringify(r,null,2)],{type:"application/json;charset=utf-8"});await te({blob:n,filename:e.filename,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:e.parentId}),w(JSON.stringify(r)),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:e.filename}})),G(e.filename),F(e.parentId),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}));return}if(e?.destination==="download"){const r=q(),n=new Blob([r],{type:"text/plain;charset=utf-8"});be(n,e.filename),w(JSON.stringify({version:1,studentList:m,generatedGroups:o,mode:g,groupValue:c})),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:e.filename}})),G(e.filename),F(null),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}))}}},O=async()=>{if(o.length===0)return;let e=ne;if(!e&&H&&(e=(await L(H))?.parentId??null),M&&e){const r={version:1,studentList:m,generatedGroups:o,mode:g,groupValue:c},n=new Blob([JSON.stringify(r,null,2)],{type:"application/json;charset=utf-8"});await te({blob:n,filename:M,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:e}),w(JSON.stringify(r)),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}));return}await K()},k=JSON.stringify({version:1,studentList:m,generatedGroups:o,mode:g,groupValue:c}),T=v!==""&&k!==v;return i.useEffect(()=>{if(!v){w(k);return}window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:T}}))},[T,v,l,k]),i.useEffect(()=>{const e=r=>{const n=r;n.detail?.instanceId===l&&(n.detail?.widgetId&&n.detail.widgetId!=="group-generator"||O())};return window.addEventListener("widget-save-request",e),()=>window.removeEventListener("widget-save-request",e)},[O,l]),i.useEffect(()=>()=>{window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}}))},[l]),t.jsxs("div",{className:"group-generator-widget",children:[t.jsx(he,{children:t.jsxs("div",{className:"group-generator-toolbar",children:[t.jsx("button",{className:"expand-button",onClick:se,title:s("widgets.group_generator.load_from_file"),"aria-label":s("widgets.group_generator.load_from_file"),children:t.jsx(we,{size:16})}),t.jsx("button",{className:"expand-button",onClick:O,disabled:o.length===0,title:s("actions.save"),"aria-label":s("actions.save"),children:t.jsxs("span",{className:"save-indicator-icon",children:[t.jsx(xe,{size:16}),T&&t.jsx("span",{className:"save-indicator-dot","aria-hidden":"true"})]})}),t.jsx("button",{className:"expand-button",onClick:K,disabled:o.length===0,title:s("actions.save_as"),"aria-label":s("actions.save_as"),children:t.jsx(ye,{size:16})}),t.jsx("button",{className:"expand-button",onClick:ie,disabled:o.length===0,title:s("widgets.group_generator.copy_groups"),"aria-label":s("widgets.group_generator.copy_groups"),children:t.jsx(je,{size:16})}),t.jsx("button",{className:"expand-button",onClick:()=>z(e=>!e),disabled:o.length===0,title:s(h?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large"),"aria-label":s(h?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large"),children:h?t.jsx(ee,{size:16}):t.jsx(fe,{size:16})})]})}),t.jsxs("div",{className:"input-panel",children:[t.jsx("label",{className:"panel-label",children:s("widgets.group_generator.student_list_label")}),t.jsx("textarea",{value:m,onChange:e=>N(e.target.value),placeholder:s("widgets.group_generator.placeholder")})]}),t.jsxs("div",{className:"controls-panel",children:[t.jsxs("div",{className:"mode-selection",children:[t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:g==="byCount",onChange:()=>E("byCount")}),s("widgets.group_generator.number_of_groups")]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:g==="bySize",onChange:()=>E("bySize")}),s("widgets.group_generator.students_per_group")]})]}),t.jsx("input",{type:"number",value:c,onChange:e=>R(Math.max(1,parseInt(e.target.value)||1)),className:"group-value-input",min:"1"}),t.jsx("button",{onClick:ae,className:"generate-button",children:s("widgets.group_generator.generate_groups")})]}),t.jsxs("div",{className:"output-panel",children:[t.jsx("div",{className:"output-header",children:t.jsx("label",{className:"panel-label",children:s("widgets.group_generator.generated_groups_label")})}),t.jsx("div",{className:"groups-container",children:o.length>0?o.map((e,r)=>t.jsxs("div",{className:"group-card",children:[t.jsx("h4",{className:"group-title",children:s("widgets.group_generator.group_title",{number:r+1})}),t.jsx("ul",{children:e.map(n=>t.jsx("li",{children:n},n))})]},r)):t.jsx("p",{className:"no-groups-message",children:s("widgets.group_generator.no_groups_message")})})]}),h&&t.jsx("div",{className:"groups-overlay",onClick:()=>z(!1),children:t.jsxs("div",{className:"groups-overlay-content",ref:J,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"groups-overlay-header",ref:P,children:[t.jsx("h3",{children:s("widgets.group_generator.generated_groups_label")}),t.jsxs("button",{className:"expand-button",onClick:()=>z(!1),children:[t.jsx(ee,{size:16}),t.jsx("span",{children:s("widgets.group_generator.close_large_view")})]})]}),t.jsx("div",{className:"groups-container groups-container-large",ref:$,children:o.length>0?o.map((e,r)=>t.jsxs("div",{className:"group-card group-card-large",children:[t.jsx("h4",{className:"group-title",children:s("widgets.group_generator.group_title",{number:r+1})}),t.jsx("ul",{children:e.map(n=>t.jsx("li",{children:n},n))})]},r)):t.jsx("p",{className:"no-groups-message",children:s("widgets.group_generator.no_groups_message")})})]})})]})};export{Ge as GroupGeneratorWidget,ke as widgetConfig};
