import{u as oe,r as o,s as ae,j as t,F as ie,Y as D,g as K}from"./index-anQAYAUl.js";import{Z as _e}from"./index-anQAYAUl.js";import{r as le,s as ue,d as ce}from"./saveDialog-C3Mvo_aI.js";import{r as de}from"./openDialog-H-OCpcqq.js";import{E as ge}from"./expand-MKVxYx-M.js";const pe=u=>u==="byCount"||u==="bySize",me=u=>Array.isArray(u)&&u.every(s=>Array.isArray(s)&&s.every(C=>typeof C=="string")),he=u=>{try{const s=JSON.parse(u);return!s||typeof s!="object"||s.version!==1||typeof s.studentList!="string"||!pe(s.mode)||typeof s.groupValue!="number"||!Number.isFinite(s.groupValue)||!me(s.generatedGroups)?null:{version:1,studentList:s.studentList,generatedGroups:s.generatedGroups,mode:s.mode,groupValue:s.groupValue}}catch{return null}},be=({instanceId:u})=>{const{t:s}=oe(),C=o.useRef(u??`group-generator-${Date.now()}-${Math.random().toString(16).slice(2)}`),g=u??C.current,[p,N]=o.useState(`Ana
Beatriz
Carlos
Daniela
Esteban
Fernanda
Gael
Hilda
IvÃ¡n
Julia`),[d,z]=o.useState("byCount"),[c,O]=o.useState(3),[i,y]=o.useState([]),[m,M]=o.useState(!1),[U,E]=o.useState(!1),[G,h]=o.useState(""),T=o.useRef(null),L=o.useRef(null),R=o.useRef(null),H=o.useRef({titleSize:0,textSize:0,minCardWidth:0,containerHeight:0}),A=o.useCallback(e=>{N(e.studentList),y(e.generatedGroups),z(e.mode),O(Math.max(1,Math.floor(e.groupValue))),h(JSON.stringify(e))},[]),$=o.useCallback(e=>{const n=he(e);if(n){A(n);return}N(e),y([]),h(JSON.stringify({version:1,studentList:e,generatedGroups:[],mode:d,groupValue:c}))},[A]),w=o.useCallback(async e=>{const n=await e.text();$(n)},[$]);o.useEffect(()=>{if(!m)return;const e=T.current,n=L.current,r=R.current;if(!e||!n||!r)return;let a=0;const l=()=>{if(!e||!n||!r)return;const v=getComputedStyle(e),X=parseFloat(v.paddingTop)||0,ee=parseFloat(v.paddingBottom)||0,te=parseFloat(v.rowGap||v.gap)||0,j=Math.max(120,e.clientHeight-n.offsetHeight-X-ee-te);r.style.height=`${j}px`;const V=r.clientWidth,ne=Math.max(1,i.length),se=Math.min(ne,Math.max(1,Math.floor(V/320))),_=Math.max(240,Math.floor(V/se)-16),P=16,re=Math.min(40,Math.max(20,Math.floor(j/5)));let W=P,B=re,f=P;for(let q=0;q<12;q+=1){const x=Math.floor((W+B)/2);e.style.setProperty("--group-text-size",`${x}px`),e.style.setProperty("--group-title-size",`${Math.round(x*1.2)}px`),e.style.setProperty("--group-card-min",`${_}px`),r.scrollHeight<=r.clientHeight?(f=x,W=x+1):B=x-1}const k=Math.round(f*1.2),S=H.current;(S.textSize!==f||S.titleSize!==k||S.minCardWidth!==_||S.containerHeight!==j)&&(H.current={textSize:f,titleSize:k,minCardWidth:_,containerHeight:j},e.style.setProperty("--group-text-size",`${f}px`),e.style.setProperty("--group-title-size",`${k}px`),e.style.setProperty("--group-card-min",`${_}px`))},b=()=>{cancelAnimationFrame(a),a=requestAnimationFrame(l)};b();const F=new ResizeObserver(b);return F.observe(e),F.observe(r),()=>{cancelAnimationFrame(a),F.disconnect()}},[m,i]);const Y=async()=>{const e=await de({accept:".txt"});if(!e)return;if(e.source==="local"){const[a]=e.files;a&&await w(a);return}const[n]=e.entryIds;if(!n)return;const r=await K(n);r?.blob&&await w(r.blob)};o.useEffect(()=>ae("group-generator",async({entryId:n})=>{const r=await K(n);r?.blob&&await w(r.blob)}),[w]);const Z=()=>{const e=p.split(`
`).map(a=>a.trim()).filter(a=>a);if(e.length===0||c<=0){y([]);return}const n=[...e].sort(()=>Math.random()-.5),r=[];if(d==="byCount"){const a=Math.max(1,Math.min(c,e.length));for(let l=0;l<a;l++)r.push([]);n.forEach((l,b)=>{r[b%a].push(l)})}else{const a=Math.max(1,c);for(let l=0;l<n.length;l+=a)r.push(n.slice(l,l+a))}y(r)},J=()=>i.map((e,n)=>{const r=s("widgets.group_generator.group_title",{number:n+1}),a=e.map(l=>`- ${l}`);return[r,...a].join(`
`)}).join(`

`),Q=async()=>{if(i.length===0)return;const e=J();try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}E(!0),window.setTimeout(()=>E(!1),1500)}catch{E(!1)}},I=async()=>{if(i.length===0)return;const e=await le("grupos.txt");if(e){if(e?.destination==="file-manager"){const n={version:1,studentList:p,generatedGroups:i,mode:d,groupValue:c},r=new Blob([JSON.stringify(n,null,2)],{type:"application/json;charset=utf-8"});await ue({blob:r,filename:e.filename,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:e.parentId}),h(JSON.stringify(n)),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:g,widgetId:"group-generator"}}));return}if(e?.destination==="download"){const n=J(),r=new Blob([n],{type:"text/plain;charset=utf-8"});ce(r,e.filename),h(JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:d,groupValue:c})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:g,widgetId:"group-generator"}}))}}};return o.useEffect(()=>{if(!G){const r=JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:d,groupValue:c});h(r);return}const n=JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:d,groupValue:c})!==G;window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:g,widgetId:"group-generator",isDirty:n}}))},[i,c,G,d,g,p]),o.useEffect(()=>{const e=n=>{const r=n;r.detail?.instanceId===g&&(r.detail?.widgetId&&r.detail.widgetId!=="group-generator"||I())};return window.addEventListener("widget-save-request",e),()=>window.removeEventListener("widget-save-request",e)},[I,g]),o.useEffect(()=>()=>{window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:g,widgetId:"group-generator",isDirty:!1}}))},[g]),t.jsxs("div",{className:"group-generator-widget",children:[t.jsxs("div",{className:"input-panel",children:[t.jsx("label",{className:"panel-label",children:s("widgets.group_generator.student_list_label")}),t.jsx("textarea",{value:p,onChange:e=>N(e.target.value),placeholder:s("widgets.group_generator.placeholder")}),t.jsxs("button",{onClick:Y,className:"upload-button",children:[t.jsx(ie,{size:16})," ",s("widgets.group_generator.load_from_file")]})]}),t.jsxs("div",{className:"controls-panel",children:[t.jsxs("div",{className:"mode-selection",children:[t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:d==="byCount",onChange:()=>z("byCount")}),s("widgets.group_generator.number_of_groups")]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:d==="bySize",onChange:()=>z("bySize")}),s("widgets.group_generator.students_per_group")]})]}),t.jsx("input",{type:"number",value:c,onChange:e=>O(Math.max(1,parseInt(e.target.value)||1)),className:"group-value-input",min:"1"}),t.jsx("button",{onClick:Z,className:"generate-button",children:s("widgets.group_generator.generate_groups")})]}),t.jsxs("div",{className:"output-panel",children:[t.jsxs("div",{className:"output-header",children:[t.jsx("label",{className:"panel-label",children:s("widgets.group_generator.generated_groups_label")}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"expand-button",onClick:Q,disabled:i.length===0,title:s("widgets.group_generator.copy_groups"),children:t.jsx("span",{children:s(U?"widgets.group_generator.copied":"widgets.group_generator.copy_groups")})}),t.jsx("button",{className:"expand-button",onClick:I,disabled:i.length===0,title:s("widgets.group_generator.download_groups"),children:t.jsx("span",{children:s("widgets.group_generator.download_groups")})}),t.jsxs("button",{className:"expand-button",onClick:()=>M(!m),disabled:i.length===0,children:[m?t.jsx(D,{size:16}):t.jsx(ge,{size:16}),t.jsx("span",{children:s(m?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large")})]})]})]}),t.jsx("div",{className:"groups-container",children:i.length>0?i.map((e,n)=>t.jsxs("div",{className:"group-card",children:[t.jsx("h4",{className:"group-title",children:s("widgets.group_generator.group_title",{number:n+1})}),t.jsx("ul",{children:e.map(r=>t.jsx("li",{children:r},r))})]},n)):t.jsx("p",{className:"no-groups-message",children:s("widgets.group_generator.no_groups_message")})})]}),m&&t.jsx("div",{className:"groups-overlay",onClick:()=>M(!1),children:t.jsxs("div",{className:"groups-overlay-content",ref:T,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"groups-overlay-header",ref:L,children:[t.jsx("h3",{children:s("widgets.group_generator.generated_groups_label")}),t.jsxs("button",{className:"expand-button",onClick:()=>M(!1),children:[t.jsx(D,{size:16}),t.jsx("span",{children:s("widgets.group_generator.close_large_view")})]})]}),t.jsx("div",{className:"groups-container groups-container-large",ref:R,children:i.length>0?i.map((e,n)=>t.jsxs("div",{className:"group-card group-card-large",children:[t.jsx("h4",{className:"group-title",children:s("widgets.group_generator.group_title",{number:n+1})}),t.jsx("ul",{children:e.map(r=>t.jsx("li",{children:r},r))})]},n)):t.jsx("p",{className:"no-groups-message",children:s("widgets.group_generator.no_groups_message")})})]})})]})};export{be as GroupGeneratorWidget,_e as widgetConfig};
