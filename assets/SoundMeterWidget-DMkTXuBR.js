import{u as y,r as n,j as e,aI as N,aJ as b}from"./react-vendor-WCYW3yxo.js";import{I as D}from"./index-DEF43kZb.js";import"./vendor-DCW5Txpp.js";import"./dnd-kit-ZKKYBs6g.js";const C={silence:{labelKey:"widgets.sound_meter.silence",emoji:"ðŸ¤«",className:"level-silence"},conversation:{labelKey:"widgets.sound_meter.conversation",emoji:"ðŸ—£ï¸",className:"level-conversation"},noise:{labelKey:"widgets.sound_meter.noise",emoji:"ðŸ’¥",className:"level-noise"}},E=()=>{const{t}=y(),[g,f]=n.useState("silence"),[u,o]=n.useState("prompt"),r=n.useRef(null),a=n.useRef(null),c=n.useRef(void 0),p=s=>s<15?"silence":s<45?"conversation":"noise",v=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert(t("widgets.sound_meter.no_audio_support")),o("denied");return}const s=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});a.current=s;const d=window.AudioContext||window.webkitAudioContext;r.current=new d;const i=r.current.createAnalyser();r.current.createMediaStreamSource(s).connect(i),o("granted");const l=new Uint8Array(i.frequencyBinCount),m=()=>{i.getByteFrequencyData(l);const w=l.reduce((_,h)=>_+h,0)/l.length;f(p(w)),c.current=requestAnimationFrame(m)};m()}catch(s){console.error(t("widgets.sound_meter.microphone_error"),s),o("denied")}},x=()=>{c.current&&cancelAnimationFrame(c.current),a.current&&a.current.getTracks().forEach(s=>s.stop()),r.current&&r.current.state!=="closed"&&r.current.close()};n.useEffect(()=>()=>x(),[]);const j=()=>{if(u==="granted"){const{labelKey:s,emoji:d,className:i}=C[g];return e.jsxs("div",{className:`level-card ${i}`,children:[e.jsx("span",{className:"emoji",children:d}),e.jsx("span",{className:"label",children:t(s)})]})}return e.jsx("div",{className:"permission-screen",children:u==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:48,className:"text-red-500"}),e.jsx("p",{children:t("widgets.sound_meter.access_denied")}),e.jsx("small",{children:t("widgets.sound_meter.enable_browser_settings")})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:48}),e.jsx("p",{children:t("widgets.sound_meter.permission_needed")}),e.jsx("button",{onClick:v,className:"permission-button",children:t("widgets.sound_meter.activate_meter")})]})})};return e.jsx("div",{className:"sound-meter-widget",children:j()})};export{E as SoundMeterWidget,D as widgetConfig};
