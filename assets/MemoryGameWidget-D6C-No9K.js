import{u as j,r as p,j as s,a0 as x,g as _}from"./index-KG3SMhAr.js";import{a6 as E}from"./index-KG3SMhAr.js";import{r as C}from"./openDialog-H-OCpcqq.js";import{R as v}from"./rotate-ccw-i0moJw7W.js";const M=()=>{const{t:o}=j(),[r,m]=p.useState([]),[d,c]=p.useState([]),[g,h]=p.useState(0),u=e=>{const a=[];Array.from(e).forEach(i=>{i.type.startsWith("image/")&&a.push(new Promise(t=>{const n=new FileReader;n.onload=l=>t(l.target?.result),n.readAsDataURL(i)}))}),Promise.all(a).then(i=>{const t=[];i.forEach((n,l)=>{t.push({id:l*2,pairId:l,content:n,isFlipped:!1,isMatched:!1}),t.push({id:l*2+1,pairId:l,content:n,isFlipped:!1,isMatched:!1})}),m(t.sort(()=>Math.random()-.5)),h(0),c([])})},f=async()=>{const e=await C({accept:"image/*",multiple:!0});if(!e)return;if(e.source==="local"){e.files.length>1?u(e.files):alert(o("widgets.memory_game.min_images_alert"));return}const a=[];for(const i of e.entryIds){const t=await _(i);t?.blob&&(t.mime&&!t.mime.startsWith("image/")||a.push(new File([t.blob],t.name,{type:t.mime||t.blob.type})))}a.length>1?u(a):alert(o("widgets.memory_game.min_images_alert"))},y=e=>{if(r[e].isFlipped||d.length===2)return;const a=[...d,e];c(a);const i=[...r];i[e].isFlipped=!0,m(i)};p.useEffect(()=>{if(d.length===2){h(g+1);const[e,a]=d,i=r[e],t=r[a];if(i.pairId===t.pairId){const n=r.map(l=>l.pairId===i.pairId?{...l,isMatched:!0}:l);m(n),c([])}else setTimeout(()=>{const n=[...r];n[e].isFlipped=!1,n[a].isFlipped=!1,m(n),c([])},1e3)}},[d]);const w=r.length>0&&r.every(e=>e.isMatched);return r.length===0?s.jsxs("div",{className:"memory-placeholder",children:[s.jsx(x,{size:48}),s.jsx("p",{children:o("widgets.memory_game.upload_prompt")}),s.jsx("small",{children:o("widgets.memory_game.upload_rule")}),s.jsx("button",{className:"memory-upload-button",onClick:f,children:o("widgets.memory_game.upload_prompt")})]}):s.jsxs("div",{className:"memory-game-widget",children:[s.jsx("div",{className:"game-board",style:{gridTemplateColumns:`repeat(${Math.ceil(Math.sqrt(r.length))}, 1fr)`},children:r.map((e,a)=>s.jsx("div",{className:`card ${e.isFlipped||e.isMatched?"flipped":""}`,onClick:()=>y(a),children:s.jsxs("div",{className:"card-inner",children:[s.jsx("div",{className:"card-front",children:"?"}),s.jsx("div",{className:"card-back",children:s.jsx("img",{src:e.content,alt:`par ${e.pairId}`})})]})},a))}),s.jsxs("div",{className:"game-footer",children:[s.jsx("span",{children:o("widgets.memory_game.moves",{count:g})}),s.jsxs("button",{onClick:()=>m([]),children:[s.jsx(v,{size:16})," ",o("widgets.memory_game.start_over")]})]}),w&&s.jsxs("div",{className:"game-won-overlay",children:[s.jsx("h2",{children:o("widgets.memory_game.win_title")}),s.jsx("p",{children:o("widgets.memory_game.win_message",{moves:g})}),s.jsx("button",{onClick:()=>m([]),children:o("widgets.memory_game.play_again")})]})]})};export{M as MemoryGameWidget,E as widgetConfig};
