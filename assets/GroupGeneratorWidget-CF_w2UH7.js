import{u as ae,r as o,s as oe,j as t,W as ie,F as le,_ as q,$ as de,g as K}from"./index-C6KpQlP3.js";import{a0 as Ee}from"./index-C6KpQlP3.js";import{r as ue,s as ce,d as ge}from"./saveDialog-PNL0kTw0.js";import{r as pe}from"./openDialog-H-OCpcqq.js";import{S as me}from"./save-CkKKekmr.js";import{C as he}from"./copy-BDOZ3lAk.js";const fe=c=>c==="byCount"||c==="bySize",we=c=>Array.isArray(c)&&c.every(s=>Array.isArray(s)&&s.every(S=>typeof S=="string")),xe=c=>{try{const s=JSON.parse(c);return!s||typeof s!="object"||s.version!==1||typeof s.studentList!="string"||!fe(s.mode)||typeof s.groupValue!="number"||!Number.isFinite(s.groupValue)||!we(s.generatedGroups)?null:{version:1,studentList:s.studentList,generatedGroups:s.generatedGroups,mode:s.mode,groupValue:s.groupValue}}catch{return null}},Ce=({instanceId:c})=>{const{t:s}=ae(),S=o.useRef(c??`group-generator-${Date.now()}-${Math.random().toString(16).slice(2)}`),l=c??S.current,[p,N]=o.useState(`Ana
Beatriz
Carlos
Daniela
Esteban
Fernanda
Gael
Hilda
IvÃ¡n
Julia`),[g,E]=o.useState("byCount"),[u,k]=o.useState(3),[i,x]=o.useState([]),[m,I]=o.useState(!1),[z,h]=o.useState(""),[U,M]=o.useState(null),T=o.useRef(null),L=o.useRef(null),R=o.useRef(null),W=o.useRef({titleSize:0,textSize:0,minCardWidth:0,containerHeight:0}),H=o.useCallback(e=>{N(e.studentList),x(e.generatedGroups),E(e.mode),k(Math.max(1,Math.floor(e.groupValue))),h(JSON.stringify(e))},[]),$=o.useCallback(e=>{const n=xe(e);if(n){H(n);return}N(e),x([]),h(JSON.stringify({version:1,studentList:e,generatedGroups:[],mode:g,groupValue:u}))},[H,u,g]),y=o.useCallback(async(e,n)=>{const r=await e.text();$(r);const a=n?.trim();a&&window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:a}})),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),a&&M(a)},[$,l]);o.useEffect(()=>{if(!m)return;const e=T.current,n=L.current,r=R.current;if(!e||!n||!r)return;let a=0;const d=()=>{if(!e||!n||!r)return;const b=getComputedStyle(e),Z=parseFloat(b.paddingTop)||0,ee=parseFloat(b.paddingBottom)||0,te=parseFloat(b.rowGap||b.gap)||0,_=Math.max(120,e.clientHeight-n.offsetHeight-Z-ee-te);r.style.height=`${_}px`;const J=r.clientWidth,ne=Math.max(1,i.length),re=Math.min(ne,Math.max(1,Math.floor(J/320))),j=Math.max(240,Math.floor(J/re)-16),V=16,se=Math.min(40,Math.max(20,Math.floor(_/5)));let D=V,P=se,f=V;for(let B=0;B<12;B+=1){const w=Math.floor((D+P)/2);e.style.setProperty("--group-text-size",`${w}px`),e.style.setProperty("--group-title-size",`${Math.round(w*1.2)}px`),e.style.setProperty("--group-card-min",`${j}px`),r.scrollHeight<=r.clientHeight?(f=w,D=w+1):P=w-1}const O=Math.round(f*1.2),C=W.current;(C.textSize!==f||C.titleSize!==O||C.minCardWidth!==j||C.containerHeight!==_)&&(W.current={textSize:f,titleSize:O,minCardWidth:j,containerHeight:_},e.style.setProperty("--group-text-size",`${f}px`),e.style.setProperty("--group-title-size",`${O}px`),e.style.setProperty("--group-card-min",`${j}px`))},v=()=>{cancelAnimationFrame(a),a=requestAnimationFrame(d)};v();const F=new ResizeObserver(v);return F.observe(e),F.observe(r),()=>{cancelAnimationFrame(a),F.disconnect()}},[m,i]);const Q=async()=>{const e=await pe({accept:".txt",sourceWidgetId:"group-generator"});if(!e)return;if(e.source==="local"){const[a]=e.files;a&&await y(a,a.name);return}const[n]=e.entryIds;if(!n)return;const r=await K(n);r?.blob&&await y(r.blob,r.name)};o.useEffect(()=>oe("group-generator",async({entryId:n})=>{const r=await K(n);r?.blob&&await y(r.blob,r.name)}),[y]);const X=()=>{const e=p.split(`
`).map(a=>a.trim()).filter(a=>a);if(e.length===0||u<=0){x([]);return}const n=[...e].sort(()=>Math.random()-.5),r=[];if(g==="byCount"){const a=Math.max(1,Math.min(u,e.length));for(let d=0;d<a;d++)r.push([]);n.forEach((d,v)=>{r[v%a].push(d)})}else{const a=Math.max(1,u);for(let d=0;d<n.length;d+=a)r.push(n.slice(d,d+a))}x(r)},A=()=>i.map((e,n)=>{const r=s("widgets.group_generator.group_title",{number:n+1}),a=e.map(d=>`- ${d}`);return[r,...a].join(`
`)}).join(`

`),Y=async()=>{if(i.length===0)return;const e=A();try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}catch{}},G=async()=>{if(i.length===0)return;const e=await ue(U||"grupos.txt",{sourceWidgetId:"group-generator"});if(e){if(e?.destination==="file-manager"){const n={version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u},r=new Blob([JSON.stringify(n,null,2)],{type:"application/json;charset=utf-8"});await ce({blob:r,filename:e.filename,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:e.parentId}),h(JSON.stringify(n)),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:e.filename}})),M(e.filename),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}));return}if(e?.destination==="download"){const n=A(),r=new Blob([n],{type:"text/plain;charset=utf-8"});ge(r,e.filename),h(JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u})),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:e.filename}})),M(e.filename),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}))}}};return o.useEffect(()=>{if(!z){const r=JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u});h(r);return}const n=JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u})!==z;window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:n}}))},[i,u,z,g,l,p]),o.useEffect(()=>{const e=n=>{const r=n;r.detail?.instanceId===l&&(r.detail?.widgetId&&r.detail.widgetId!=="group-generator"||G())};return window.addEventListener("widget-save-request",e),()=>window.removeEventListener("widget-save-request",e)},[G,l]),o.useEffect(()=>()=>{window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}}))},[l]),t.jsxs("div",{className:"group-generator-widget",children:[t.jsx(ie,{children:t.jsxs("div",{className:"group-generator-toolbar",children:[t.jsx("button",{className:"expand-button",onClick:Q,title:s("widgets.group_generator.load_from_file"),"aria-label":s("widgets.group_generator.load_from_file"),children:t.jsx(le,{size:16})}),t.jsx("button",{className:"expand-button",onClick:G,disabled:i.length===0,title:s("widgets.group_generator.download_groups"),"aria-label":s("widgets.group_generator.download_groups"),children:t.jsx(me,{size:16})}),t.jsx("button",{className:"expand-button",onClick:Y,disabled:i.length===0,title:s("widgets.group_generator.copy_groups"),"aria-label":s("widgets.group_generator.copy_groups"),children:t.jsx(he,{size:16})}),t.jsx("button",{className:"expand-button",onClick:()=>I(e=>!e),disabled:i.length===0,title:s(m?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large"),"aria-label":s(m?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large"),children:m?t.jsx(q,{size:16}):t.jsx(de,{size:16})})]})}),t.jsxs("div",{className:"input-panel",children:[t.jsx("label",{className:"panel-label",children:s("widgets.group_generator.student_list_label")}),t.jsx("textarea",{value:p,onChange:e=>N(e.target.value),placeholder:s("widgets.group_generator.placeholder")})]}),t.jsxs("div",{className:"controls-panel",children:[t.jsxs("div",{className:"mode-selection",children:[t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:g==="byCount",onChange:()=>E("byCount")}),s("widgets.group_generator.number_of_groups")]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:g==="bySize",onChange:()=>E("bySize")}),s("widgets.group_generator.students_per_group")]})]}),t.jsx("input",{type:"number",value:u,onChange:e=>k(Math.max(1,parseInt(e.target.value)||1)),className:"group-value-input",min:"1"}),t.jsx("button",{onClick:X,className:"generate-button",children:s("widgets.group_generator.generate_groups")})]}),t.jsxs("div",{className:"output-panel",children:[t.jsx("div",{className:"output-header",children:t.jsx("label",{className:"panel-label",children:s("widgets.group_generator.generated_groups_label")})}),t.jsx("div",{className:"groups-container",children:i.length>0?i.map((e,n)=>t.jsxs("div",{className:"group-card",children:[t.jsx("h4",{className:"group-title",children:s("widgets.group_generator.group_title",{number:n+1})}),t.jsx("ul",{children:e.map(r=>t.jsx("li",{children:r},r))})]},n)):t.jsx("p",{className:"no-groups-message",children:s("widgets.group_generator.no_groups_message")})})]}),m&&t.jsx("div",{className:"groups-overlay",onClick:()=>I(!1),children:t.jsxs("div",{className:"groups-overlay-content",ref:T,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"groups-overlay-header",ref:L,children:[t.jsx("h3",{children:s("widgets.group_generator.generated_groups_label")}),t.jsxs("button",{className:"expand-button",onClick:()=>I(!1),children:[t.jsx(q,{size:16}),t.jsx("span",{children:s("widgets.group_generator.close_large_view")})]})]}),t.jsx("div",{className:"groups-container groups-container-large",ref:R,children:i.length>0?i.map((e,n)=>t.jsxs("div",{className:"group-card group-card-large",children:[t.jsx("h4",{className:"group-title",children:s("widgets.group_generator.group_title",{number:n+1})}),t.jsx("ul",{children:e.map(r=>t.jsx("li",{children:r},r))})]},n)):t.jsx("p",{className:"no-groups-message",children:s("widgets.group_generator.no_groups_message")})})]})})]})};export{Ce as GroupGeneratorWidget,Ee as widgetConfig};
