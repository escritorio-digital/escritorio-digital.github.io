import{c as A,u as K,r as i,g as Q,s as U,j as e,C as X,P as Y,B as Z,T as ee,a as g,b as z}from"./index-BTW4FmfC.js";import{w as me}from"./index-BTW4FmfC.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],se=A("bell-off",te);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],ne=A("timer",ae),ie=c=>{const s=Math.max(0,Math.floor(c/1e3)),m=Math.floor(s/3600),r=Math.floor(s%3600/60),d=s%60;return[m,r,d].map(l=>String(l).padStart(2,"0")).join(":")},re=c=>{const[s,m]=c.split(":"),r=Number.parseInt(s??"",10),d=Number.parseInt(m??"",10);if(!Number.isFinite(r)||!Number.isFinite(d))return null;const u=new Date,l=new Date(u);return l.setHours(r,d,0,0),l.getTime()<=u.getTime()&&l.setDate(l.getDate()+1),l.getTime()},oe=({instanceId:c})=>{const{t:s,i18n:m}=K(),[r,d]=i.useState("time"),[u,l]=i.useState("08:00"),[v,D]=i.useState(5),[N,H]=i.useState(0),[w,I]=i.useState(""),[h,q]=i.useState(!0),[y,B]=i.useState(()=>Q()),[T,x]=i.useState(null),[F,L]=i.useState(Date.now()),_=i.useRef(null),S=i.useRef(null),f=i.useRef(null),b=i.useRef(0);i.useEffect(()=>U(B),[]),i.useEffect(()=>{const t=window.setInterval(()=>L(Date.now()),1e3);return()=>window.clearInterval(t)},[]);const C=i.useMemo(()=>{const t=new Intl.DateTimeFormat(m.language,{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short"});return[...y].sort((a,n)=>a.targetTime-n.targetTime).map(a=>({...a,formattedTime:t.format(new Date(a.targetTime))}))},[y,m.language]),O=()=>{if(x(null),r==="time"){const a=re(u);if(!a){x(s("widgets.alarm.invalid_time"));return}g(n=>[...n,z({label:w.trim(),targetTime:a,soundEnabled:h,mode:r})]);return}const t=Math.max(0,v*60+N);if(t<=0){x(s("widgets.alarm.invalid_countdown"));return}g(a=>[...a,z({label:w.trim(),targetTime:Date.now()+t*1e3,soundEnabled:h,mode:r})])},P=t=>{g(a=>a.map(n=>n.id===t?{...n,soundEnabled:!n.soundEnabled}:n))},V=(t,a)=>{g(n=>n.map(o=>o.id===t?{...o,label:a}:o))},$=t=>{g(a=>a.filter(n=>n.id!==t))},p=C.length>0;return i.useEffect(()=>{if(!c)return;const t=_.current,a=S.current;if(!t||!a)return;const n=t.closest(".widget-window");if(!n)return;const o=()=>{const R=t.clientHeight,E=a.scrollHeight;if(E<=R+6)return;const G=n.getBoundingClientRect().height,J=E-R,j=Math.ceil(G+J+16);f.current&&Math.abs(j-f.current)<6||(f.current=j,window.dispatchEvent(new CustomEvent("widget-resize-request",{detail:{instanceId:c,size:{height:j}}})))},k=new ResizeObserver(o);k.observe(a),o(),b.current=0;const M=()=>{b.current+=1,o(),b.current<3&&window.setTimeout(M,80)},W=window.setTimeout(M,60);return()=>{k.disconnect(),window.clearTimeout(W)}},[c,p,r]),e.jsx("div",{className:"alarm-widget",ref:_,children:e.jsxs("div",{className:"alarm-content",ref:S,children:[e.jsxs("div",{className:"alarm-form",children:[e.jsx("div",{className:"alarm-section-title",children:s("widgets.alarm.mode_label")}),e.jsxs("div",{className:"alarm-mode-toggle",children:[e.jsxs("button",{type:"button",className:r==="time"?"active":"",onClick:()=>d("time"),children:[e.jsx(X,{size:16}),s("widgets.alarm.mode_time")]}),e.jsxs("button",{type:"button",className:r==="countdown"?"active":"",onClick:()=>d("countdown"),children:[e.jsx(ne,{size:16}),s("widgets.alarm.mode_countdown")]})]}),r==="time"?e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.time_label")}),e.jsx("input",{type:"time",value:u,onChange:t=>l(t.target.value)})]}):e.jsxs("div",{className:"alarm-countdown-grid",children:[e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.countdown_minutes")}),e.jsx("input",{type:"number",min:0,value:v,onChange:t=>D(Math.max(0,Number(t.target.value)||0))})]}),e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.countdown_seconds")}),e.jsx("input",{type:"number",min:0,max:59,value:N,onChange:t=>{const a=Math.max(0,Math.min(59,Number(t.target.value)||0));H(a)}})]})]}),e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.label_label")}),e.jsx("input",{type:"text",value:w,onChange:t=>I(t.target.value),placeholder:s("widgets.alarm.default_label")})]}),e.jsxs("label",{className:"alarm-sound-toggle",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>q(t.target.checked)}),e.jsx("span",{children:s(h?"widgets.alarm.sound_on":"widgets.alarm.sound_off")})]}),T&&e.jsx("div",{className:"alarm-error",children:T}),e.jsxs("button",{type:"button",className:"alarm-submit",onClick:O,children:[e.jsx(Y,{size:16}),s("widgets.alarm.add_alarm")]}),!p&&e.jsx("p",{className:"alarm-empty-inline",children:s("widgets.alarm.none")})]}),p&&e.jsxs("div",{className:"alarm-list",children:[e.jsx("div",{className:"alarm-section-title",children:s("widgets.alarm.active_alarms")}),e.jsx("div",{className:"alarm-items",children:C.map(t=>{const a=t.targetTime-F,n=t.label||s("widgets.alarm.default_label");return e.jsxs("div",{className:`alarm-item${t.triggered?" is-triggered":""}`,children:[e.jsxs("div",{className:"alarm-item-main",children:[e.jsx("input",{className:"alarm-item-title-input",value:n,onChange:o=>V(t.id,o.target.value),placeholder:s("widgets.alarm.default_label")}),e.jsx("div",{className:"alarm-item-meta",children:t.triggered?s("widgets.alarm.triggered"):s("widgets.alarm.remaining",{time:ie(a)})}),e.jsx("div",{className:"alarm-item-time",children:s("widgets.alarm.scheduled_for",{time:t.formattedTime})})]}),e.jsxs("div",{className:"alarm-item-actions",children:[e.jsx("button",{type:"button",className:"alarm-action",onClick:()=>P(t.id),title:t.soundEnabled?s("widgets.alarm.sound_on"):s("widgets.alarm.sound_off"),children:t.soundEnabled?e.jsx(Z,{size:16}):e.jsx(se,{size:16})}),e.jsxs("button",{type:"button",className:"alarm-action danger",onClick:()=>$(t.id),children:[e.jsx(ee,{size:16}),t.triggered?s("widgets.alarm.dismiss"):s("widgets.alarm.delete")]})]})]},t.id)})})]})]})})};export{oe as AlarmWidget,me as widgetConfig};
