import{u as O,r as g,j as o}from"./index-BB7dV77T.js";import{ao as V}from"./index-BB7dV77T.js";const N={"+":{prec:1,assoc:"left",arity:2},"-":{prec:1,assoc:"left",arity:2},"*":{prec:2,assoc:"left",arity:2},"/":{prec:2,assoc:"left",arity:2},"^":{prec:3,assoc:"right",arity:2},neg:{prec:4,assoc:"right",arity:1},"!":{prec:5,assoc:"left",arity:1},"%":{prec:5,assoc:"left",arity:1}},T=[{label:"C",value:"clear",kind:"control"},{label:"⌫",value:"backspace",kind:"control"},{label:"%",value:"%",kind:"operator"},{label:"÷",value:"/",kind:"operator"},{label:"7",value:"7",kind:"digit"},{label:"8",value:"8",kind:"digit"},{label:"9",value:"9",kind:"digit"},{label:"×",value:"*",kind:"operator"},{label:"4",value:"4",kind:"digit"},{label:"5",value:"5",kind:"digit"},{label:"6",value:"6",kind:"digit"},{label:"−",value:"-",kind:"operator"},{label:"1",value:"1",kind:"digit"},{label:"2",value:"2",kind:"digit"},{label:"3",value:"3",kind:"digit"},{label:"+",value:"+",kind:"operator"},{label:"0",value:"0",kind:"digit",span:2},{label:".",value:".",kind:"digit"},{label:"=",value:"=",kind:"equals"}],P=[{label:"C",value:"clear",kind:"control"},{label:"⌫",value:"backspace",kind:"control"},{label:"(",value:"(",kind:"operator"},{label:")",value:")",kind:"operator"},{label:"√",value:"sqrt",kind:"function"},{label:"^",value:"^",kind:"operator"},{label:"%",value:"%",kind:"operator"},{label:"÷",value:"/",kind:"operator"},{label:"7",value:"7",kind:"digit"},{label:"8",value:"8",kind:"digit"},{label:"9",value:"9",kind:"digit"},{label:"×",value:"*",kind:"operator"},{label:"4",value:"4",kind:"digit"},{label:"5",value:"5",kind:"digit"},{label:"6",value:"6",kind:"digit"},{label:"−",value:"-",kind:"operator"},{label:"1",value:"1",kind:"digit"},{label:"2",value:"2",kind:"digit"},{label:"3",value:"3",kind:"digit"},{label:"+",value:"+",kind:"operator"},{label:"Ans",value:"Ans",kind:"constant"},{label:"0",value:"0",kind:"digit"},{label:".",value:".",kind:"digit"},{label:"=",value:"=",kind:"equals"}],z=[{label:"RAD",value:"angle",kind:"toggle"},{label:"sin",value:"sin",kind:"function"},{label:"cos",value:"cos",kind:"function"},{label:"tan",value:"tan",kind:"function"},{label:"π",value:"pi",kind:"constant"},{label:"C",value:"clear",kind:"control"},{label:"⌫",value:"backspace",kind:"control"},{label:"log",value:"log",kind:"function"},{label:"ln",value:"ln",kind:"function"},{label:"√",value:"sqrt",kind:"function"},{label:"7",value:"7",kind:"digit"},{label:"8",value:"8",kind:"digit"},{label:"9",value:"9",kind:"digit"},{label:"÷",value:"/",kind:"operator"},{label:"^",value:"^",kind:"operator"},{label:"4",value:"4",kind:"digit"},{label:"5",value:"5",kind:"digit"},{label:"6",value:"6",kind:"digit"},{label:"×",value:"*",kind:"operator"},{label:"%",value:"%",kind:"operator"},{label:"1",value:"1",kind:"digit"},{label:"2",value:"2",kind:"digit"},{label:"3",value:"3",kind:"digit"},{label:"−",value:"-",kind:"operator"},{label:"x!",value:"!",kind:"operator"},{label:"0",value:"0",kind:"digit"},{label:".",value:".",kind:"digit"},{label:"Ans",value:"Ans",kind:"constant"},{label:"+",value:"+",kind:"operator"},{label:"=",value:"=",kind:"equals"}],M=l=>l.replace(/sqrt\(/g,"√(").replace(/pi/g,"π").replace(/Ans/g,"Ans").replace(/\*/g,"×").replace(/\//g,"÷").replace(/-/g,"−"),F=l=>l.replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-"),_=l=>{const s=[];let i=0;const n=F(l);for(;i<n.length;){const e=n[i];if(e===" "){i+=1;continue}if(/[0-9.]/.test(e)){const r=n.slice(i).match(/^((\d+(\.\d*)?)|(\.\d+))([eE][+-]?\d+)?/);if(!r)throw new Error("Invalid number");s.push({type:"number",value:r[0]}),i+=r[0].length;continue}if(/[a-zA-Z]/.test(e)){const r=n.slice(i).match(/^[a-zA-Z]+/);if(!r)throw new Error("Invalid identifier");const a=r[0].toLowerCase();if(["sin","cos","tan","log","ln","sqrt"].includes(a))s.push({type:"function",value:a});else if(a==="pi")s.push({type:"constant",value:"pi"});else if(a==="ans")s.push({type:"variable",value:"ans"});else throw new Error("Unknown identifier");i+=r[0].length;continue}if(e==="π"){s.push({type:"constant",value:"pi"}),i+=1;continue}if(e==="("||e===")"){s.push({type:"paren",value:e}),i+=1;continue}if(["+","-","*","/","^"].includes(e)){s.push({type:"operator",value:e}),i+=1;continue}if(e==="!"||e==="%"){s.push({type:"postfix",value:e}),i+=1;continue}throw new Error("Invalid character")}return s},D=l=>{const s=[],i=[];let n=null;for(l.forEach(e=>{if(e.type==="operator"&&e.value==="-"&&(!n||n.type==="operator"||n.type==="paren"&&n.value==="("||n.type==="function")&&(e={type:"operator",value:"neg"}),e.type==="number"||e.type==="constant"||e.type==="variable")s.push(e);else if(e.type==="function")i.push(e);else if(e.type==="postfix")s.push(e);else if(e.type==="operator"){const r=N[e.value];if(!r)throw new Error("Unknown operator");for(;i.length>0;){const a=i[i.length-1];if(a.type!=="operator")break;const u=N[a.value];if(!u)break;const k=u.prec>r.prec,y=u.prec===r.prec&&r.assoc==="left";if(k||y)s.push(i.pop());else break}i.push(e)}else if(e.type==="paren")if(e.value==="(")i.push(e);else{for(;i.length>0&&i[i.length-1].value!=="(";)s.push(i.pop());if(i.length===0)throw new Error("Mismatched parentheses");i.pop(),i.length>0&&i[i.length-1].type==="function"&&s.push(i.pop())}n=e});i.length>0;){const e=i.pop();if(e.type==="paren")throw new Error("Mismatched parentheses");s.push(e)}return s},Z=l=>{if(!Number.isFinite(l)||l<0||Math.floor(l)!==l)return NaN;if(l>170)return 1/0;let s=1;for(let i=2;i<=l;i+=1)s*=i;return s},B=(l,s,i)=>{const n=[];if(l.forEach(e=>{if(e.type==="number"){n.push(Number(e.value));return}if(e.type==="constant"){n.push(Math.PI);return}if(e.type==="variable"){n.push(i);return}if(e.type==="function"){const r=n.pop();if(r===void 0)throw new Error("Missing argument");const a=s==="deg"&&["sin","cos","tan"].includes(e.value)?r*Math.PI/180:r;e.value==="sin"&&n.push(Math.sin(a)),e.value==="cos"&&n.push(Math.cos(a)),e.value==="tan"&&n.push(Math.tan(a)),e.value==="log"&&n.push(Math.log10(r)),e.value==="ln"&&n.push(Math.log(r)),e.value==="sqrt"&&n.push(Math.sqrt(r));return}if(e.type==="postfix"){const r=n.pop();if(r===void 0)throw new Error("Missing argument");e.value==="!"&&n.push(Z(r)),e.value==="%"&&n.push(r/100);return}if(e.type==="operator"){const r=N[e.value];if(!r)throw new Error("Unknown operator");if(r.arity===1){const k=n.pop();if(k===void 0)throw new Error("Missing argument");n.push(-k);return}const a=n.pop(),u=n.pop();if(u===void 0||a===void 0)throw new Error("Missing argument");e.value==="+"&&n.push(u+a),e.value==="-"&&n.push(u-a),e.value==="*"&&n.push(u*a),e.value==="/"&&n.push(u/a),e.value==="^"&&n.push(u**a)}}),n.length!==1)throw new Error("Invalid expression");return n[0]},Y=l=>{if(!Number.isFinite(l))return"Error";const s=Math.abs(l);return s!==0&&(s>=1e12||s<1e-9)?l.toExponential(8):Number.parseFloat(l.toFixed(10)).toString()},x=l=>["+","-","*","/","^"].includes(l),H=l=>{const s=[["Ans",3],["sqrt(",5],["sin(",4],["cos(",4],["tan(",4],["log(",4],["ln(",3],["pi",2]];for(const[i,n]of s)if(l.endsWith(i))return l.slice(0,-n);return l.slice(0,-1)},J=()=>{const{t:l,ready:s}=O(),[i,n]=g.useState("scientific"),[e,r]=g.useState("deg"),[a,u]=g.useState(""),[k,y]=g.useState(""),[m,d]=g.useState("0"),[C,q]=g.useState(0),[j,b]=g.useState(!1),I=g.useRef(null);g.useLayoutEffect(()=>{const t=I.current;if(!t)return;const c=360,p=520,w=()=>{const h=t.getBoundingClientRect(),L=Math.min(h.width/c,h.height/p),U=Math.max(.85,Math.min(1.35,L));t.style.setProperty("--calc-scale",U.toFixed(3))};w();const v=new ResizeObserver(w);return v.observe(t),()=>v.disconnect()},[]);const S=g.useMemo(()=>i==="basic"?T:i==="standard"?P:z,[i]),f=t=>{u(t),y(t?M(t):"")},W=t=>{u(t)},E=t=>{if(!a)return t;const c=a.slice(-1);return/[0-9)]/.test(c)||a.endsWith("pi")||a.endsWith("Ans")||c==="!"?`*${t}`:t},$=t=>{if(t==="."&&m.includes("."))return;const p=t==="."&&(a===""||x(a.slice(-1))||a.endsWith("("))?"0.":t;if(j){f(p),d(p),b(!1);return}const v=/\)$/.test(a)||a.endsWith("pi")||a.endsWith("Ans")||a.endsWith("!")?"*":"";m==="0"&&t!=="."?d(t):x(a.slice(-1))||a.endsWith("(")?d(p):d(h=>t==="."&&h===""?"0.":h+t),f(a+v+p)},A=t=>{if(t==="clear"){f(""),d("0"),y(""),b(!1);return}if(t==="backspace"){if(!a)return;const c=H(a);if(f(c),c.endsWith("pi")){d("π");return}if(c.endsWith("Ans")){d("Ans");return}const p=c.match(/(\d+(?:\.\d+)?)(?!.*\d)/);d(p?p[1]:"0");return}if(t==="="){const c=a||m;try{const p=_(c),w=D(p),v=B(w,e,C),h=Y(v);d(h),y(`${M(c)} =`),W(h==="Error"?"":h),q(h==="Error"?C:v),b(!0)}catch{d("Error"),y(`${M(c)} =`),b(!0)}return}if(t==="angle"){r(c=>c==="rad"?"deg":"rad");return}if(t==="sqrt"||["sin","cos","tan","log","ln"].includes(t)){const c=t==="sqrt"?"sqrt(":`${t}(`,p=E(c);f(a+p),d(c),b(!1);return}if(t==="pi"){const c=E("pi");f(a+c),d("π"),b(!1);return}if(t==="Ans"){const c=E("Ans");f(a+c),d("Ans"),b(!1);return}if(t==="!"||t==="%"){f(a+t),b(!1);return}if(x(t)||t==="("||t===")"){if(j){f(m+t),b(!1);return}if(!a&&t!=="-")return;if(t==="("){const c=E("(");f(a+c);return}if(x(a.slice(-1))&&x(t)){f(a.slice(0,-1)+t);return}f(a+t);return}},R=t=>{if(t.kind==="digit"){$(t.value);return}if(t.kind==="equals"){A("=");return}if(t.kind==="toggle"){A("angle");return}A(t.value)};return s?o.jsx("div",{className:"scientific-calculator",ref:I,children:o.jsxs("div",{className:"calc-surface",children:[o.jsxs("div",{className:"calc-top",children:[o.jsxs("div",{className:"calc-tabs",children:[o.jsx("button",{className:`calc-tab ${i==="basic"?"is-active":""}`,onClick:()=>n("basic"),type:"button",children:l("widgets.scientific_calculator.basic")}),o.jsx("button",{className:`calc-tab ${i==="standard"?"is-active":""}`,onClick:()=>n("standard"),type:"button",children:l("widgets.scientific_calculator.standard")}),o.jsx("button",{className:`calc-tab ${i==="scientific"?"is-active":""}`,onClick:()=>n("scientific"),type:"button",children:l("widgets.scientific_calculator.scientific")})]}),o.jsx("div",{className:"calc-angle",children:i==="scientific"&&o.jsx("span",{className:"calc-angle-pill",children:e.toUpperCase()})})]}),o.jsxs("div",{className:"calc-display",children:[o.jsx("div",{className:"calc-expression",children:k||" "}),o.jsx("div",{className:"calc-result",children:m})]}),o.jsx("div",{className:`calc-grid calc-grid--${i}`,children:S.map((t,c)=>o.jsx("button",{type:"button",onClick:()=>R(t),className:`calc-key calc-key--${t.kind}`,style:t.span?{gridColumn:`span ${t.span} / span ${t.span}`}:void 0,children:t.kind==="toggle"?e.toUpperCase():t.label},`${t.label}-${c}`))})]})}):o.jsx("div",{className:"calc-loading",children:l("loading")})};export{J as ScientificCalculatorWidget,V as widgetConfig};
