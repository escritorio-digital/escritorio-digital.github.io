import{u as m,r as h,j as n,av as w,aw as b,ax as x,ay as v,az as j,aA as k,aB as C,aC as I,aD as L,Z as y,V as H}from"./react-vendor-WCYW3yxo.js";import{u as N,i as B,H as T,E}from"./tiptap-DhPrbXr2.js";import{T as R,d as U}from"./markdown-Cp29AwN3.js";import{u as z}from"./index-DEF43kZb.js";import{z as Z}from"./index-DEF43kZb.js";import"./vendor-DCW5Txpp.js";import"./dnd-kit-ZKKYBs6g.js";const S=({editor:e,onUpload:d,onDownload:c})=>{const{t}=m();if(!e)return null;const u=[{Icon:w,action:()=>e.chain().focus().toggleBold().run(),name:"bold",title:t("widgets.notepad.menubar.bold")},{Icon:b,action:()=>e.chain().focus().toggleItalic().run(),name:"italic",title:t("widgets.notepad.menubar.italic")},{Icon:x,action:()=>e.chain().focus().toggleStrike().run(),name:"strike",title:t("widgets.notepad.menubar.strike")},{Icon:v,action:()=>e.chain().focus().toggleBulletList().run(),name:"bulletList",title:t("widgets.notepad.menubar.bullet_list")},{Icon:j,action:()=>e.chain().focus().toggleOrderedList().run(),name:"orderedList",title:t("widgets.notepad.menubar.ordered_list")},{Icon:k,action:()=>e.chain().focus().setParagraph().run(),name:"paragraph",title:t("widgets.notepad.menubar.paragraph")},{Icon:C,action:()=>e.chain().focus().toggleHeading({level:1}).run(),name:"heading",level:1,title:t("widgets.notepad.menubar.h1")},{Icon:I,action:()=>e.chain().focus().toggleHeading({level:2}).run(),name:"heading",level:2,title:t("widgets.notepad.menubar.h2")},{Icon:L,action:()=>e.chain().focus().toggleHeading({level:3}).run(),name:"heading",level:3,title:t("widgets.notepad.menubar.h3")}];return n.jsxs("div",{className:"menubar flex items-center gap-1 p-2 bg-gray-100 border-b border-accent",children:[u.map(({Icon:o,action:g,name:r,title:a,level:s})=>n.jsx("button",{onClick:g,className:`p-2 rounded hover:bg-gray-200 ${e.isActive(r,s?{level:s}:void 0)?"is-active":""}`,title:a,children:n.jsx(o,{size:16})},r+(s||""))),n.jsx("div",{className:"flex-grow"}),n.jsx("button",{onClick:d,className:"p-2 rounded hover:bg-gray-200",title:t("widgets.notepad.menubar.upload"),children:n.jsx(y,{size:16})}),n.jsx("button",{onClick:c,className:"p-2 rounded hover:bg-gray-200",title:t("widgets.notepad.menubar.download"),children:n.jsx(H,{size:16})})]})},P=()=>{const{t:e}=m(),[d,c]=z("notepad-content-html",e("widgets.notepad.initial_content")),t=h.useRef(null),u=new R,o=N({extensions:[B.configure({heading:!1,codeBlock:!1}),T.configure({levels:[1,2,3]})],content:d,onUpdate:({editor:a})=>{c(a.getHTML())},editorProps:{attributes:{class:"prose dark:prose-invert max-w-none"}}}),g=()=>{if(!o)return;const a=o.getHTML(),s=u.turndown(a),l=new Blob([s],{type:"text/markdown;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=e("widgets.notepad.default_filename"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},r=a=>{const s=a.target.files?.[0];if(s&&o){const l=new FileReader;l.onload=async i=>{const p=i.target?.result,f=await U.parse(p);o.commands.setContent(f)},l.readAsText(s)}a.target&&(a.target.value="")};return n.jsxs("div",{className:"flex flex-col h-full w-full notepad-widget bg-white rounded-b-md overflow-hidden",children:[n.jsx(S,{editor:o,onUpload:()=>t.current?.click(),onDownload:g}),n.jsx(E,{editor:o,className:"flex-grow overflow-auto"}),n.jsx("input",{type:"file",ref:t,onChange:r,accept:".md,.txt",className:"hidden"})]})};export{P as NotepadWidget,Z as widgetConfig};
