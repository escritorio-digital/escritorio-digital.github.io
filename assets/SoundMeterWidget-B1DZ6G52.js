import{c as A,u as q,r as n,e as I,j as e,W as U}from"./index-Cktkj3Mh.js";import{aG as J}from"./index-Cktkj3Mh.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],R=A("mic-off",W);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],C=A("mic",G),O={silence:{labelKey:"widgets.sound_meter.silence",emoji:"ðŸ¤«",className:"level-silence"},conversation:{labelKey:"widgets.sound_meter.conversation",emoji:"ðŸ—£ï¸",className:"level-conversation"},noise:{labelKey:"widgets.sound_meter.noise",emoji:"ðŸ’¥",className:"level-noise"}},B=()=>{const{t:s}=q(),[S,L]=n.useState("silence"),[x,l]=n.useState("prompt"),[a,u]=n.useState(!1),[c,z]=I("sound-meter-sensitivity",50),o=n.useRef(null),m=n.useRef(null),f=n.useRef(0),h=n.useRef("silence"),p=n.useRef(0),v=n.useRef(void 0),F=t=>{const i=30+(80-c),r=Math.max(6,i*.4);return t<r?"silence":t<i?"conversation":"noise"},T=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert(s("widgets.sound_meter.no_audio_support")),l("denied");return}const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});m.current=t;const i=window.AudioContext||window.webkitAudioContext;o.current=new i;const r=o.current.createAnalyser();r.fftSize=1024,r.smoothingTimeConstant=.85,o.current.createMediaStreamSource(t).connect(r),l("granted"),u(!0);const d=new Uint8Array(r.fftSize),_=()=>{r.getByteTimeDomainData(d);let w=0;for(let g=0;g<d.length;g+=1){const k=(d[g]-128)/128;w+=k*k}const E=Math.sqrt(w/d.length),K=.7+c/100*.9,V=Math.min(100,E*120*K),M=f.current*.85+V*.15;f.current=M;const N=F(M),b=Date.now();N!==h.current&&b-p.current>700&&(h.current=N,p.current=b),L(h.current),v.current=requestAnimationFrame(_)};_()}catch(t){console.error(s("widgets.sound_meter.microphone_error"),t),l("denied"),u(!1)}},y=()=>{v.current&&cancelAnimationFrame(v.current),m.current&&m.current.getTracks().forEach(t=>t.stop()),o.current&&o.current.state!=="closed"&&o.current.close(),u(!1)};n.useEffect(()=>()=>y(),[]);const D=()=>{if(x==="granted"){const t=a?S:"silence",{labelKey:i,emoji:r,className:j}=O[t];return e.jsxs("div",{className:`level-card ${j}`,children:[e.jsx("span",{className:"emoji",children:r}),e.jsx("span",{className:"label",children:s(i)})]})}return e.jsx("div",{className:"permission-screen",children:x==="denied"?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:48,className:"text-red-500"}),e.jsx("p",{children:s("widgets.sound_meter.access_denied")}),e.jsx("small",{children:s("widgets.sound_meter.enable_browser_settings")})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:48}),e.jsx("p",{children:s("widgets.sound_meter.permission_needed")})]})})};return e.jsxs("div",{className:"sound-meter-widget",children:[e.jsxs(U,{children:[e.jsxs("button",{type:"button",onClick:()=>a?y():T(),className:"sound-meter-toggle",title:s(a?"widgets.sound_meter.deactivate_meter":"widgets.sound_meter.activate_meter"),children:[a?e.jsx(R,{size:18}):e.jsx(C,{size:18}),e.jsx("span",{children:s(a?"widgets.sound_meter.deactivate_meter":"widgets.sound_meter.activate_meter")})]}),e.jsxs("div",{className:"sound-meter-threshold",children:[e.jsx("label",{htmlFor:"sound-meter-threshold",children:s("widgets.sound_meter.sensitivity_label")}),e.jsx("input",{id:"sound-meter-threshold",type:"range",min:"0",max:"100",value:c,onChange:t=>z(Number(t.target.value))}),e.jsx("span",{className:"sound-meter-threshold-value",children:c})]})]}),D()]})};export{B as SoundMeterWidget,J as widgetConfig};
