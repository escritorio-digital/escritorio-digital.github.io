import{c as S,u as T,a as M,r as b,j as t,s as R,U as O,b as U,D as I,g as y}from"./index-5fVle3rd.js";import{w as oe}from"./index-5fVle3rd.js";import{P as _}from"./papaparse.min-D3Bm17hG.js";import{r as K,s as P,d as q}from"./saveDialog-Nl8YbZ8T.js";import{r as W}from"./openDialog-H-OCpcqq.js";import{U as V}from"./user-plus-2Op5qk2D.js";import{R as G}from"./rotate-ccw-CGyIo7C8.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]],Z=S("badge",Y);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],J=S("triangle-alert",H),Q=n=>{const g=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${g}-${o}-${u}`},ie=()=>{const{t:n,ready:g}=T(),[o,u]=M("attendance-records",{}),[k,C]=b.useState(()=>new Date),[m,h]=b.useState("attendance"),[w,f]=b.useState(""),A=[{id:1,icon:"â­",description:n("widgets.attendance.badges.excellent_work")},{id:2,icon:"ðŸ‘",description:n("widgets.attendance.badges.good_participation")},{id:3,icon:"ðŸŽ¯",description:n("widgets.attendance.badges.goal_achieved")},{id:4,icon:"ðŸ¤",description:n("widgets.attendance.badges.helps_classmates")}],D=[{id:1,icon:"ðŸ’¬",description:n("widgets.attendance.alerts.talks_in_class")},{id:2,icon:"ðŸ˜´",description:n("widgets.attendance.alerts.doesnt_work")},{id:3,icon:"ðŸ˜ ",description:n("widgets.attendance.alerts.bad_behavior")},{id:4,icon:"âœï¸",description:n("widgets.attendance.alerts.incomplete_homework")}];if(!g)return t.jsx("div",{className:"flex items-center justify-center h-full",children:n("loading")});const p=Q(k),v=()=>{if(o[p])return o[p];const e=Object.keys(o).sort().pop();return e?o[e].map(({id:s,name:i})=>({id:s,name:i,status:"absent",badges:[],alerts:[]})):[]},r=v(),l=e=>{u(s=>({...s,[p]:e}))},N=()=>{if(w.trim()==="")return;const e={id:Date.now(),name:w.trim(),status:"absent",badges:[],alerts:[]},s=v();l([...s,e]),f("")},x=(e,s)=>{const i=r.map(a=>a.id===e?{...a,status:s}:a);l(i)},E=(e,s)=>{const i=r.map(a=>{if(a.id!==e)return a;const c=a.badges.includes(s)?a.badges.filter(d=>d!==s):[...a.badges,s];return{...a,badges:c}});l(i)},F=(e,s)=>{const i=r.map(a=>{if(a.id!==e)return a;const c=a.alerts.includes(s)?a.alerts.filter(d=>d!==s):[...a.alerts,s];return{...a,alerts:c}});l(i)},j=e=>{_.parse(e,{header:!0,skipEmptyLines:!0,complete:s=>{const i=s.data.map(a=>({id:Number(a.id)||Date.now()+Math.random(),name:String(a.name||n("widgets.attendance.no_name")),status:"absent",badges:[],alerts:[]}));l(i)}})},L=async()=>{const e=await W({accept:".csv"});if(!e)return;if(e.source==="local"){const[c]=e.files;c&&j(c);return}const[s]=e.entryIds;if(!s)return;const i=await y(s);if(!i?.blob)return;const a=new File([i.blob],i.name,{type:i.mime||i.blob.type});j(a)};b.useEffect(()=>R("attendance",async({entryId:s})=>{const i=await y(s);if(!i?.blob)return;const a=new File([i.blob],i.name,{type:i.mime||i.blob.type});j(a)}),[]);const $=async()=>{const e=[];Object.keys(o).sort().forEach(c=>{o[c].forEach(d=>{e.push({date:c,id:d.id,name:d.name,status:d.status,badges:d.badges.join(";"),alerts:d.alerts.join(";")})})});const s=_.unparse(e),i=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),a=await K("asistencia_completa.csv");if(a?.destination==="file-manager"){await P({blob:i,filename:a.filename,sourceWidgetId:"attendance",sourceWidgetTitleKey:"widgets.attendance.title",parentId:a.parentId});return}a?.destination==="download"&&q(i,a.filename)},z=()=>{window.confirm(n("widgets.attendance.reset_confirm"))&&u({})},B=e=>{switch(m){case"attendance":return t.jsxs("div",{className:"controls attendance-controls",children:[t.jsx("button",{onClick:()=>x(e.id,"present"),className:`status-btn present ${e.status==="present"?"active":""}`,children:n("widgets.attendance.present")}),t.jsx("button",{onClick:()=>x(e.id,"absent"),className:`status-btn absent ${e.status==="absent"?"active":""}`,children:n("widgets.attendance.absent")}),t.jsx("button",{onClick:()=>x(e.id,"late"),className:`status-btn late ${e.status==="late"?"active":""}`,children:n("widgets.attendance.late")})]});case"badges":return t.jsx("div",{className:"controls badge-controls",children:A.map(s=>t.jsx("button",{title:s.description,onClick:()=>E(e.id,s.id),className:`badge-btn ${e.badges.includes(s.id)?"active":""}`,children:s.icon},s.id))});case"alerts":return t.jsx("div",{className:"controls alert-controls",children:D.map(s=>t.jsx("button",{title:s.description,onClick:()=>F(e.id,s.id),className:`alert-btn ${e.alerts.includes(s.id)?"active":""}`,children:s.icon},s.id))})}};return t.jsxs("div",{className:"attendance-widget",children:[t.jsxs("div",{className:"date-controls",children:[t.jsx("label",{htmlFor:"attendance-date",children:n("widgets.attendance.date")}),t.jsx("input",{type:"date",id:"attendance-date",value:p,onChange:e=>{const[s,i,a]=e.target.value.split("-").map(Number);C(new Date(s,i-1,a))}})]}),t.jsxs("div",{className:"main-content",children:[t.jsxs("div",{className:"tabs",children:[t.jsxs("button",{onClick:()=>h("attendance"),className:m==="attendance"?"active":"",children:[t.jsx(O,{size:16})," ",n("widgets.attendance.attendance_tab")]}),t.jsxs("button",{onClick:()=>h("badges"),className:m==="badges"?"active":"",children:[t.jsx(Z,{size:16})," ",n("widgets.attendance.badges_tab")]}),t.jsxs("button",{onClick:()=>h("alerts"),className:m==="alerts"?"active":"",children:[t.jsx(J,{size:16})," ",n("widgets.attendance.alerts_tab")]})]}),t.jsx("div",{className:"content-area",children:r.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("p",{children:n("widgets.attendance.no_students_message")}),t.jsx("p",{className:"text-sm",children:n("widgets.attendance.add_students_instruction")})]}):t.jsx("ul",{className:"student-list",children:r.map(e=>t.jsxs("li",{className:"student-item",children:[t.jsx("span",{className:"student-name",children:e.name}),B(e)]},e.id))})})]}),t.jsxs("div",{className:"footer",children:[t.jsxs("div",{className:"add-student-form",children:[t.jsx("input",{type:"text",value:w,onChange:e=>f(e.target.value),placeholder:n("widgets.attendance.new_student_placeholder"),onKeyPress:e=>e.key==="Enter"&&N()}),t.jsx("button",{onClick:N,children:t.jsx(V,{size:16})})]}),t.jsxs("div",{className:"actions-group",children:[t.jsx("button",{onClick:L,className:"action-btn",title:n("widgets.attendance.import_csv_tooltip"),children:t.jsx(U,{size:16})}),t.jsx("button",{onClick:$,className:"action-btn",title:n("widgets.attendance.export_records_tooltip"),children:t.jsx(I,{size:16})}),t.jsx("button",{onClick:z,className:"action-btn danger",title:n("widgets.attendance.delete_all_tooltip"),children:t.jsx(G,{size:16})})]})]})]})};export{ie as AttendanceWidget,oe as widgetConfig};
