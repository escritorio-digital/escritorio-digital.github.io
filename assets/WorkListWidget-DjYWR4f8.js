import{c as C,u as E,a as S,r,s as F,j as i,b as I,D,al as L,g as h}from"./index-DVJj0eXH.js";import{ax as R}from"./index-DVJj0eXH.js";import{P as y}from"./papaparse.min-Br2UhxnO.js";import{r as z,s as P,d as W}from"./saveDialog-B1B6LgzW.js";import{r as q}from"./openDialog-H-OCpcqq.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],B=C("square-pen",M),$=()=>{const{t:a,ready:x}=E(),[n,l]=S("work-list-tasks",[]),[u,g]=r.useState(""),[c,m]=r.useState(null),[p,w]=r.useState(""),_=e=>{e.key==="Enter"&&u.trim()!==""&&(l([...n,{id:Date.now(),text:u.trim(),completed:!1}]),g(""))},j=e=>{l(n.map(t=>t.id===e?{...t,completed:!t.completed}:t))},f=e=>{l(n.filter(t=>t.id!==e))},k=e=>{m(e.id),w(e.text)},v=e=>{e.key==="Enter"&&c!==null&&(p.trim()===""?f(c):l(n.map(t=>t.id===c?{...t,text:p.trim()}:t)),m(null),w(""))},N=async()=>{const e=y.unparse(n.map(o=>({id:o.id,text:o.text,completed:o.completed}))),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=await z("lista_de_trabajo.csv");if(s?.destination==="file-manager"){await P({blob:t,filename:s.filename,sourceWidgetId:"work-list",sourceWidgetTitleKey:"widgets.work_list.title",parentId:s.parentId});return}s?.destination==="download"&&W(t,s.filename)},d=r.useCallback(e=>{y.parse(e,{header:!0,skipEmptyLines:!0,complete:t=>{const s=t.data.map(o=>({id:Number(o.id)||Date.now()+Math.random(),text:String(o.text||""),completed:String(o.completed).toLowerCase()==="true"})).filter(o=>o.text);window.confirm(a("widgets.work_list.replace_list_confirm"))?l(s):l(o=>[...o,...s])},error:t=>{console.error("Error al parsear el CSV:",t),alert(a("widgets.work_list.csv_error"))}})},[l,a]),T=async()=>{const e=await q({accept:".csv"});if(!e)return;if(e.source==="local"){const[b]=e.files;b&&d(b);return}const[t]=e.entryIds;if(!t)return;const s=await h(t);if(!s?.blob)return;const o=new File([s.blob],s.name,{type:s.mime||s.blob.type});d(o)};return r.useEffect(()=>F("work-list",async({entryId:t})=>{const s=await h(t);if(!s?.blob)return;const o=new File([s.blob],s.name,{type:s.mime||s.blob.type});d(o)}),[d]),console.log("WorkList translations:",{ready:x,placeholder:a("widgets.work_list.add_task_placeholder"),title:a("widgets.work_list.title")}),x?i.jsxs("div",{className:"work-list-widget",children:[i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("input",{type:"text",className:"work-list-input",placeholder:a("widgets.work_list.add_task_placeholder"),value:u,onChange:e=>g(e.target.value),onKeyPress:_}),i.jsx("button",{onClick:T,className:"work-list-icon-button",title:a("widgets.work_list.load_csv"),children:i.jsx(I,{size:20})}),i.jsx("button",{onClick:N,className:"work-list-icon-button",title:a("widgets.work_list.download_csv"),children:i.jsx(D,{size:20})})]}),i.jsx("ul",{className:"work-list-items",children:n.map(e=>i.jsxs("li",{className:`work-list-item ${e.completed?"opacity-50":""}`,children:[i.jsx("input",{type:"checkbox",className:"work-list-checkbox",checked:e.completed,onChange:()=>j(e.id)}),c===e.id?i.jsx("input",{type:"text",value:p,onChange:t=>w(t.target.value),onKeyPress:v,onBlur:()=>m(null),className:"work-list-edit-input",autoFocus:!0}):i.jsx("span",{className:`flex-grow cursor-pointer ${e.completed?"line-through":""}`,onDoubleClick:()=>k(e),children:e.text}),i.jsx("button",{onClick:()=>k(e),className:"work-list-action",children:i.jsx(B,{size:16})}),i.jsx("button",{onClick:()=>f(e.id),className:"work-list-action delete",children:i.jsx(L,{size:16})})]},e.id))}),i.jsx("p",{className:"work-list-hint",children:a("widgets.work_list.double_click_edit")})]}):i.jsx("div",{className:"flex items-center justify-center h-full",children:a("loading")})};export{$ as WorkListWidget,R as widgetConfig};
