import{u as ie,r as o,s as le,j as t,F as de,Y as K,Z as ue,g as U}from"./index-DB1LVOJU.js";import{_ as Ce}from"./index-DB1LVOJU.js";import{r as ce,s as ge,d as pe}from"./saveDialog-DItMqXCA.js";import{r as me}from"./openDialog-H-OCpcqq.js";const he=c=>c==="byCount"||c==="bySize",fe=c=>Array.isArray(c)&&c.every(r=>Array.isArray(r)&&r.every(S=>typeof S=="string")),we=c=>{try{const r=JSON.parse(c);return!r||typeof r!="object"||r.version!==1||typeof r.studentList!="string"||!he(r.mode)||typeof r.groupValue!="number"||!Number.isFinite(r.groupValue)||!fe(r.generatedGroups)?null:{version:1,studentList:r.studentList,generatedGroups:r.generatedGroups,mode:r.mode,groupValue:r.groupValue}}catch{return null}},be=({instanceId:c})=>{const{t:r}=ie(),S=o.useRef(c??`group-generator-${Date.now()}-${Math.random().toString(16).slice(2)}`),l=c??S.current,[p,N]=o.useState(`Ana
Beatriz
Carlos
Daniela
Esteban
Fernanda
Gael
Hilda
IvÃ¡n
Julia`),[g,E]=o.useState("byCount"),[u,T]=o.useState(3),[i,x]=o.useState([]),[m,I]=o.useState(!1),[Y,z]=o.useState(!1),[M,h]=o.useState(""),[Z,G]=o.useState(null),L=o.useRef(null),R=o.useRef(null),H=o.useRef(null),A=o.useRef({titleSize:0,textSize:0,minCardWidth:0,containerHeight:0}),$=o.useCallback(e=>{N(e.studentList),x(e.generatedGroups),E(e.mode),T(Math.max(1,Math.floor(e.groupValue))),h(JSON.stringify(e))},[]),J=o.useCallback(e=>{const n=we(e);if(n){$(n);return}N(e),x([]),h(JSON.stringify({version:1,studentList:e,generatedGroups:[],mode:g,groupValue:u}))},[$,u,g]),y=o.useCallback(async(e,n)=>{const s=await e.text();J(s);const a=n?.trim();a&&window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:a}})),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),a&&G(a)},[J,l]);o.useEffect(()=>{if(!m)return;const e=L.current,n=R.current,s=H.current;if(!e||!n||!s)return;let a=0;const d=()=>{if(!e||!n||!s)return;const b=getComputedStyle(e),te=parseFloat(b.paddingTop)||0,ne=parseFloat(b.paddingBottom)||0,se=parseFloat(b.rowGap||b.gap)||0,_=Math.max(120,e.clientHeight-n.offsetHeight-te-ne-se);s.style.height=`${_}px`;const D=s.clientWidth,re=Math.max(1,i.length),ae=Math.min(re,Math.max(1,Math.floor(D/320))),j=Math.max(240,Math.floor(D/ae)-16),P=16,oe=Math.min(40,Math.max(20,Math.floor(_/5)));let W=P,B=oe,f=P;for(let q=0;q<12;q+=1){const w=Math.floor((W+B)/2);e.style.setProperty("--group-text-size",`${w}px`),e.style.setProperty("--group-title-size",`${Math.round(w*1.2)}px`),e.style.setProperty("--group-card-min",`${j}px`),s.scrollHeight<=s.clientHeight?(f=w,W=w+1):B=w-1}const O=Math.round(f*1.2),C=A.current;(C.textSize!==f||C.titleSize!==O||C.minCardWidth!==j||C.containerHeight!==_)&&(A.current={textSize:f,titleSize:O,minCardWidth:j,containerHeight:_},e.style.setProperty("--group-text-size",`${f}px`),e.style.setProperty("--group-title-size",`${O}px`),e.style.setProperty("--group-card-min",`${j}px`))},v=()=>{cancelAnimationFrame(a),a=requestAnimationFrame(d)};v();const k=new ResizeObserver(v);return k.observe(e),k.observe(s),()=>{cancelAnimationFrame(a),k.disconnect()}},[m,i]);const Q=async()=>{const e=await me({accept:".txt"});if(!e)return;if(e.source==="local"){const[a]=e.files;a&&await y(a,a.name);return}const[n]=e.entryIds;if(!n)return;const s=await U(n);s?.blob&&await y(s.blob,s.name)};o.useEffect(()=>le("group-generator",async({entryId:n})=>{const s=await U(n);s?.blob&&await y(s.blob,s.name)}),[y]);const X=()=>{const e=p.split(`
`).map(a=>a.trim()).filter(a=>a);if(e.length===0||u<=0){x([]);return}const n=[...e].sort(()=>Math.random()-.5),s=[];if(g==="byCount"){const a=Math.max(1,Math.min(u,e.length));for(let d=0;d<a;d++)s.push([]);n.forEach((d,v)=>{s[v%a].push(d)})}else{const a=Math.max(1,u);for(let d=0;d<n.length;d+=a)s.push(n.slice(d,d+a))}x(s)},V=()=>i.map((e,n)=>{const s=r("widgets.group_generator.group_title",{number:n+1}),a=e.map(d=>`- ${d}`);return[s,...a].join(`
`)}).join(`

`),ee=async()=>{if(i.length===0)return;const e=V();try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}z(!0),window.setTimeout(()=>z(!1),1500)}catch{z(!1)}},F=async()=>{if(i.length===0)return;const e=await ce(Z||"grupos.txt");if(e){if(e?.destination==="file-manager"){const n={version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u},s=new Blob([JSON.stringify(n,null,2)],{type:"application/json;charset=utf-8"});await ge({blob:s,filename:e.filename,sourceWidgetId:"group-generator",sourceWidgetTitleKey:"widgets.group_generator.title",parentId:e.parentId}),h(JSON.stringify(n)),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:e.filename}})),G(e.filename),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}));return}if(e?.destination==="download"){const n=V(),s=new Blob([n],{type:"text/plain;charset=utf-8"});pe(s,e.filename),h(JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u})),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:l,title:e.filename}})),G(e.filename),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}})),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:l,widgetId:"group-generator"}}))}}};return o.useEffect(()=>{if(!M){const s=JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u});h(s);return}const n=JSON.stringify({version:1,studentList:p,generatedGroups:i,mode:g,groupValue:u})!==M;window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:n}}))},[i,u,M,g,l,p]),o.useEffect(()=>{const e=n=>{const s=n;s.detail?.instanceId===l&&(s.detail?.widgetId&&s.detail.widgetId!=="group-generator"||F())};return window.addEventListener("widget-save-request",e),()=>window.removeEventListener("widget-save-request",e)},[F,l]),o.useEffect(()=>()=>{window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:l,widgetId:"group-generator",isDirty:!1}}))},[l]),t.jsxs("div",{className:"group-generator-widget",children:[t.jsxs("div",{className:"input-panel",children:[t.jsx("label",{className:"panel-label",children:r("widgets.group_generator.student_list_label")}),t.jsx("textarea",{value:p,onChange:e=>N(e.target.value),placeholder:r("widgets.group_generator.placeholder")}),t.jsxs("button",{onClick:Q,className:"upload-button",children:[t.jsx(de,{size:16})," ",r("widgets.group_generator.load_from_file")]})]}),t.jsxs("div",{className:"controls-panel",children:[t.jsxs("div",{className:"mode-selection",children:[t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:g==="byCount",onChange:()=>E("byCount")}),r("widgets.group_generator.number_of_groups")]}),t.jsxs("label",{children:[t.jsx("input",{type:"radio",name:"mode",checked:g==="bySize",onChange:()=>E("bySize")}),r("widgets.group_generator.students_per_group")]})]}),t.jsx("input",{type:"number",value:u,onChange:e=>T(Math.max(1,parseInt(e.target.value)||1)),className:"group-value-input",min:"1"}),t.jsx("button",{onClick:X,className:"generate-button",children:r("widgets.group_generator.generate_groups")})]}),t.jsxs("div",{className:"output-panel",children:[t.jsxs("div",{className:"output-header",children:[t.jsx("label",{className:"panel-label",children:r("widgets.group_generator.generated_groups_label")}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"expand-button",onClick:ee,disabled:i.length===0,title:r("widgets.group_generator.copy_groups"),children:t.jsx("span",{children:r(Y?"widgets.group_generator.copied":"widgets.group_generator.copy_groups")})}),t.jsx("button",{className:"expand-button",onClick:F,disabled:i.length===0,title:r("widgets.group_generator.download_groups"),children:t.jsx("span",{children:r("widgets.group_generator.download_groups")})}),t.jsxs("button",{className:"expand-button",onClick:()=>I(!m),disabled:i.length===0,children:[m?t.jsx(K,{size:16}):t.jsx(ue,{size:16}),t.jsx("span",{children:r(m?"widgets.group_generator.close_large_view":"widgets.group_generator.view_large")})]})]})]}),t.jsx("div",{className:"groups-container",children:i.length>0?i.map((e,n)=>t.jsxs("div",{className:"group-card",children:[t.jsx("h4",{className:"group-title",children:r("widgets.group_generator.group_title",{number:n+1})}),t.jsx("ul",{children:e.map(s=>t.jsx("li",{children:s},s))})]},n)):t.jsx("p",{className:"no-groups-message",children:r("widgets.group_generator.no_groups_message")})})]}),m&&t.jsx("div",{className:"groups-overlay",onClick:()=>I(!1),children:t.jsxs("div",{className:"groups-overlay-content",ref:L,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"groups-overlay-header",ref:R,children:[t.jsx("h3",{children:r("widgets.group_generator.generated_groups_label")}),t.jsxs("button",{className:"expand-button",onClick:()=>I(!1),children:[t.jsx(K,{size:16}),t.jsx("span",{children:r("widgets.group_generator.close_large_view")})]})]}),t.jsx("div",{className:"groups-container groups-container-large",ref:H,children:i.length>0?i.map((e,n)=>t.jsxs("div",{className:"group-card group-card-large",children:[t.jsx("h4",{className:"group-title",children:r("widgets.group_generator.group_title",{number:n+1})}),t.jsx("ul",{children:e.map(s=>t.jsx("li",{children:s},s))})]},n)):t.jsx("p",{className:"no-groups-message",children:r("widgets.group_generator.no_groups_message")})})]})})]})};export{be as GroupGeneratorWidget,Ce as widgetConfig};
