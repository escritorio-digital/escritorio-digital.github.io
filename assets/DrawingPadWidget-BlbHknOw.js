import{c as _,u as Ye,r as i,s as De,j as r,p as Be,T as Ee,g as fe}from"./index-8xu0GoH7.js";import{q as vt}from"./index-8xu0GoH7.js";import{r as Oe,s as Le,d as We}from"./saveDialog-CLnhSCrJ.js";import{r as qe}from"./openDialog-H-OCpcqq.js";import{C as Fe}from"./circle-ZzPNZObj.js";import{S as He}from"./save-CTLuZo8M.js";import{R as Ae}from"./rotate-ccw-CiU-_Fdl.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Je=_("arrow-right",Ke);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Ve=_("chart-line",Ue);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Qe=_("eraser",Ge);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]],et=_("highlighter",Ze);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],nt=_("move",tt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]],st=_("paintbrush",at);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],it=_("pen",rt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M3 3h.01",key:"159qn6"}],["path",{d:"M7 5h.01",key:"1hq22a"}],["path",{d:"M11 7h.01",key:"1osv80"}],["path",{d:"M3 7h.01",key:"1xzrh3"}],["path",{d:"M7 9h.01",key:"19b3jx"}],["path",{d:"M3 11h.01",key:"1eifu7"}],["rect",{width:"4",height:"4",x:"15",y:"5",key:"mri9e4"}],["path",{d:"m19 9 2 2v10c0 .6-.4 1-1 1h-6c-.6 0-1-.4-1-1V11l2-2",key:"aib6hk"}],["path",{d:"m13 14 8-2",key:"1d7bmk"}],["path",{d:"m13 19 8-2",key:"1y2vml"}]],ct=_("spray-can",ot);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],lt=_("square",dt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],ut=_("type",ht),bt=()=>{const{t:h}=Ye(),p=i.useRef(null),f=i.useRef(null),[ee,W]=i.useState(!1),[R,me]=i.useState("#000000"),[j,xe]=i.useState(5),[T,te]=i.useState("draw"),[u,I]=i.useState("pencil"),[m,ne]=i.useState(null),[y,be]=i.useState(0),[k,ye]=i.useState(0),[z,X]=i.useState(null),[ae,q]=i.useState(!1),[F,Y]=i.useState(""),[se,ke]=i.useState(0),[re,ve]=i.useState(0),ie=i.useRef(null),[H,Ce]=i.useState(!0),[M,A]=i.useState({x:0,y:0}),[v,Me]=i.useState(!1),C=i.useRef(null),[K,J]=i.useState(!1),D=i.useRef(typeof window<"u"&&window.devicePixelRatio||1),B=i.useRef(M),U=i.useRef(K);B.current=M,U.current=K;const b=i.useCallback(()=>{H&&Ce(!1)},[H]),[$,N]=i.useState(null),E=i.useCallback((t,e)=>{if(!p.current||!C.current)return;const a=p.current,n=C.current,s=a.getContext("2d");if(s){s.clearRect(0,0,a.width,a.height);const o=D.current||1,c=Math.max(0,Math.round(t*o)),d=Math.max(0,Math.round(e*o)),g=Math.min(a.width,n.width-c),l=Math.min(a.height,n.height-d);g>0&&l>0&&s.drawImage(n,c,d,g,l,0,0,g,l)}},[]),_e=i.useCallback(()=>{A({x:0,y:0}),E(0,0)},[E]),je=i.useCallback(()=>{Me(!v),v||N(null)},[v]),V=i.useCallback(()=>(C.current||(C.current=document.createElement("canvas")),C.current),[]),O=i.useCallback(()=>{const t=p.current;if(!t)return;const e=V(),a=B.current,n=D.current||1,s=Math.max(t.width+Math.abs(Math.round(a.x*n)),e.width||0),o=Math.max(t.height+Math.abs(Math.round(a.y*n)),e.height||0);if(e.width<s||e.height<o){const d=document.createElement("canvas");d.width=s,d.height=o;const g=d.getContext("2d");if(g){U.current&&e.width>0&&e.height>0&&g.drawImage(e,0,0),e.width=s,e.height=o;const l=e.getContext("2d");l&&(l.clearRect(0,0,s,o),l.drawImage(d,0,0))}}const c=e.getContext("2d");if(c){const d=Math.max(0,Math.round(a.x*n)),g=Math.max(0,Math.round(a.y*n));c.drawImage(t,0,0,t.width,t.height,d,g,t.width,t.height)}J(!0)},[V]),oe=i.useCallback(t=>{const e=p.current;if(!e)return{x:0,y:0};const a=e.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}},[]),ce=i.useCallback(t=>{const e=p.current;if(!e)return{x:0,y:0};const a=e.getBoundingClientRect(),n=e.width/a.width,s=e.height/a.height;return{x:(t.clientX-a.left)*n+M.x*n,y:(t.clientY-a.top)*s+M.y*s}},[M]),Ie=i.useCallback(t=>{const e=p.current;if(!e)return{x:0,y:0};const a=e.getBoundingClientRect(),n=e.width/a.width,s=e.height/a.height;return{x:(t.clientX-a.left)*n+M.x*n,y:(t.clientY-a.top)*s+M.y*s}},[M]),de=i.useCallback((t=!1)=>{const e=p.current,a=f.current;if(!e||!a)return;let n=null;if(t&&(n=a.getImageData(0,0,e.width,e.height)),t||a.clearRect(0,0,e.width,e.height),m){const s=e.width/m.width,o=e.height/m.height,c=Math.min(s,o),d=(e.width-m.width*c)/2,g=(e.height-m.height*c)/2;if(t&&n){const l=document.createElement("canvas");l.width=e.width,l.height=e.height;const x=l.getContext("2d");x&&(x.drawImage(m,0,0,m.width,m.height,d,g,m.width*c,m.height*c),x.putImageData(n,0,0),a.clearRect(0,0,e.width,e.height),a.drawImage(l,0,0))}else a.drawImage(m,0,0,m.width,m.height,d,g,m.width*c,m.height*c)}else t&&n&&a.putImageData(n,0,0)},[m]);i.useEffect(()=>{const t=p.current;if(!t)return;const e=()=>{const s=t.offsetWidth,o=t.offsetHeight,c=(typeof window<"u"?window.devicePixelRatio:1)||1;if(D.current=c,s<=0||o<=0)return;const d=Math.round(s*c),g=Math.round(o*c);if(t.width!==d||t.height!==g){const l=B.current,x=Math.max(0,Math.round(l.x*c)),S=Math.max(0,Math.round(l.y*c)),w=V();((we,pe)=>{if(w.width>=we&&w.height>=pe)return;const P=document.createElement("canvas");P.width=Math.max(we,w.width),P.height=Math.max(pe,w.height);const Q=P.getContext("2d");Q&&w.width>0&&w.height>0&&Q.drawImage(w,0,0),w.width=P.width,w.height=P.height;const Z=w.getContext("2d");Z&&Q&&(Z.clearRect(0,0,w.width,w.height),Z.drawImage(P,0,0))})(x+t.width,S+t.height);const L=w.getContext("2d");L&&t.width>0&&t.height>0&&(L.drawImage(t,0,0,t.width,t.height,x,S,t.width,t.height),U.current=!0,J(!0)),t.width=d,t.height=g,f.current=t.getContext("2d"),E(l.x,l.y)}},a=t.getContext("2d");if(!a)return;f.current=a,e();const n=new ResizeObserver(()=>{e()});return n.observe(t.parentElement||t),window.addEventListener("resize",e),()=>{n.disconnect(),window.removeEventListener("resize",e)}},[]),i.useEffect(()=>{f.current&&(f.current.globalCompositeOperation=T==="draw"?"source-over":"destination-out")},[T]);const Ne=t=>{if(b(),v){const n=oe(t);N(n);return}if(u==="text"&&ae||!f.current||!p.current)return;const{x:e,y:a}=ce(t);u==="text"?(q(!0),ke(e),ve(a),Y(""),X(f.current.getImageData(0,0,p.current.width,p.current.height)),setTimeout(()=>ie.current?.focus(),0)):["line","rectangle","circle","arrow"].includes(u)?(be(e),ye(a),X(f.current.getImageData(0,0,p.current.width,p.current.height))):(f.current.beginPath(),f.current.moveTo(e,a)),W(!0)},le=(t,e,a,n,s)=>{t.save(),t.beginPath(),t.translate(e,a),t.rotate(n),t.moveTo(0,0),t.lineTo(-s,-s/2),t.lineTo(-s,s/2),t.closePath(),t.fill(),t.restore()},Se=t=>{if(v&&$){const s=oe(t),o=s.x-$.x,c=s.y-$.y;if(K&&C.current){const l=C.current.getContext("2d"),x=p.current;if(l&&x){const S=B.current,w=D.current||1,ge=Math.max(0,Math.round(S.x*w)),L=Math.max(0,Math.round(S.y*w));l.drawImage(x,0,0,x.width,x.height,ge,L,x.width,x.height)}}const d={x:M.x-o,y:M.y-c};A(d),E(d.x,d.y),N(s);return}if(!ee||!f.current)return;const{x:e,y:a}=ce(t),n=f.current;if(n.lineWidth=j,n.strokeStyle=R,n.fillStyle=R,z&&["line","rectangle","circle","arrow"].includes(u)){n.putImageData(z,0,0);const s=e-y,o=a-k;switch(u){case"line":n.beginPath(),n.moveTo(y,k),n.lineTo(e,a),n.stroke();break;case"rectangle":n.strokeRect(y,k,s,o);break;case"circle":const c=(y+e)/2,d=(k+a)/2,g=Math.abs(s/2),l=Math.abs(o/2);n.beginPath(),n.ellipse(c,d,g,l,0,0,2*Math.PI),n.stroke();break;case"arrow":n.beginPath(),n.moveTo(y,k),n.lineTo(e,a),n.stroke();const x=Math.atan2(a-k,e-y);le(n,e,a,x,j*4);break}}else if(u!=="text"){switch(u){case"pencil":n.lineCap="round",n.lineJoin="round",n.lineTo(e,a),n.stroke();break;case"marker":n.lineCap="square",n.lineJoin="miter",n.lineTo(e,a),n.stroke();break;case"spray":for(let s=0;s<15;s++){const o=Math.random()*2*Math.PI,c=Math.random()*j,d=e+c*Math.cos(o),g=a+c*Math.sin(o);n.fillRect(d,g,1,1)}break}n.beginPath(),n.moveTo(e,a)}},he=t=>{if(v){N(null);return}if(!f.current)return;const e=f.current,{x:a,y:n}=Ie(t);let s=a,o=n;if(["line","rectangle","circle","arrow"].includes(u)&&(isNaN(a)||isNaN(n))&&(s=y,o=k),z&&["line","rectangle","circle","arrow"].includes(u)){e.putImageData(z,0,0);const c=s-y,d=o-k;switch(u){case"line":e.beginPath(),e.moveTo(y,k),e.lineTo(s,o),e.stroke();break;case"rectangle":e.strokeRect(y,k,c,d);break;case"circle":const g=(y+s)/2,l=(k+o)/2,x=Math.abs(c/2),S=Math.abs(d/2);e.beginPath(),e.ellipse(g,l,x,S,0,0,2*Math.PI),e.stroke();break;case"arrow":e.beginPath(),e.moveTo(y,k),e.lineTo(s,o),e.stroke();const w=Math.atan2(o-k,s-y);le(e,s,o,w,j*4);break}X(null)}else u==="text"||e.closePath();W(!1),O()},Re=()=>{const t=p.current,e=f.current;if(t&&e&&window.confirm(h("widgets.drawing_pad.clear_confirm"))){if(ne(null),e.clearRect(0,0,t.width,t.height),q(!1),Y(""),C.current){const a=C.current.getContext("2d");a&&a.clearRect(0,0,C.current.width,C.current.height)}J(!1),A({x:0,y:0}),N(null)}},G=t=>{b();const e=new FileReader;e.onload=a=>{const n=new Image;n.onload=()=>{ne(n),de(),O()},n.src=a.target?.result},e.readAsDataURL(t)},Te=async()=>{const t=await qe({accept:"image/*"});if(!t)return;if(t.source==="local"){const[s]=t.files;s&&G(s);return}const[e]=t.entryIds;if(!e)return;const a=await fe(e);if(!a?.blob)return;const n=new File([a.blob],a.name,{type:a.mime||a.blob.type});G(n)};i.useEffect(()=>De("drawing-pad",async({entryId:e})=>{const a=await fe(e);if(!a?.blob)return;const n=new File([a.blob],a.name,{type:a.mime||a.blob.type});G(n)}),[]);const ze=()=>{const t=p.current;t&&t.toBlob(async e=>{if(!e)return;const a=h("widgets.drawing_pad.default_filename"),n=await Oe(a);if(n?.destination==="file-manager"){await Le({blob:e,filename:n.filename,sourceWidgetId:"drawing-pad",sourceWidgetTitleKey:"widgets.drawing_pad.title",parentId:n.parentId});return}n?.destination==="download"&&We(e,n.filename)},"image/png")},Pe=i.useCallback((t,e,a)=>{const n=f.current;!n||!t||(n.font=`${j*2}px Arial`,n.fillStyle=R,n.fillText(t,e,a))},[j,R]),ue=()=>{F.trim()!==""&&(z?f.current?.putImageData(z,0,0):de(),Pe(F,se,re),O()),q(!1),Y(""),X(null),W(!1)},$e=t=>{t.key==="Enter"&&ue()},Xe=h(v?"widgets.drawing_pad.exit_pan":"widgets.drawing_pad.pan_mode");return r.jsxs("div",{className:"w-full h-full flex flex-col bg-gray-100 rounded-lg shadow-md overflow-hidden",children:[r.jsxs("div",{className:"p-2 bg-gray-200 flex items-center gap-2 border-b flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[r.jsx("button",{onClick:()=>{b(),te("draw")},className:`p-2 rounded-md ${T==="draw"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.brush"),children:r.jsx(st,{size:20})}),r.jsx("button",{onClick:()=>{b(),te("erase")},className:`p-2 rounded-md ${T==="erase"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.eraser"),children:r.jsx(Qe,{size:20})})]}),T==="draw"&&r.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[r.jsx("button",{onClick:()=>{b(),I("pencil")},className:`p-2 rounded-md ${u==="pencil"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.pencil"),children:r.jsx(it,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("marker")},className:`p-2 rounded-md ${u==="marker"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.marker"),children:r.jsx(et,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("spray")},className:`p-2 rounded-md ${u==="spray"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.spray"),children:r.jsx(ct,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("line")},className:`p-2 rounded-md ${u==="line"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.line"),children:r.jsx(Ve,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("rectangle")},className:`p-2 rounded-md ${u==="rectangle"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.rectangle"),children:r.jsx(lt,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("circle")},className:`p-2 rounded-md ${u==="circle"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.circle"),children:r.jsx(Fe,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("arrow")},className:`p-2 rounded-md ${u==="arrow"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.arrow"),children:r.jsx(Je,{size:20})}),r.jsx("button",{onClick:()=>{b(),I("text")},className:`p-2 rounded-md ${u==="text"?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:h("widgets.drawing_pad.text"),children:r.jsx(ut,{size:20})})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[T==="draw"&&r.jsx("input",{type:"color",value:R,onChange:t=>{b(),me(t.target.value)},className:"w-8 h-8 cursor-pointer rounded-md border border-gray-300",title:h("widgets.drawing_pad.select_color")}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"range",min:"1",max:"50",value:j,onChange:t=>{b(),xe(Number(t.target.value))},className:"w-24 h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer",title:h("widgets.drawing_pad.brush_size")}),r.jsx("span",{className:"text-sm w-6 text-center text-gray-700",children:j})]})]}),r.jsx("button",{onClick:Te,className:"p-2 rounded-md hover:bg-gray-300",title:h("widgets.drawing_pad.upload_image"),children:r.jsx(Be,{size:20})}),r.jsx("button",{onClick:ze,className:"p-2 rounded-md hover:bg-green-300",title:h("widgets.drawing_pad.save_drawing"),children:r.jsx(He,{size:20})}),r.jsx("button",{onClick:Re,className:"p-2 rounded-md hover:bg-red-300",title:h("widgets.drawing_pad.clear_all"),children:r.jsx(Ee,{size:20})}),r.jsxs("div",{className:"ml-auto flex items-center gap-2 border-l pl-2",children:[r.jsx("button",{onClick:je,className:`p-2 rounded-md ${v?"bg-blue-500 text-white":"hover:bg-gray-300"}`,title:Xe,children:r.jsx(nt,{size:20})}),r.jsx("button",{onClick:_e,className:"p-2 rounded-md hover:bg-blue-300",title:h("widgets.drawing_pad.center_view"),children:r.jsx(Ae,{size:20})})]})]}),r.jsxs("div",{className:"flex-grow w-full h-full relative bg-white",children:[r.jsx("canvas",{ref:p,onMouseDown:Ne,onMouseUp:t=>{if(v){N(null),O();return}u!=="text"&&he(t.nativeEvent)},onMouseLeave:t=>{v?N(null):ee&&u!=="text"&&he(t.nativeEvent)},onMouseMove:Se,className:`w-full h-full block ${v?"cursor-grab":$?"cursor-grabbing":"cursor-crosshair"}`,style:{cursor:v?$?"grabbing":"grab":"crosshair"}}),!m&&H&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 text-lg pointer-events-none",children:h("widgets.drawing_pad.start_drawing")}),ae&&r.jsx("input",{type:"text",ref:ie,value:F,onChange:t=>Y(t.target.value),onBlur:ue,onKeyDown:$e,style:{position:"absolute",left:se,top:re,fontSize:`${j*2}px`,color:R,fontFamily:"Arial",backgroundColor:"rgba(255, 255, 255, 0.8)",border:"1px solid #ccc",padding:"2px 5px",zIndex:100,minWidth:"50px",outline:"none",transform:"translate(-50%, -50%)"},className:"rounded-md shadow-sm"})]})]})};export{bt as DrawingPadWidget,vt as widgetConfig};
