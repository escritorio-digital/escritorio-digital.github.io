import{c as q,u as z,r as a,e as J,f as M,j as i,F as P,D as R,aG as $,h as N}from"./index-C4_cQ6bu.js";import{aR as se}from"./index-C4_cQ6bu.js";import{P as S}from"./papaparse.min-B4b7g4ph.js";import{r as B,s as K,d as V}from"./saveDialog-DGJ58OfE.js";import{r as A}from"./openDialog-H-OCpcqq.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],H=q("square-pen",G),Z=({instanceId:y})=>{const{t:o,ready:b}=z(),T=a.useRef(y??`work-list-${Date.now()}-${Math.random().toString(16).slice(2)}`),n=y??T.current,[r,c]=J("work-list-tasks",[]),[g,E]=a.useState(""),[u,f]=a.useState(null),[k,h]=a.useState(""),[v,m]=a.useState(""),[F,I]=a.useState(null),D=e=>{e.key==="Enter"&&g.trim()!==""&&(c([...r,{id:Date.now(),text:g.trim(),completed:!1}]),E(""))},L=e=>{c(r.map(s=>s.id===e?{...s,completed:!s.completed}:s))},_=e=>{c(r.filter(s=>s.id!==e))},j=e=>{f(e.id),h(e.text)},O=e=>{e.key==="Enter"&&u!==null&&(k.trim()===""?_(u):c(r.map(s=>s.id===u?{...s,text:k.trim()}:s)),f(null),h(""))},x=async()=>{const e=S.unparse(r.map(l=>({id:l.id,text:l.text,completed:l.completed}))),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=await B(F||"lista_de_trabajo.csv",{sourceWidgetId:"work-list"});if(!t)return;t?.destination==="file-manager"?await K({blob:s,filename:t.filename,sourceWidgetId:"work-list",sourceWidgetTitleKey:"widgets.work_list.title",parentId:t.parentId}):t?.destination==="download"&&V(s,t.filename),window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:n,title:t.filename}})),I(t.filename),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:n,widgetId:"work-list",isDirty:!1}}));const d=JSON.stringify(r);m(d),window.dispatchEvent(new CustomEvent("widget-save-complete",{detail:{instanceId:n,widgetId:"work-list"}}))},p=a.useCallback((e,s)=>{S.parse(e,{header:!0,skipEmptyLines:!0,complete:t=>{const d=t.data.map(w=>({id:Number(w.id)||Date.now()+Math.random(),text:String(w.text||""),completed:String(w.completed).toLowerCase()==="true"})).filter(w=>w.text);window.confirm(o("widgets.work_list.replace_list_confirm"))?(c(d),m(JSON.stringify(d))):c(w=>{const C=[...w,...d];return m(JSON.stringify(C)),C});const l=s||e.name;l&&(window.dispatchEvent(new CustomEvent("widget-title-update",{detail:{instanceId:n,title:l}})),I(l)),window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:n,widgetId:"work-list",isDirty:!1}}))},error:t=>{console.error("Error al parsear el CSV:",t),alert(o("widgets.work_list.csv_error"))}})},[n,c,o]),W=async()=>{const e=await A({accept:".csv",sourceWidgetId:"work-list"});if(!e)return;if(e.source==="local"){const[l]=e.files;l&&p(l);return}const[s]=e.entryIds;if(!s)return;const t=await N(s);if(!t?.blob)return;const d=new File([t.blob],t.name,{type:t.mime||t.blob.type});p(d,t.name)};return a.useEffect(()=>M("work-list",async({entryId:s})=>{const t=await N(s);if(!t?.blob)return;const d=new File([t.blob],t.name,{type:t.mime||t.blob.type});p(d,t.name)}),[p]),a.useEffect(()=>{if(!v){m(JSON.stringify(r));return}const s=JSON.stringify(r)!==v;window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:n,widgetId:"work-list",isDirty:s}}))},[v,n,r]),a.useEffect(()=>{const e=s=>{const t=s;t.detail?.instanceId===n&&(t.detail?.widgetId&&t.detail.widgetId!=="work-list"||x())};return window.addEventListener("widget-save-request",e),()=>window.removeEventListener("widget-save-request",e)},[x,n]),a.useEffect(()=>()=>{window.dispatchEvent(new CustomEvent("widget-dirty-state",{detail:{instanceId:n,widgetId:"work-list",isDirty:!1}}))},[n]),console.log("WorkList translations:",{ready:b,placeholder:o("widgets.work_list.add_task_placeholder"),title:o("widgets.work_list.title")}),b?i.jsxs("div",{className:"work-list-widget",children:[i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("input",{type:"text",className:"work-list-input",placeholder:o("widgets.work_list.add_task_placeholder"),value:g,onChange:e=>E(e.target.value),onKeyPress:D}),i.jsx("button",{onClick:W,className:"work-list-icon-button",title:o("widgets.work_list.load_csv"),children:i.jsx(P,{size:20})}),i.jsx("button",{onClick:x,className:"work-list-icon-button",title:o("widgets.work_list.download_csv"),children:i.jsx(R,{size:20})})]}),i.jsx("ul",{className:"work-list-items",children:r.map(e=>i.jsxs("li",{className:`work-list-item ${e.completed?"opacity-50":""}`,children:[i.jsx("input",{type:"checkbox",className:"work-list-checkbox",checked:e.completed,onChange:()=>L(e.id)}),u===e.id?i.jsx("input",{type:"text",value:k,onChange:s=>h(s.target.value),onKeyPress:O,onBlur:()=>f(null),className:"work-list-edit-input",autoFocus:!0}):i.jsx("span",{className:`flex-grow cursor-pointer ${e.completed?"line-through":""}`,onDoubleClick:()=>j(e),children:e.text}),i.jsx("button",{onClick:()=>j(e),className:"work-list-action",children:i.jsx(H,{size:16})}),i.jsx("button",{onClick:()=>_(e.id),className:"work-list-action delete",children:i.jsx($,{size:16})})]},e.id))}),i.jsx("p",{className:"work-list-hint",children:o("widgets.work_list.double_click_edit")})]}):i.jsx("div",{className:"flex items-center justify-center h-full",children:o("loading")})};export{Z as WorkListWidget,se as widgetConfig};
