import{u as J,a as Q,r as o,j as n,X as V,b as Z,T as ee,g as te}from"./index-CHlQH2X_.js";import{ae as xe}from"./index-CHlQH2X_.js";import{r as ne}from"./openDialog-H-OCpcqq.js";import{P as se}from"./play-BPj6dnwT.js";import{E as oe}from"./expand-DzmSjWo3.js";import{P as re}from"./plus-lBQgKT4k.js";const R=()=>`hsl(${Math.random()*360}, 70%, 80%)`,pe=()=>{const{t:d}=J(),[r,f]=Q("spinner-options",[]);o.useEffect(()=>{if(window.localStorage.getItem("spinner-options")===null){const e=d("widgets.random_spinner.default_options",{returnObjects:!0});Array.isArray(e)&&f(e.map(s=>({...s,color:R()})))}},[d,f]);const[b,E]=o.useState(""),[w,M]=o.useState(!1),[z,x]=o.useState(null),[q,_]=o.useState(null),[S,h]=o.useState(""),[g,B]=o.useState(!1),[a,K]=o.useState(300),[y,L]=o.useState(!1),[C,O]=o.useState(null),I=o.useRef(null),k=o.useRef(null),A=o.useRef(r);o.useEffect(()=>{A.current=r},[r]),o.useEffect(()=>{const t=k.current;if(!t)return;const e=new ResizeObserver(()=>{if(t){const s=Math.min(t.offsetWidth,t.offsetHeight);K(s)}});return e.observe(t),()=>e.disconnect()},[]),o.useEffect(()=>{const t=I.current;if(!t)return;const e=t.getContext("2d");if(!e)return;t.width=a,t.height=a;const s=r.length;if(s===0){e.clearRect(0,0,a,a);return}const c=2*Math.PI/s,l=a/2,i=a/2,u=a/2-10;e.clearRect(0,0,a,a),e.font=`bold ${Math.max(10,a*.05)}px sans-serif`,r.forEach((p,j)=>{const m=j*c;e.beginPath(),e.fillStyle=p.color,e.moveTo(l,i),e.arc(l,i,u,m,m+c),e.closePath(),e.fill(),e.save(),e.fillStyle="#333",e.translate(l,i),e.rotate(m+c/2),e.textAlign="right";const v=p.text.length>15?p.text.substring(0,12)+"...":p.text;e.fillText(v,u-10,0),e.restore()})},[r,a]);const T=()=>{b.trim()&&r.length<20&&(f([...r,{text:b.trim(),color:R()}]),E(""))},F=t=>{const e=new FileReader;e.onload=s=>{const l=(s.target?.result??"").split(/\r?\n/).map(i=>i.trim()).filter(Boolean).slice(0,20);f(l.map(i=>({text:i,color:R()}))),x(null),_(null),h("")},e.readAsText(t)},W=async()=>{const t=await ne({accept:".txt"});if(!t)return;if(t.source==="local"){const[l]=t.files;l&&F(l);return}const[e]=t.entryIds;if(!e)return;const s=await te(e);if(!s?.blob)return;const c=new File([s.blob],s.name,{type:s.mime||s.blob.type});F(c)},X=t=>{f(r.filter((e,s)=>s!==t))},D=t=>{_(t),h(r[t].text)},$=t=>{if(S.trim()){const e=[...r];e[t].text=S.trim(),f(e)}_(null),h("")},H=()=>{if(w)return;let t=A.current;if(y&&C){const i=t.findIndex(u=>u.text===C);if(i!==-1){const u=t.filter((p,j)=>j!==i);f(u),t=u}O(null)}if(t.length<2)return;M(!0),x(null);const e=Math.random()*20+20,s=(Math.random()*3+4)*1e3;let c=0;const l=i=>{c||(c=i);const u=i-c,p=Math.min(u/s,1),m=e*(N=>1-Math.pow(1-N,4))(p),v=I.current;if(v&&(v.style.transform=`rotate(${m}rad)`),p<1)requestAnimationFrame(l);else{const N=m%(2*Math.PI),U=2*Math.PI/t.length,Y=((-Math.PI/2-N)%(2*Math.PI)+2*Math.PI)%(2*Math.PI),G=Math.floor(Y/U)%t.length,P=t[G]?.text??null;x(P),y&&P&&O(P),M(!1)}};requestAnimationFrame(l)};return n.jsxs("div",{className:`random-spinner-widget ${g?"fullscreen":""}`,children:[n.jsxs("div",{ref:k,className:"spinner-area",children:[n.jsx("canvas",{ref:I,className:"spinner-canvas"}),n.jsx("div",{className:"spinner-pointer"}),n.jsx("button",{onClick:H,disabled:w||r.length<2,className:"spin-button",children:n.jsx(se,{size:32})}),z&&!w&&n.jsxs("div",{className:"spinner-result",onClick:()=>x(null),children:[n.jsx("span",{children:z}),n.jsx("small",{children:d("widgets.random_spinner.result_overlay_text")})]}),n.jsx("button",{onClick:()=>B(!g),className:"fullscreen-button",title:d(g?"widgets.random_spinner.restore_view_button_title":"widgets.random_spinner.fullscreen_button_title"),children:g?n.jsx(V,{size:16}):n.jsx(oe,{size:16})})]}),n.jsxs("div",{className:"options-manager",children:[n.jsx("div",{className:"options-header",children:n.jsx("h3",{children:d("widgets.random_spinner.options_header")})}),n.jsxs("label",{className:"remove-selected",children:[n.jsx("input",{type:"checkbox",checked:y,onChange:t=>{const e=t.target.checked;L(e),e||O(null)}}),d("widgets.random_spinner.remove_after_select")]}),n.jsxs("div",{className:"add-option",children:[n.jsx("input",{type:"text",value:b,onChange:t=>E(t.target.value),placeholder:d("widgets.random_spinner.add_option_placeholder"),maxLength:20,onKeyPress:t=>t.key==="Enter"&&T()}),n.jsx("button",{onClick:T,children:n.jsx(re,{size:18})})]}),n.jsxs("button",{onClick:W,className:"upload-options-button",children:[n.jsx(Z,{size:16})," ",d("widgets.random_spinner.load_from_file")]}),n.jsx("ul",{className:"options-list",children:r.map((t,e)=>n.jsxs("li",{onDoubleClick:()=>D(e),children:[n.jsx("span",{className:"option-color",style:{backgroundColor:t.color}}),q===e?n.jsx("input",{type:"text",value:S,onChange:s=>h(s.target.value),onBlur:()=>$(e),onKeyPress:s=>s.key==="Enter"&&$(e),autoFocus:!0,className:"edit-input"}):n.jsx("span",{className:"option-text",children:t.text}),n.jsx("button",{onClick:()=>X(e),children:n.jsx(ee,{size:14})})]},e))})]})]})};export{pe as RandomSpinnerWidget,xe as widgetConfig};
