import{c as q,u as se,r as n,g as ae,s as ne,j as e,C as ie,P as re,B as le,T as oe,a as x,b as O}from"./index-CmQIKd-y.js";import{w as ve}from"./index-CmQIKd-y.js";import{C as ce}from"./chevron-down-BQIVw7dJ.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],me=q("bell-off",de);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],ge=q("timer",ue),he=l=>{const s=Math.max(0,Math.floor(l/1e3)),c=Math.floor(s/3600),r=Math.floor(s%3600/60),d=s%60;return[c,r,d].map(u=>String(u).padStart(2,"0")).join(":")},$=l=>{const s=new Date(l),c=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0");return`${c}-${r}-${d}`},pe=(l,s)=>{const[c,r,d]=l.split("-"),[m,u]=s.split(":"),g=Number.parseInt(c??"",10),b=Number.parseInt(r??"",10),h=Number.parseInt(d??"",10),p=Number.parseInt(m??"",10),w=Number.parseInt(u??"",10);if(!Number.isFinite(g)||!Number.isFinite(b)||!Number.isFinite(h)||!Number.isFinite(p)||!Number.isFinite(w))return null;const f=new Date(g,b-1,h,p,w,0,0);return Number.isNaN(f.getTime())?null:f.getTime()},be=({instanceId:l})=>{const{t:s,i18n:c}=se(),[r,d]=n.useState("time"),[m,u]=n.useState("08:00"),[g,b]=n.useState(()=>$(Date.now())),[h,p]=n.useState(5),[w,f]=n.useState(0),[N,B]=n.useState(""),[j,P]=n.useState(!0),[E,W]=n.useState(()=>ae()),[D,y]=n.useState(null),[_,Y]=n.useState(Date.now()),z=n.useRef(null),A=n.useRef(null),C=n.useRef(null),S=n.useRef(null),M=n.useRef(0),G=n.useMemo(()=>$(_),[_]),[v,T]=n.useState(!1),J=n.useMemo(()=>[5,10,15,20,25,30,35,40,45,50,55,60],[]);n.useEffect(()=>ne(W),[]),n.useEffect(()=>{const t=window.setInterval(()=>Y(Date.now()),1e3);return()=>window.clearInterval(t)},[]);const I=n.useMemo(()=>{const t=new Intl.DateTimeFormat(c.language,{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short"});return[...E].sort((a,i)=>a.targetTime-i.targetTime).map(a=>({...a,formattedTime:t.format(new Date(a.targetTime))}))},[E,c.language]),K=()=>{if(y(null),r==="time"){const a=pe(g,m);if(!a||a<=Date.now()){y(s("widgets.alarm.invalid_time"));return}x(i=>[...i,O({label:N.trim(),targetTime:a,soundEnabled:j,mode:r})]);return}const t=Math.max(0,h*60+w);if(t<=0){y(s("widgets.alarm.invalid_countdown"));return}x(a=>[...a,O({label:N.trim(),targetTime:Date.now()+t*1e3,soundEnabled:j,mode:r})])},Q=t=>{x(a=>a.map(i=>i.id===t?{...i,soundEnabled:!i.soundEnabled}:i))},U=(t,a)=>{x(i=>i.map(o=>o.id===t?{...o,label:a}:o))},X=t=>{x(a=>a.filter(i=>i.id!==t))},k=I.length>0;return n.useEffect(()=>{if(!v)return;const t=a=>{const i=a.target;!i||!C.current||C.current.contains(i)||T(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[v]),n.useEffect(()=>{if(!l)return;const t=z.current,a=A.current;if(!t||!a)return;const i=t.closest(".widget-window");if(!i)return;const o=()=>{const V=t.clientHeight,L=a.scrollHeight;if(L<=V+6)return;const ee=i.getBoundingClientRect().height,te=L-V,R=Math.ceil(ee+te+16);S.current&&Math.abs(R-S.current)<6||(S.current=R,window.dispatchEvent(new CustomEvent("widget-resize-request",{detail:{instanceId:l,size:{height:R}}})))},F=new ResizeObserver(o);F.observe(a),o(),M.current=0;const H=()=>{M.current+=1,o(),M.current<3&&window.setTimeout(H,80)},Z=window.setTimeout(H,60);return()=>{F.disconnect(),window.clearTimeout(Z)}},[l,k,r]),e.jsx("div",{className:"alarm-widget",ref:z,children:e.jsxs("div",{className:"alarm-content",ref:A,children:[e.jsxs("div",{className:"alarm-form",children:[e.jsx("div",{className:"alarm-section-title",children:s("widgets.alarm.mode_label")}),e.jsxs("div",{className:"alarm-mode-toggle",children:[e.jsxs("button",{type:"button",className:r==="time"?"active":"",onClick:()=>d("time"),children:[e.jsx(ie,{size:16}),s("widgets.alarm.mode_time")]}),e.jsxs("button",{type:"button",className:r==="countdown"?"active":"",onClick:()=>d("countdown"),children:[e.jsx(ge,{size:16}),s("widgets.alarm.mode_countdown")]})]}),r==="time"?e.jsxs("div",{className:"alarm-time-grid",children:[e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.date_label")}),e.jsx("input",{type:"date",value:g,min:G,onChange:t=>b(t.target.value)})]}),e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.time_label")}),e.jsx("input",{type:"time",value:m,onChange:t=>u(t.target.value)})]})]}):e.jsxs("div",{className:"alarm-countdown-grid",children:[e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.countdown_minutes")}),e.jsxs("div",{className:"alarm-minute-control",ref:C,children:[e.jsx("input",{type:"number",min:0,value:h,onChange:t=>p(Math.max(0,Number(t.target.value)||0)),onFocus:t=>t.target.select()}),e.jsx("button",{type:"button",className:"alarm-minute-toggle","aria-label":s("widgets.alarm.countdown_minutes"),"aria-haspopup":"listbox","aria-expanded":v,onClick:()=>T(t=>!t),children:e.jsx(ce,{size:16})}),v&&e.jsx("div",{className:"alarm-minute-menu",role:"listbox",children:J.map(t=>e.jsx("button",{type:"button",className:"alarm-minute-option",onClick:()=>{p(t),T(!1)},children:t},t))})]})]}),e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.countdown_seconds")}),e.jsx("input",{type:"number",min:0,max:59,value:w,onChange:t=>{const a=Math.max(0,Math.min(59,Number(t.target.value)||0));f(a)}})]})]}),e.jsxs("label",{className:"alarm-field",children:[e.jsx("span",{children:s("widgets.alarm.label_label")}),e.jsx("input",{type:"text",value:N,onChange:t=>B(t.target.value),placeholder:s("widgets.alarm.default_label")})]}),e.jsxs("label",{className:"alarm-sound-toggle",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>P(t.target.checked)}),e.jsx("span",{children:s(j?"widgets.alarm.sound_on":"widgets.alarm.sound_off")})]}),D&&e.jsx("div",{className:"alarm-error",children:D}),e.jsxs("button",{type:"button",className:"alarm-submit",onClick:K,children:[e.jsx(re,{size:16}),s("widgets.alarm.add_alarm")]}),e.jsx("button",{type:"button",className:"alarm-display-launch",onClick:()=>window.dispatchEvent(new CustomEvent("open-widget",{detail:{widgetId:"alarm-display"}})),children:s("widgets.alarm.open_display")}),!k&&e.jsx("p",{className:"alarm-empty-inline",children:s("widgets.alarm.none")})]}),e.jsxs("div",{className:"alarm-list",children:[e.jsx("div",{className:"alarm-section-title",children:s("widgets.alarm.active_alarms")}),k?e.jsx("div",{className:"alarm-items",children:I.map(t=>{const a=t.targetTime-_,i=t.label||s("widgets.alarm.default_label");return e.jsxs("div",{className:`alarm-item${t.triggered?" is-triggered":""}`,children:[e.jsxs("div",{className:"alarm-item-main",children:[e.jsx("input",{className:"alarm-item-title-input",value:i,onChange:o=>U(t.id,o.target.value),placeholder:s("widgets.alarm.default_label")}),e.jsx("div",{className:"alarm-item-meta",children:t.triggered?s("widgets.alarm.triggered"):s("widgets.alarm.remaining",{time:he(a)})}),e.jsx("div",{className:"alarm-item-time",children:s("widgets.alarm.scheduled_for",{time:t.formattedTime})})]}),e.jsxs("div",{className:"alarm-item-actions",children:[e.jsx("button",{type:"button",className:"alarm-action",onClick:()=>Q(t.id),title:t.soundEnabled?s("widgets.alarm.sound_on"):s("widgets.alarm.sound_off"),children:t.soundEnabled?e.jsx(le,{size:16}):e.jsx(me,{size:16})}),e.jsxs("button",{type:"button",className:"alarm-action danger",onClick:()=>X(t.id),children:[e.jsx(oe,{size:16}),t.triggered?s("widgets.alarm.dismiss"):s("widgets.alarm.delete")]})]})]},t.id)})}):e.jsxs("div",{className:"alarm-empty-panel",children:[e.jsx("p",{children:s("widgets.alarm.empty_tip_title")}),e.jsxs("ul",{children:[e.jsx("li",{children:s("widgets.alarm.empty_tip_persist")}),e.jsx("li",{children:s("widgets.alarm.empty_tip_profiles")}),e.jsx("li",{children:s("widgets.alarm.empty_tip_sound")}),e.jsx("li",{children:s("widgets.alarm.empty_tip_clock")})]})]})]})]})})};export{be as AlarmWidget,ve as widgetConfig};
